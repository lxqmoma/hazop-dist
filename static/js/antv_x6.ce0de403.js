"use strict";(self.webpackChunkhazop_fe=self.webpackChunkhazop_fe||[]).push([["53"],{110:function(e,t,i){let r,s,n,o,l,a,h;i.d(t,{QK:()=>e_.QK,OW:()=>e_.OW,Z4:()=>e0.Z4,mf:()=>e_.mf,FE:()=>sZ,RZ:()=>e0.RZ,JT:()=>e_.JT,kJ:()=>nS,Lu:()=>eO,E9:()=>e0.E9,Ae:()=>e0.Ae,bL:()=>sU,tx:()=>e_.tx,RO:()=>e_.RO,is:()=>e_.is,DK:()=>nt,ew:()=>e_.ew,bn:()=>eZ,G7:()=>rh,Vb:()=>e_.Vb,GH:()=>e_.GH,Iw:()=>e_.Iw,NB:()=>sK});var c,g,u,d,p,f,m,y,b,v,w,x,C,E,P,O,A,M,S,T,k,N,j,B,R,D,V,I,L,$,z,F,G,H,U,q,W,K,J,Q,X,Y,Z,_,ee,et,ei,er,es,en,eo,el,ea,eh,ec,eg,eu,ed,ep,ef,em,ey,eb,ev,ew,ex,eC,eE,eP,eO,eA,eM,eS,eT,ek,eN,ej,eB,eR,eD,eV,eI,eL={};i.r(eL),i.d(eL,{dot:()=>e2,doubleMesh:()=>e6,fixedDot:()=>e3,mesh:()=>e9});var e$={};i.r(e$),i.d(e$,{flipX:()=>e4,flipXY:()=>e7,flipY:()=>e8,watermark:()=>te});var ez={};i.r(ez),i.d(ez,{blur:()=>tn,brightness:()=>tu,contrast:()=>td,dropShadow:()=>to,grayScale:()=>tl,highlight:()=>ts,hueRotate:()=>tc,invert:()=>tg,outline:()=>tr,saturate:()=>th,sepia:()=>ta});var eF={};i.r(eF),i.d(eF,{async:()=>iu,block:()=>it,circle:()=>ip,circlePlus:()=>im,classic:()=>ii,cross:()=>ic,diamond:()=>io,ellipse:()=>ib,path:()=>ia});var eG={};i.r(eG),i.d(eG,{annotations:()=>tY,atConnectionLength:()=>iN,atConnectionLengthIgnoreGradient:()=>iS,atConnectionLengthKeepGradient:()=>iM,atConnectionRatio:()=>ij,atConnectionRatioIgnoreGradient:()=>ik,atConnectionRatioKeepGradient:()=>iT,connection:()=>iA,displayEmpty:()=>t_,eol:()=>tZ,fill:()=>tH,filter:()=>t4,html:()=>t5,lineHeight:()=>tJ,port:()=>t8,ref:()=>tp,refCx:()=>tO,refCy:()=>tA,refD:()=>tj,refDKeepOffset:()=>tS,refDResetOffset:()=>tM,refDx:()=>ty,refDy:()=>tb,refHeight:()=>tw,refHeight2:()=>tI,refPoints:()=>tB,refPointsKeepOffset:()=>tk,refPointsResetOffset:()=>tT,refR:()=>tN,refRCircumscribed:()=>tP,refRInscribed:()=>tE,refRx:()=>tx,refRy:()=>tC,refWidth:()=>tv,refWidth2:()=>tV,refX:()=>tf,refX2:()=>tR,refY:()=>tm,refY2:()=>tD,resetOffset:()=>t3,sourceMarker:()=>ix,stroke:()=>tU,style:()=>t6,targetMarker:()=>iC,text:()=>tq,textPath:()=>tX,textVerticalAnchor:()=>tQ,textWrap:()=>tW,title:()=>t0,vertexMarker:()=>iE,xAlign:()=>t1,yAlign:()=>t2});var eH={};i.r(eH),i.d(eH,{className:()=>iV,opacity:()=>iL,stroke:()=>iz});var eU={};i.r(eU),i.d(eU,{absolute:()=>iq,bottom:()=>i0,ellipse:()=>iW,ellipseSpread:()=>iK,left:()=>iY,line:()=>iX,right:()=>iZ,top:()=>i_});var eq={};i.r(eq),i.d(eq,{bottom:()=>i8,inside:()=>rt,insideOriented:()=>ri,left:()=>i6,manual:()=>i9,outside:()=>i7,outsideOriented:()=>re,radial:()=>ro,radialOriented:()=>rl,right:()=>i5,top:()=>i4});var eW={};i.r(eW),i.d(eW,{noop:()=>rm,pinAbsolute:()=>rw,pinRelative:()=>rv});var eK={};i.r(eK),i.d(eK,{bottom:()=>rF,bottomLeft:()=>rW,bottomRight:()=>rK,center:()=>r$,left:()=>rG,midSide:()=>r_,nodeCenter:()=>rZ,orth:()=>rY,right:()=>rH,top:()=>rz,topLeft:()=>rU,topRight:()=>rq});var eJ={};i.r(eJ),i.d(eJ,{closest:()=>r3,length:()=>r1,orth:()=>r9,ratio:()=>r0});var eQ={};i.r(eQ),i.d(eQ,{anchor:()=>se,bbox:()=>r4,boundary:()=>r7,rect:()=>r8});var eX={};i.r(eX),i.d(eX,{er:()=>sS,loop:()=>sk,manhattan:()=>sO,metro:()=>sM,normal:()=>st,oneSide:()=>si,orth:()=>sl});var eY={};i.r(eY),i.d(eY,{jumpover:()=>sz,loop:()=>sj,normal:()=>sN,rounded:()=>sB,smooth:()=>sR});var eZ={};i.r(eZ),i.d(eZ,{kS:()=>s9});var e_=i(46495),e0=i(94472);class e1{constructor(e){this.options=Object.assign({},e),this.data=this.options.data||{},this.register=this.register.bind(this),this.unregister=this.unregister.bind(this)}get names(){return Object.keys(this.data)}register(e,t,i=!1){if("object"==typeof e)return void Object.entries(e).forEach(([e,i])=>{this.register(e,i,t)});!this.exist(e)||i||e_.t4.isApplyingHMR()||this.onDuplicated(e);let r=this.options.process,s=r?e_.Iw.call(r,this,e,t):t;return this.data[e]=s,s}unregister(e){let t=e?this.data[e]:null;return delete this.data[e],t}get(e){return e?this.data[e]:null}exist(e){return!!e&&null!=this.data[e]}onDuplicated(e){try{throw this.options.onConflict&&e_.Iw.call(this.options.onConflict,this,e),Error(`${e_.kf.upperFirst(this.options.type)} with name '${e}' already registered.`)}catch(e){throw e}}onNotFound(e,t){throw Error(this.getSpellingSuggestion(e,t))}getSpellingSuggestion(e,t){let i=this.getSpellingSuggestionForName(e),r=t?`${t} ${e_.kf.lowerFirst(this.options.type)}`:this.options.type;return`${e_.kf.upperFirst(r)} with name '${e}' does not exist.${i?` Did you mean '${i}'?`:""}`}getSpellingSuggestionForName(e){return e_.kf.getSpellingSuggestion(e,Object.keys(this.data),e=>e)}}(c=e1||(e1={})).create=function(e){return new c(e)};let e2={color:"#aaaaaa",thickness:1,markup:"rect",update(e,t){let i=t.thickness*t.sx,r=t.thickness*t.sy;e_.is.attr(e,{width:i,height:r,rx:i,ry:r,fill:t.color})}},e3={color:"#aaaaaa",thickness:1,markup:"rect",update(e,t){let i=t.sx<=1?t.thickness*t.sx:t.thickness;e_.is.attr(e,{width:i,height:i,rx:i,ry:i,fill:t.color})}},e9={color:"rgba(224,224,224,1)",thickness:1,markup:"path",update(e,t){let i,r=t.width,s=t.height,n=t.thickness;i=r-n>=0&&s-n>=0?["M",r,"0 H0 M0 0 V0",s].join(" "):"M 0 0 0 0",e_.is.attr(e,{d:i,stroke:t.color,"stroke-width":t.thickness})}},e6=[{color:"rgba(224,224,224,1)",thickness:1,markup:"path",update(e,t){let i,r=t.width,s=t.height,n=t.thickness;i=r-n>=0&&s-n>=0?["M",r,"0 H0 M0 0 V0",s].join(" "):"M 0 0 0 0",e_.is.attr(e,{d:i,stroke:t.color,"stroke-width":t.thickness})}},{color:"rgba(224,224,224,0.2)",thickness:3,factor:4,markup:"path",update(e,t){let i,r=t.factor||1,s=t.width*r,n=t.height*r,o=t.thickness;i=s-o>=0&&n-o>=0?["M",s,"0 H0 M0 0 V0",n].join(" "):"M 0 0 0 0",t.width=s,t.height=n,e_.is.attr(e,{d:i,stroke:t.color,"stroke-width":t.thickness})}}];class e5{constructor(){this.patterns={},this.root=e_.OW.create(e_.is.createSvgDocument(),{width:"100%",height:"100%"},[e_.is.createSvgElement("defs")]).node}add(e,t){let i=this.root.childNodes[0];i&&i.appendChild(t),this.patterns[e]=t,e_.OW.create("rect",{width:"100%",height:"100%",fill:`url(#${e})`}).appendTo(this.root)}get(e){return this.patterns[e]}has(e){return null!=this.patterns[e]}}(g=e5||(e5={})).presets=eL,g.registry=e1.create({type:"grid"}),g.registry.register(g.presets,!0);let e4=function(e){let t=document.createElement("canvas"),i=e.width,r=e.height;t.width=2*i,t.height=r;let s=t.getContext("2d");return s.drawImage(e,0,0,i,r),s.translate(2*i,0),s.scale(-1,1),s.drawImage(e,0,0,i,r),t},e8=function(e){let t=document.createElement("canvas"),i=e.width,r=e.height;t.width=i,t.height=2*r;let s=t.getContext("2d");return s.drawImage(e,0,0,i,r),s.translate(0,2*r),s.scale(1,-1),s.drawImage(e,0,0,i,r),t},e7=function(e){let t=document.createElement("canvas"),i=e.width,r=e.height;t.width=2*i,t.height=2*r;let s=t.getContext("2d");return s.drawImage(e,0,0,i,r),s.setTransform(-1,0,0,-1,t.width,t.height),s.drawImage(e,0,0,i,r),s.setTransform(-1,0,0,1,t.width,0),s.drawImage(e,0,0,i,r),s.setTransform(1,0,0,-1,0,t.height),s.drawImage(e,0,0,i,r),t},te=function(e,t){let i=e.width,r=e.height,s=document.createElement("canvas");s.width=3*i,s.height=3*r;let n=s.getContext("2d"),o=null!=t.angle?-t.angle:-20,l=e0.RZ.toRad(o),a=s.width/4,h=s.height/4;for(let t=0;t<4;t+=1)for(let s=0;s<4;s+=1)(t+s)%2>0&&(n.setTransform(1,0,0,1,(2*t-1)*a,(2*s-1)*h),n.rotate(l),n.drawImage(e,-i/2,-r/2,i,r));return s};function tt(e,t){return null!=e?e:t}function ti(e,t){return null!=e&&Number.isFinite(e)?e:t}function tr(e={}){let t=tt(e.color,"blue"),i=ti(e.width,1),r=ti(e.margin,2),s=ti(e.opacity,1);return`
    <filter>
      <feFlood flood-color="${t}" flood-opacity="${s}" result="colored"/>
      <feMorphology in="SourceAlpha" result="morphedOuter" operator="dilate" radius="${r+i}" />
      <feMorphology in="SourceAlpha" result="morphedInner" operator="dilate" radius="${r}" />
      <feComposite result="morphedOuterColored" in="colored" in2="morphedOuter" operator="in"/>
      <feComposite operator="xor" in="morphedOuterColored" in2="morphedInner" result="outline"/>
      <feMerge>
        <feMergeNode in="outline"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  `.trim()}function ts(e={}){let t=tt(e.color,"red"),i=ti(e.blur,0),r=ti(e.width,1),s=ti(e.opacity,1);return`
      <filter>
        <feFlood flood-color="${t}" flood-opacity="${s}" result="colored"/>
        <feMorphology result="morphed" in="SourceGraphic" operator="dilate" radius="${r}"/>
        <feComposite result="composed" in="colored" in2="morphed" operator="in"/>
        <feGaussianBlur result="blured" in="composed" stdDeviation="${i}"/>
        <feBlend in="SourceGraphic" in2="blured" mode="normal"/>
      </filter>
    `.trim()}function tn(e={}){let t=ti(e.x,2),i=null!=e.y&&Number.isFinite(e.y)?[t,e.y]:t;return`
    <filter>
      <feGaussianBlur stdDeviation="${i}"/>
    </filter>
  `.trim()}function to(e={}){let t=ti(e.dx,0),i=ti(e.dy,0),r=tt(e.color,"black"),s=ti(e.blur,4),n=ti(e.opacity,1);return"SVGFEDropShadowElement"in window?`<filter>
         <feDropShadow stdDeviation="${s}" dx="${t}" dy="${i}" flood-color="${r}" flood-opacity="${n}" />
       </filter>`.trim():`<filter>
         <feGaussianBlur in="SourceAlpha" stdDeviation="${s}" />
         <feOffset dx="${t}" dy="${i}" result="offsetblur" />
         <feFlood flood-color="${r}" />
         <feComposite in2="offsetblur" operator="in" />
         <feComponentTransfer>
           <feFuncA type="linear" slope="${n}" />
         </feComponentTransfer>
         <feMerge>
           <feMergeNode/>
           <feMergeNode in="SourceGraphic"/>
         </feMerge>
       </filter>`.trim()}function tl(e={}){let t=ti(e.amount,1),i=.7152-.7152*(1-t);return`
    <filter>
      <feColorMatrix type="matrix" values="${.2126+.7874*(1-t)} ${i} ${.0722-.0722*(1-t)} 0 0 ${.2126-.2126*(1-t)} ${.7152+.2848*(1-t)} ${.0722-.0722*(1-t)} 0 0 ${.2126-.2126*(1-t)} ${i} ${.0722+.9278*(1-t)} 0 0 0 0 0 1 0"/>
    </filter>
  `.trim()}function ta(e={}){let t=ti(e.amount,1);return`
      <filter>
        <feColorMatrix type="matrix" values="${.393+.607*(1-t)} ${.769-.769*(1-t)} ${.189-.189*(1-t)} 0 0 ${.349-.349*(1-t)} ${.686+.314*(1-t)} ${.168-.168*(1-t)} 0 0 ${.272-.272*(1-t)} ${.534-.534*(1-t)} ${.131+.869*(1-t)} 0 0 0 0 0 1 0"/>
      </filter>
    `.trim()}function th(e={}){let t=ti(e.amount,1);return`
      <filter>
        <feColorMatrix type="saturate" values="${1-t}"/>
      </filter>
    `.trim()}function tc(e={}){let t=ti(e.angle,0);return`
      <filter>
        <feColorMatrix type="hueRotate" values="${t}"/>
      </filter>
    `.trim()}function tg(e={}){let t=ti(e.amount,1),i=1-t;return`
      <filter>
        <feComponentTransfer>
          <feFuncR type="table" tableValues="${t} ${i}"/>
          <feFuncG type="table" tableValues="${t} ${i}"/>
          <feFuncB type="table" tableValues="${t} ${i}"/>
        </feComponentTransfer>
      </filter>
    `.trim()}function tu(e={}){let t=ti(e.amount,1);return`
    <filter>
      <feComponentTransfer>
        <feFuncR type="linear" slope="${t}"/>
        <feFuncG type="linear" slope="${t}"/>
        <feFuncB type="linear" slope="${t}"/>
      </feComponentTransfer>
    </filter>
  `.trim()}function td(e={}){let t=ti(e.amount,1),i=.5-t/2;return`
    <filter>
     <feComponentTransfer>
        <feFuncR type="linear" slope="${t}" intercept="${i}"/>
        <feFuncG type="linear" slope="${t}" intercept="${i}"/>
        <feFuncB type="linear" slope="${t}" intercept="${i}"/>
      </feComponentTransfer>
    </filter>
  `.trim()}(u=ef||(ef={})).presets=Object.assign({},e$),u.presets["flip-x"]=e4,u.presets["flip-y"]=e8,u.presets["flip-xy"]=e7,u.registry=e1.create({type:"background pattern"}),u.registry.register(u.presets,!0),(d=em||(em={})).presets=ez,d.registry=e1.create({type:"filter"}),d.registry.register(d.presets,!0);let tp={},tf={position:tL("x","width","origin")},tm={position:tL("y","height","origin")},ty={position:tL("x","width","corner")},tb={position:tL("y","height","corner")},tv={set:t$("width","width")},tw={set:t$("height","height")},tx={set:t$("rx","width")},tC={set:t$("ry","height")},tE={set:(e=>{let t=t$(e,"width"),i=t$(e,"height");return function(e,r){let s=r.refBBox,n=s.height>s.width?t:i;return e_.Iw.call(n,this,e,r)}})("r")},tP={set(e,{refBBox:t}){let i,r=parseFloat(e),s=e_.GH.isPercentage(e);s&&(r/=100);let n=Math.sqrt(t.height*t.height+t.width*t.width);return Number.isFinite(r)&&(i=s||r>=0&&r<=1?r*n:Math.max(r+n,0)),{r:i}}},tO={set:t$("cx","width")},tA={set:t$("cy","height")},tM={set:tF({resetOffset:!0})},tS={set:tF({resetOffset:!1})},tT={set:tG({resetOffset:!0})},tk={set:tG({resetOffset:!1})},tN=tE,tj=tM,tB=tT,tR=tf,tD=tm,tV=tv,tI=tw;function tL(e,t,i){return(r,{refBBox:s})=>{let n;if(null==r)return null;let o=parseFloat(r),l=e_.GH.isPercentage(r);if(l&&(o/=100),Number.isFinite(o)){let r=s[i];n=l||o>0&&o<1?r[e]+s[t]*o:r[e]+o}let a=new e0.E9;return a[e]=n||0,a}}function t$(e,t){return function(i,{refBBox:r}){let s=parseFloat(i),n=e_.GH.isPercentage(i);n&&(s/=100);let o={};if(Number.isFinite(s)){let i=n||s>=0&&s<=1?s*r[t]:Math.max(s+r[t],0);o[e]=i}return o}}function tz(e,t){let i="x6-shape",r=t&&t.resetOffset;return function(t,{elem:s,refBBox:n}){let o=e_.is.data(s,i);if(!o||o.value!==t){let r=e(t);o={value:t,shape:r,shapeBBox:r.bbox()},e_.is.data(s,i,o)}let l=o.shape.clone(),a=o.shapeBBox.clone(),h=a.getOrigin(),c=n.getOrigin();a.x=c.x,a.y=c.y;let g=n.getMaxScaleToFit(a,c),u=0===a.width||0===n.width?1:g.sx,d=0===a.height||0===n.height?1:g.sy;return l.scale(u,d,h),r&&l.translate(-h.x,-h.y),l}}function tF(e){let t=tz(function(e){return e0.y$.parse(e)},e);return(e,i)=>({d:t(e,i).serialize()})}function tG(e){let t=tz(e=>new e0.aH(e),e);return(e,i)=>({points:t(e,i).serialize()})}let tH={qualify:e_.QK.isPlainObject,set:(e,{view:t})=>`url(#${t.graph.defineGradient(e)})`},tU={qualify:e_.QK.isPlainObject,set(e,{view:t}){let i=t.cell,r=Object.assign({},e);if(i.isEdge()&&"linearGradient"===r.type){let e=t.sourcePoint,s=t.targetPoint;r.id=`gradient-${r.type}-${i.id}`,r.attrs=Object.assign(Object.assign({},r.attrs),{x1:e.x,y1:e.y,x2:s.x,y2:s.y,gradientUnits:"userSpaceOnUse"}),t.graph.defs.remove(r.id)}return`url(#${t.graph.defineGradient(r)})`}},tq={qualify:(e,{attrs:t})=>null==t.textWrap||!e_.QK.isPlainObject(t.textWrap),set(e,{view:t,elem:i,attrs:r}){let s="x6-text",n=e_.is.data(i,s),o=e=>{try{return JSON.parse(e)}catch(t){return e}},l={x:r.x,eol:r.eol,annotations:o(r.annotations),textPath:o(r["text-path"]||r.textPath),textVerticalAnchor:r["text-vertical-anchor"]||r.textVerticalAnchor,displayEmpty:"true"===(r["display-empty"]||r.displayEmpty),lineHeight:r["line-height"]||r.lineHeight},a=r["font-size"]||r.fontSize,h=JSON.stringify([e,l]);if(a&&i.setAttribute("font-size",a),null==n||n!==h){let r=l.textPath;if(null!=r&&"object"==typeof r){let e=r.selector;if("string"==typeof e){let i=t.find(e)[0];i instanceof SVGPathElement&&(e_.is.ensureId(i),l.textPath=Object.assign({"xlink:href":`#${i.id}`},r))}}e_.is.text(i,`${e}`,l),e_.is.data(i,s,h)}}},tW={qualify:e_.QK.isPlainObject,set(e,{view:t,elem:i,attrs:r,refBBox:s}){let n,o=e.width||0;e_.GH.isPercentage(o)?s.width*=parseFloat(o)/100:o<=0?s.width+=o:s.width=o;let l=e.height||0;e_.GH.isPercentage(l)?s.height*=parseFloat(l)/100:l<=0?s.height+=l:s.height=l;let a=e.text;null==a&&(a=r.text||(null==i?void 0:i.textContent)),n=null!=a?e_.is.breakText(`${a}`,s,{"font-weight":r["font-weight"]||r.fontWeight,"font-size":r["font-size"]||r.fontSize,"font-family":r["font-family"]||r.fontFamily,lineHeight:r.lineHeight},{ellipsis:e.ellipsis}):"",e_.Iw.call(tq.set,this,n,{view:t,elem:i,attrs:r,refBBox:s,cell:t.cell})}},tK=(e,{attrs:t})=>void 0!==t.text,tJ={qualify:tK},tQ={qualify:tK},tX={qualify:tK},tY={qualify:tK},tZ={qualify:tK},t_={qualify:tK},t0={qualify:(e,{elem:t})=>t instanceof SVGElement,set(e,{elem:t}){let i="x6-title",r=`${e}`,s=e_.is.data(t,i);if(null==s||s!==r){e_.is.data(t,i,r);let e=t.firstChild;if(e&&"TITLE"===e.tagName.toUpperCase())e.textContent=r;else{let i=document.createElementNS(t.namespaceURI,"title");i.textContent=r,t.insertBefore(i,e)}}}},t1={offset:t9("x","width","right")},t2={offset:t9("y","height","bottom")},t3={offset:(e,{refBBox:t})=>e?{x:-t.x,y:-t.y}:{x:0,y:0}};function t9(e,t,i){return(r,{refBBox:s})=>{let n,o=new e0.E9;return n="middle"===r?s[t]/2:r===i?s[t]:"number"==typeof r&&Number.isFinite(r)?r>-1&&r<1?-s[t]*r:-r:e_.GH.isPercentage(r)?s[t]*parseFloat(r)/100:0,o[e]=-(s[e]+n),o}}let t6={qualify:e_.QK.isPlainObject,set(e,{elem:t}){e_.is.css(t,e)}},t5={set(e,{elem:t}){t.innerHTML=`${e}`}},t4={qualify:e_.QK.isPlainObject,set:(e,{view:t})=>`url(#${t.graph.defineFilter(e)})`},t8={set:e=>null!=e&&"object"==typeof e&&e.id?e.id:e};function t7(e,t,i){let r,s;"object"==typeof t?(r=t.x,s=t.y):(r=t,s=i);let n=e0.y$.parse(e),o=n.bbox();if(o){let e=-o.height/2-o.y,t=-o.width/2-o.x;"number"==typeof r&&(t-=r),"number"==typeof s&&(e-=s),n.translate(t,e)}return n.serialize()}var ie=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};let it=e=>{var{size:t,width:i,height:r,offset:s,open:n}=e;return ir({size:t,width:i,height:r,offset:s},!0===n,!0,void 0,ie(e,["size","width","height","offset","open"]))},ii=e=>{var{size:t,width:i,height:r,offset:s,factor:n}=e;return ir({size:t,width:i,height:r,offset:s},!1,!1,n,ie(e,["size","width","height","offset","factor"]))};function ir(e,t,i,r=3/4,s={}){let n=e.size||10,o=e.width||n,l=e.height||n,a=new e0.y$,h={};if(t)a.moveTo(o,0).lineTo(0,l/2).lineTo(o,l),h.fill="none";else{if(a.moveTo(0,l/2),a.lineTo(o,0),!i){let e=e_.GH.clamp(r,0,1);a.lineTo(o*e,l/2)}a.lineTo(o,l),a.close()}return Object.assign(Object.assign(Object.assign({},h),s),{tagName:"path",d:t7(a.serialize(),{x:null!=e.offset?e.offset:-o/2})})}var is=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};let io=e=>{var{size:t,width:i,height:r,offset:s}=e,n=is(e,["size","width","height","offset"]);let o=t||10,l=i||o,a=r||o,h=new e0.y$;return h.moveTo(0,a/2).lineTo(l/2,0).lineTo(l,a/2).lineTo(l/2,a).close(),Object.assign(Object.assign({},n),{tagName:"path",d:t7(h.serialize(),null==s?-l/2:s)})};var il=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};let ia=e=>{var{d:t,offsetX:i,offsetY:r}=e;return Object.assign(Object.assign({},il(e,["d","offsetX","offsetY"])),{tagName:"path",d:t7(t,i,r)})};var ih=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};let ic=e=>{var{size:t,width:i,height:r,offset:s}=e,n=ih(e,["size","width","height","offset"]);let o=t||10,l=i||o,a=r||o,h=new e0.y$;return h.moveTo(0,0).lineTo(l,a).moveTo(0,a).lineTo(l,0),Object.assign(Object.assign({},n),{tagName:"path",fill:"none",d:t7(h.serialize(),s||-l/2)})};var ig=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};let iu=e=>{var{width:t,height:i,offset:r,open:s,flip:n}=e,o=ig(e,["width","height","offset","open","flip"]);let l=i||6,a=t||10,h=Object.assign(Object.assign({},o),{tagName:"path"});!0===n&&(l=-l);let c=new e0.y$;return c.moveTo(0,l).lineTo(a,0),!0===s?h.fill="none":(c.lineTo(a,l),c.close()),h.d=t7(c.serialize(),{x:r||-a/2,y:l/2}),h};var id=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};let ip=e=>{var{r:t}=e,i=id(e,["r"]);let r=t||5;return Object.assign(Object.assign({cx:r},i),{tagName:"circle",r:r})},im=e=>{var{r:t}=e,i=id(e,["r"]);let r=t||5,s=new e0.y$;return s.moveTo(r,0).lineTo(r,2*r),s.moveTo(0,r).lineTo(2*r,r),{children:[Object.assign(Object.assign({},ip({r:r})),{fill:"none"}),Object.assign(Object.assign({},i),{tagName:"path",d:t7(s.serialize(),-r)})]}};var iy=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};let ib=e=>{var{rx:t,ry:i}=e,r=iy(e,["rx","ry"]);let s=t||5;return Object.assign(Object.assign({cx:s},r),{tagName:"ellipse",rx:s,ry:i||5})};(p=ey||(ey={})).presets=eF,p.registry=e1.create({type:"marker"}),p.registry.register(p.presets,!0),(ey||(ey={})).normalize=t7;var iv=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};function iw(e){return"string"==typeof e||e_.QK.isPlainObject(e)}let ix={qualify:iw,set:(e,{view:t,attrs:i})=>iP("marker-start",e,t,i)},iC={qualify:iw,set:(e,{view:t,attrs:i})=>iP("marker-end",e,t,i,{transform:"rotate(180)"})},iE={qualify:iw,set:(e,{view:t,attrs:i})=>iP("marker-mid",e,t,i)};function iP(e,t,i,r,s={}){let n="string"==typeof t?{name:t}:t,{name:o,args:l}=n,a=iv(n,["name","args"]),h=a;if(o&&"string"==typeof o){let e=ey.registry.get(o);if(!e)return ey.registry.onNotFound(o);h=e(Object.assign(Object.assign({},a),l))}let c=Object.assign(Object.assign(Object.assign({},function(e,t){let i={},r=e.stroke;"string"==typeof r&&(i.stroke=r,i.fill=r);let s=e.strokeOpacity;if(null==s&&(s=e["stroke-opacity"]),null==s&&(s=e.opacity),null!=s&&(i["stroke-opacity"]=s,i["fill-opacity"]=s),"marker-mid"!==t){let r=parseFloat(e.strokeWidth||e["stroke-width"]);if(Number.isFinite(r)&&r>1){let e=Math.ceil(r/2);i.refX="marker-start"===t?e:-e}}return i}(r,e)),s),h);return{[e]:`url(#${i.graph.defineMarker(c)})`}}let iO=(e,{view:t})=>t.cell.isEdge(),iA={qualify:iO,set(e,t){var i,r,s,n;let o,l=t.view,a=e.reverse||!1,h=e.stubs||0;if(Number.isFinite(h)&&0!==h)if(a){let e,t,a=l.getConnectionLength()||0;h<0?(e=(a+h)/2,t=-h):(e=h,t=a-2*h);let c=l.getConnection();o=null==(n=null==(s=null==(r=null==(i=null==c?void 0:c.divideAtLength(e))?void 0:i[1])?void 0:r.divideAtLength(t))?void 0:s[0])?void 0:n.serialize()}else{let e;e=h<0?((l.getConnectionLength()||0)+h)/2:h;let t=l.getConnection();if(t){let i=t.divideAtLength(e),r=t.divideAtLength(-e);i&&r&&(o=`${i[0].serialize()} ${r[1].serialize()}`)}}return{d:o||l.getConnectionPathData()}}},iM={qualify:iO,set:iB("getTangentAtLength",{rotate:!0})},iS={qualify:iO,set:iB("getTangentAtLength",{rotate:!1})},iT={qualify:iO,set:iB("getTangentAtRatio",{rotate:!0})},ik={qualify:iO,set:iB("getTangentAtRatio",{rotate:!1})},iN=iM,ij=iT;function iB(e,t){let i={x:1,y:0};return(r,s)=>{let n,o,l=s.view,a=l[e](Number(r));return(a?(o=t.rotate?a.vector().vectorAngle(i):0,n=a.start):(n=l.path.start,o=0),0===o)?{transform:`translate(${n.x},${n.y}')`}:{transform:`translate(${n.x},${n.y}') rotate(${o})`}}}(eb||(eb={})).isValidDefinition=function(e,t,i){return!!(null!=e&&("string"==typeof e||"function"!=typeof e.qualify||e_.Iw.call(e.qualify,this,t,i)))||!1},(f=eb||(eb={})).presets=Object.assign(Object.assign({},{xlinkHref:"xlink:href",xlinkShow:"xlink:show",xlinkRole:"xlink:role",xlinkType:"xlink:type",xlinkArcrole:"xlink:arcrole",xlinkTitle:"xlink:title",xlinkActuate:"xlink:actuate",xmlSpace:"xml:space",xmlBase:"xml:base",xmlLang:"xml:lang",preserveAspectRatio:"preserveAspectRatio",requiredExtension:"requiredExtension",requiredFeatures:"requiredFeatures",systemLanguage:"systemLanguage",externalResourcesRequired:"externalResourceRequired"}),eG),f.registry=e1.create({type:"attribute definition"}),f.registry.register(f.presets,!0);let iR={prefixCls:"x6",autoInsertCSS:!0,useCSSSelector:!0,prefix:e=>`${iR.prefixCls}-${e}`},iD=iR.prefix("highlighted"),iV={highlight(e,t,i){let r=i&&i.className||iD;e_.is.addClass(t,r)},unhighlight(e,t,i){let r=i&&i.className||iD;e_.is.removeClass(t,r)}},iI=iR.prefix("highlight-opacity"),iL={highlight(e,t){e_.is.addClass(t,iI)},unhighlight(e,t){e_.is.removeClass(t,iI)}};!function(e){function t(e,t){let i=e_.is.createSVGPoint(e.x,e.y).matrixTransform(t);return new e0.E9(i.x,i.y)}function i(e,t){let i=e_.is.createSvgElement("svg").createSVGPoint();i.x=e.x,i.y=e.y;let r=i.matrixTransform(t);i.x=e.x+e.width,i.y=e.y;let s=i.matrixTransform(t);i.x=e.x+e.width,i.y=e.y+e.height;let n=i.matrixTransform(t);i.x=e.x,i.y=e.y+e.height;let o=i.matrixTransform(t),l=Math.min(r.x,s.x,n.x,o.x),a=Math.max(r.x,s.x,n.x,o.x),h=Math.min(r.y,s.y,n.y,o.y),c=Math.max(r.y,s.y,n.y,o.y);return new e0.Ae(l,h,a-l,c-h)}function r(e,t={}){let n;if(!e.ownerSVGElement||!e_.is.isSVGGraphicsElement(e)){if(e_.is.isHTMLElement(e)){let{left:t,top:i,width:r,height:n}=s(e);return new e0.Ae(t,i,r,n)}return new e0.Ae(0,0,0,0)}let o=t.target;if(!t.recursive){try{n=e.getBBox()}catch(t){n={x:e.clientLeft,y:e.clientTop,width:e.clientWidth,height:e.clientHeight}}return o?i(n,e_.is.getTransformToElement(e,o)):e0.Ae.create(n)}{let t=e.childNodes,i=t.length;if(0===i)return r(e,{target:o});o||(o=e);for(let e=0;e<i;e+=1){let i,s=t[e];i=0===s.childNodes.length?r(s,{target:o}):r(s,{target:o,recursive:!0}),n=n?n.union(i):i}return n}}function s(e){let t=0,i=0,r=0,s=0;if(e){let n=e;for(;n;)t+=n.offsetLeft,i+=n.offsetTop,(n=n.offsetParent)&&(t+=parseInt(e_.is.getComputedStyle(n,"borderLeft"),10),i+=parseInt(e_.is.getComputedStyle(n,"borderTop"),10));r=e.offsetWidth,s=e.offsetHeight}return{left:t,top:i,width:r,height:s}}function n(e){let t=t=>{let i=e.getAttribute(t),r=i?parseFloat(i):0;return Number.isNaN(r)?0:r};switch(e instanceof SVGElement&&e.nodeName.toLowerCase()){case"rect":return new e0.Ae(t("x"),t("y"),t("width"),t("height"));case"circle":return new e0.Pj(t("cx"),t("cy"),t("r"),t("r"));case"ellipse":return new e0.Pj(t("cx"),t("cy"),t("rx"),t("ry"));case"polyline":{let t=e_.is.getPointsFromSvgElement(e);return new e0.aH(t)}case"polygon":{let t=e_.is.getPointsFromSvgElement(e);return t.length>1&&t.push(t[0]),new e0.aH(t)}case"path":{let t=e.getAttribute("d");return e0.y$.isValid(t)||(t=e0.y$.normalize(t)),e0.y$.parse(t)}case"line":return new e0.x1(t("x1"),t("y1"),t("x2"),t("y2"))}return r(e)}function o(e){if(null==e)return null;let t=e;do{let e=t.tagName;if("string"!=typeof e)return null;if(e=e.toUpperCase(),e_.is.hasClass(t,"x6-port"))t=t.nextElementSibling;else if("G"===e)t=t.firstElementChild;else if("TITLE"===e)t=t.nextElementSibling;else break}while(t);return t}e.normalizeMarker=t7,e.transformPoint=t,e.transformLine=function(e,i){return new e0.x1(t(e.start,i),t(e.end,i))},e.transformPolyline=function(e,i){let r=e instanceof e0.aH?e.points:e;return Array.isArray(r)||(r=[]),new e0.aH(r.map(e=>t(e,i)))},e.transformRectangle=i,e.bbox=function(e,t,r){let s,n=e.ownerSVGElement;if(!n)return new e0.Ae(0,0,0,0);try{s=e.getBBox()}catch(t){s={x:e.clientLeft,y:e.clientTop,width:e.clientWidth,height:e.clientHeight}}return t?e0.Ae.create(s):i(s,e_.is.getTransformToElement(e,r||n))},e.getBBox=r,e.getBoundingOffsetRect=s,e.toGeometryShape=n,e.translateAndAutoOrient=function(e,t,i,s){let n=e0.E9.create(t),o=e0.E9.create(i);s||(s=e instanceof SVGSVGElement?e:e.ownerSVGElement);let l=e_.is.scale(e);e.setAttribute("transform","");let a=r(e,{target:s}).scale(l.sx,l.sy),h=e_.is.createSVGTransform();h.setTranslate(-a.x-a.width/2,-a.y-a.height/2);let c=e_.is.createSVGTransform(),g=n.angleBetween(o,n.clone().translate(1,0));g&&c.setRotate(g,0,0);let u=e_.is.createSVGTransform(),d=n.clone().move(o,a.width/2);u.setTranslate(2*n.x-d.x,2*n.y-d.y);let p=e_.is.getTransformToElement(e,s),f=e_.is.createSVGTransform();f.setMatrix(u.matrix.multiply(c.matrix.multiply(h.matrix.multiply(p.scale(l.sx,l.sy))))),e.setAttribute("transform",e_.is.matrixToTransformString(f.matrix))},e.findShapeNode=o,e.getBBoxV2=function(e){let t=o(e);if(!e_.is.isSVGGraphicsElement(t)){if(e_.is.isHTMLElement(e)){let{left:t,top:i,width:r,height:n}=s(e);return new e0.Ae(t,i,r,n)}return new e0.Ae(0,0,0,0)}return n(t).bbox()||e0.Ae.create()}}(ev||(ev={}));let i$={padding:3,rx:0,ry:0,attrs:{"stroke-width":3,stroke:"#FEB663"}},iz={highlight(e,t,i){let r,s,n=ew.getHighlighterId(t,i);if(ew.hasCache(n))return;i=e_.QK.defaultsDeep({},i,i$);let o=e_.OW.create(t);try{r=o.toPathData()}catch(e){s=ev.bbox(o.node,!0),r=e_.is.rectToPathData(Object.assign(Object.assign({},i),s))}let l=e_.is.createSvgElement("path");if(e_.is.attr(l,Object.assign({d:r,"pointer-events":"none","vector-effect":"non-scaling-stroke",fill:"none"},i.attrs?e_.is.kebablizeAttrs(i.attrs):null)),e.isEdgeElement(t))e_.is.attr(l,"d",e.getConnectionPathData());else{let t=o.getTransformToElement(e.container),r=i.padding;if(r){null==s&&(s=ev.bbox(o.node,!0));let e=s.x+s.width/2,i=s.y+s.height/2,n=Math.max((s=ev.transformRectangle(s,t)).width,1),l=Math.max(s.height,1),a=(n+r)/n,h=(l+r)/l,c=e_.is.createSVGMatrix({a:a,b:0,c:0,d:h,e:e-a*e,f:i-h*i});t=t.multiply(c)}e_.is.transform(l,t)}e_.is.addClass(l,iR.prefix("highlight-stroke"));let a=e.cell,h=()=>ew.removeHighlighter(n);a.on("removed",h),a.model&&a.model.on("reseted",h),e.container.appendChild(l),ew.setCache(n,l)},unhighlight(e,t,i){ew.removeHighlighter(ew.getHighlighterId(t,i))}};var iF=ew||(ew={});iF.getHighlighterId=function(e,t){return e_.is.ensureId(e),e.id+JSON.stringify(t)};let iG={};function iH(e,t={}){return new e0.E9(e_.GH.normalizePercentage(t.x,e.width),e_.GH.normalizePercentage(t.y,e.height))}function iU(e,t,i){return Object.assign({angle:t,position:e.toJSON()},i)}iF.setCache=function(e,t){iG[e]=t},iF.hasCache=function(e){return null!=iG[e]},iF.removeHighlighter=function(e){let t=iG[e];t&&(e_.is.remove(t),delete iG[e])},(ex||(ex={})).check=function(e,t){if("function"!=typeof t.highlight)throw Error(`Highlighter '${e}' is missing required \`highlight()\` method`);if("function"!=typeof t.unhighlight)throw Error(`Highlighter '${e}' is missing required \`unhighlight()\` method`)},(m=ex||(ex={})).presets=eH,m.registry=e1.create({type:"highlighter"}),m.registry.register(m.presets,!0);let iq=(e,t)=>e.map(({x:e,y:i,angle:r})=>iU(iH(t,{x:e,y:i}),r||0)),iW=(e,t,i)=>{let r=i.start||0,s=i.step||20;return iJ(e,t,r,(e,t)=>(e+.5-t/2)*s)},iK=(e,t,i)=>{let r=i.start||0,s=i.step||360/e.length;return iJ(e,t,r,e=>e*s)};function iJ(e,t,i,r){let s=t.getCenter(),n=t.getTopCenter(),o=t.width/t.height,l=e0.Pj.fromRect(t),a=e.length;return e.map((e,t)=>{let h=i+r(t,a),c=n.clone().rotate(-h,s).scale(o,1,s),g=e.compensateRotate?-l.tangentTheta(c):0;return(e.dx||e.dy)&&c.translate(e.dx||0,e.dy||0),e.dr&&c.move(s,e.dr),iU(c.round(),g,e)})}var iQ=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};let iX=(e,t,i)=>i1(e,iH(t,i.start||t.getOrigin()),iH(t,i.end||t.getCorner()),i),iY=(e,t,i)=>i1(e,t.getTopLeft(),t.getBottomLeft(),i),iZ=(e,t,i)=>i1(e,t.getTopRight(),t.getBottomRight(),i),i_=(e,t,i)=>i1(e,t.getTopLeft(),t.getTopRight(),i),i0=(e,t,i)=>i1(e,t.getBottomLeft(),t.getBottomRight(),i);function i1(e,t,i,r){let s=new e0.x1(t,i),n=e.length;return e.map((e,t)=>{var{strict:i}=e,o=iQ(e,["strict"]);let l=i||r.strict?(t+1)/(n+1):(t+.5)/n,a=s.pointAt(l);return(o.dx||o.dy)&&a.translate(o.dx||0,o.dy||0),iU(a.round(),0,o)})}(y=eC||(eC={})).presets=eU,y.registry=e1.create({type:"port layout"}),y.registry.register(y.presets,!0);let i2={position:{x:0,y:0},angle:0,attrs:{".":{y:"0","text-anchor":"start"}}};function i3(e,t){let{x:i,y:r,angle:s,attrs:n}=t||{};return e_.QK.defaultsDeep({},{angle:s,attrs:n,position:{x:i,y:r}},e,i2)}let i9=(e,t,i)=>i3({position:t.getTopLeft()},i),i6=(e,t,i)=>i3({position:{x:-15,y:0},attrs:{".":{y:".3em","text-anchor":"end"}}},i),i5=(e,t,i)=>i3({position:{x:15,y:0},attrs:{".":{y:".3em","text-anchor":"start"}}},i),i4=(e,t,i)=>i3({position:{x:0,y:-15},attrs:{".":{"text-anchor":"middle"}}},i),i8=(e,t,i)=>i3({position:{x:0,y:15},attrs:{".":{y:".6em","text-anchor":"middle"}}},i),i7=(e,t,i)=>rr(e,t,!1,i),re=(e,t,i)=>rr(e,t,!0,i),rt=(e,t,i)=>rs(e,t,!1,i),ri=(e,t,i)=>rs(e,t,!0,i);function rr(e,t,i,r){let s,n,o,l,a=null!=r.offset?r.offset:15,h=t.getCenter().theta(e),c=rn(t),g=0;return h<c[1]||h>c[2]?(s=".3em",n=a,o=0,l="start"):h<c[0]?(s="0",n=0,o=-a,i?(g=-90,l="start"):l="middle"):h<c[3]?(s=".3em",n=-a,o=0,l="end"):(s=".6em",n=0,o=a,i?(g=90,l="start"):l="middle"),i3({position:{x:Math.round(n),y:Math.round(o)},angle:g,attrs:{".":{y:s,"text-anchor":l}}},r)}function rs(e,t,i,r){let s,n,o,l,a=null!=r.offset?r.offset:15,h=t.getCenter().theta(e),c=rn(t),g=0;return h<c[1]||h>c[2]?(s=".3em",n=-a,o=0,l="end"):h<c[0]?(s=".6em",n=0,o=a,i?(g=90,l="start"):l="middle"):h<c[3]?(s=".3em",n=a,o=0,l="start"):(s="0em",n=0,o=-a,i?(g=-90,l="start"):l="middle"),i3({position:{x:Math.round(n),y:Math.round(o)},angle:g,attrs:{".":{y:s,"text-anchor":l}}},r)}function rn(e){let t=e.getCenter(),i=t.theta(e.getTopLeft()),r=t.theta(e.getBottomLeft()),s=t.theta(e.getBottomRight());return[i,t.theta(e.getTopRight()),s,r]}let ro=(e,t,i)=>ra(e.diff(t.getCenter()),!1,i),rl=(e,t,i)=>ra(e.diff(t.getCenter()),!0,i);function ra(e,t,i){let r,s=null!=i.offset?i.offset:20,n=new e0.E9(0,0),o=-e.theta(n),l=e.clone().move(n,s).diff(e).round(),a=".3em",h=o;return(o+90)%180==0?(r=t?"end":"middle",t||-270!==o||(a="0em")):o>-270&&o<-90?(r="start",h=o-180):r="end",i3({position:l.round().toJSON(),angle:t?h:0,attrs:{".":{y:a,"text-anchor":r}}},i)}(b=eE||(eE={})).presets=eq,b.registry=e1.create({type:"port label layout"}),b.registry.register(b.presets,!0);class rh extends e_.ew{get priority(){return 2}get disposeContainer(){return!0}constructor(){super(),this.cid=eP.uniqueId(),rh.views[this.cid]=this}confirmUpdate(e,t){return 0}empty(e=this.container){return e_.is.empty(e),this}unmount(e=this.container){return e_.is.remove(e),this}remove(e=this.container){return e===this.container?(this.removeEventListeners(document),this.onRemove(),delete rh.views[this.cid],this.disposeContainer&&this.unmount(e)):this.unmount(e),this}onRemove(){}setClass(e,t=this.container){t.classList.value=Array.isArray(e)?e.join(" "):e}addClass(e,t=this.container){return e_.is.addClass(t,Array.isArray(e)?e.join(" "):e),this}removeClass(e,t=this.container){return e_.is.removeClass(t,Array.isArray(e)?e.join(" "):e),this}setStyle(e,t=this.container){return e_.is.css(t,e),this}setAttrs(e,t=this.container){return null!=e&&null!=t&&e_.is.attr(t,e),this}findAttr(e,t=this.container){let i=t;for(;i&&1===i.nodeType;){let t=i.getAttribute(e);if(null!=t)return t;if(i===this.container)break;i=i.parentNode}return null}find(e,t=this.container,i=this.selectors){return rh.find(e,t,i).elems}findOne(e,t=this.container,i=this.selectors){let r=this.find(e,t,i);return r.length>0?r[0]:null}findByAttr(e,t=this.container){let i=t;for(;i&&i.getAttribute;){let t=i.getAttribute(e);if((null!=t||i===this.container)&&"false"!==t)return i;i=i.parentNode}return null}getSelector(e,t){let i;if(e===this.container)return"string"==typeof t&&(i=`> ${t}`),i;if(e){let r=e_.is.index(e)+1;i=`${e.tagName.toLowerCase()}:nth-child(${r})`,t&&(i+=` > ${t}`),i=this.getSelector(e.parentNode,i)}return i}prefixClassName(e){return iR.prefix(e)}delegateEvents(e,t){if(null==e)return this;t||this.undelegateEvents();let i=/^(\S+)\s*(.*)$/;return Object.keys(e).forEach(t=>{let r=t.match(i);if(null==r)return;let s=this.getEventHandler(e[t]);"function"==typeof s&&this.delegateEvent(r[1],r[2],s)}),this}undelegateEvents(){return e_.is.Event.off(this.container,this.getEventNamespace()),this}delegateDocumentEvents(e,t){return this.addEventListeners(document,e,t),this}undelegateDocumentEvents(){return this.removeEventListeners(document),this}delegateEvent(e,t,i){return e_.is.Event.on(this.container,e+this.getEventNamespace(),t,i),this}undelegateEvent(e,t,i){let r=e+this.getEventNamespace();return null==t?e_.is.Event.off(this.container,r):"string"==typeof t?e_.is.Event.off(this.container,r,t,i):e_.is.Event.off(this.container,r,t),this}addEventListeners(e,t,i){if(null==t)return this;let r=this.getEventNamespace();return Object.keys(t).forEach(s=>{let n=this.getEventHandler(t[s]);"function"==typeof n&&e_.is.Event.on(e,s+r,i,n)}),this}removeEventListeners(e){return null!=e&&e_.is.Event.off(e,this.getEventNamespace()),this}getEventNamespace(){return`.${iR.prefixCls}-event-${this.cid}`}getEventHandler(e){let t;if("string"==typeof e){let i=this[e];"function"==typeof i&&(t=(...e)=>i.call(this,...e))}else t=(...t)=>e.call(this,...t);return t}getEventTarget(e,t={}){let{target:i,type:r,clientX:s=0,clientY:n=0}=e;return t.fromPoint||"touchmove"===r||"touchend"===r?document.elementFromPoint(s,n):i}stopPropagation(e){return this.setEventData(e,{propagationStopped:!0}),this}isPropagationStopped(e){return!0===this.getEventData(e).propagationStopped}getEventData(e){return this.eventData(e)}setEventData(e,t){return this.eventData(e,t)}eventData(e,t){if(null==e)throw TypeError("Event object required");let i=e.data,r=`__${this.cid}__`;return null==t?null==i?{}:i[r]||{}:(null==i&&(i=e.data={}),null==i[r]?i[r]=Object.assign({},t):i[r]=Object.assign(Object.assign({},i[r]),t),i[r])}normalizeEvent(e){return rh.normalizeEvent(e)}dispose(){this.remove()}}!function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);n>3&&o&&Object.defineProperty(t,i,o)}([rh.dispose()],rh.prototype,"dispose",null),(v=rh||(rh={})).createElement=function(e,t){return t?e_.is.createSvgElement(e||"g"):e_.is.createElementNS(e||"div")},v.find=function(e,t,i){if(!e||"."===e)return{elems:[t]};if(i){let t=i[e];if(t)return{elems:Array.isArray(t)?t:[t]}}if(iR.useCSSSelector){let i=e.includes(">")?`:scope ${e}`:e;return{isCSSSelector:!0,elems:Array.prototype.slice.call(t.querySelectorAll(i))}}return{elems:[]}},v.normalizeEvent=function(e){let t=e,i=e.originalEvent,r=i&&i.changedTouches&&i.changedTouches[0];if(r){for(let t in e)void 0===r[t]&&(r[t]=e[t]);t=r}return t},(w=rh||(rh={})).views={},w.getView=function(e){return w.views[e]||null},x=eP||(eP={}),n=0,x.uniqueId=function(){let e=`v${n}`;return n+=1,e};class rc{constructor(e){this.view=e,this.clean()}clean(){this.elemCache&&this.elemCache.dispose(),this.elemCache=new e_.Xy,this.pathCache={}}get(e){return this.elemCache.has(e)||this.elemCache.set(e,{}),this.elemCache.get(e)}getData(e){let t=this.get(e);return t.data||(t.data={}),t.data}getMatrix(e){let t=this.get(e);if(null==t.matrix){let i=this.view.container;t.matrix=e_.is.getTransformToParentElement(e,i)}return e_.is.createSVGMatrix(t.matrix)}getShape(e){let t=this.get(e);return null==t.shape&&(t.shape=ev.toGeometryShape(e)),t.shape.clone()}getBoundingRect(e){let t=this.get(e);return null==t.boundingRect&&(t.boundingRect=ev.getBBoxV2(e)),t.boundingRect.clone()}}!function(e){function t(e){return null!=e&&"string"==typeof e}function i(e,t={ns:e_.is.ns.svg}){let r=document.createDocumentFragment(),s={},n={},o=[{markup:Array.isArray(e)?e:[e],parent:r,ns:t.ns}];for(;o.length>0;){let e=o.pop(),t=e.ns||e_.is.ns.svg,i=e.markup,r=e.parent;i.forEach(e=>{let i=e.tagName;if(!i)throw TypeError("Invalid tagName");e.ns&&(t=e.ns);let l=t?e_.is.createElementNS(i,t):e_.is.createElement(i),a=e.attrs;a&&e_.is.attr(l,e_.is.kebablizeAttrs(a));let h=e.style;h&&e_.is.css(l,h);let c=e.className;null!=c&&l.setAttribute("class",Array.isArray(c)?c.join(" "):c),e.textContent&&(l.textContent=e.textContent);let g=e.selector;if(null!=g){if(n[g])throw TypeError("Selector must be unique");n[g]=l}if(e.groupSelector){let t=e.groupSelector;Array.isArray(t)||(t=[t]),t.forEach(e=>{s[e]||(s[e]=[]),s[e].push(l)})}r.appendChild(l);let u=e.children;Array.isArray(u)&&o.push({ns:t,markup:u,parent:l})})}return Object.keys(s).forEach(e=>{if(n[e])throw Error("Ambiguous group selector");n[e]=s[e]}),{fragment:r,selectors:n,groups:s}}function r(e){return e instanceof SVGElement?e_.is.createSvgElement("g"):e_.is.createElement("div")}e.isJSONMarkup=function(e){return null!=e&&!t(e)},e.isStringMarkup=t,e.clone=function(e){return null==e||t(e)?e:e_.QK.cloneDeep(e)},e.sanitize=function(e){return`${e}`.trim().replace(/[\r|\n]/g," ").replace(/>\s+</g,"><")},e.parseJSONMarkup=i,e.renderMarkup=function(e){if(t(e)){let t=e_.OW.createVectors(e),i=t.length;if(1===i)return{elem:t[0].node};if(i>1){let e=r(t[0].node);return t.forEach(t=>{e.appendChild(t.node)}),{elem:e}}return{}}let s=i(e),n=s.fragment,o=null;return n.childNodes.length>1?(o=r(n.firstChild)).appendChild(n):o=n.firstChild,{elem:o,selectors:s.selectors}},e.parseLabelStringMarkup=function(e){let t=e_.OW.createVectors(e),i=document.createDocumentFragment();for(let e=0,r=t.length;e<r;e+=1){let r=t[e].node;i.appendChild(r)}return{fragment:i,selectors:{}}}}(eO||(eO={})),(eO||(eO={})).getSelector=function e(t,i,r){if(null!=t){let s,n=t.tagName.toLowerCase();if(t===i)return"string"==typeof r?`> ${n} > ${r}`:`> ${n}`;let o=t.parentNode;if(o&&o.childNodes.length>1){let e=e_.is.index(t)+1;s=`${n}:nth-child(${e})`}else s=n;return r&&(s+=` > ${r}`),e(t.parentNode,i,s)}return r},(C=eO||(eO={})).getPortContainerMarkup=function(){return"g"},C.getPortMarkup=function(){return{tagName:"circle",selector:"circle",attrs:{r:10,fill:"#FFFFFF",stroke:"#000000"}}},C.getPortLabelMarkup=function(){return{tagName:"text",selector:"text",attrs:{fill:"#000000"}}},(eO||(eO={})).getEdgeMarkup=function(){return[{tagName:"path",selector:"wrap",groupSelector:"lines",attrs:{fill:"none",cursor:"pointer",stroke:"transparent",strokeLinecap:"round"}},{tagName:"path",selector:"line",groupSelector:"lines",attrs:{fill:"none",pointerEvents:"none"}}]},(eO||(eO={})).getForeignObjectMarkup=function(e=!1){return{tagName:"foreignObject",selector:"fo",children:[{ns:e_.is.ns.xhtml,tagName:"body",selector:"foBody",attrs:{xmlns:e_.is.ns.xhtml},style:{width:"100%",height:"100%",background:"transparent"},children:e?[]:[{tagName:"div",selector:"foContent",style:{width:"100%",height:"100%"}}]}]}};class rg{constructor(e){this.view=e}get cell(){return this.view.cell}getDefinition(e){return this.cell.getAttrDefinition(e)}processAttrs(e,t){let i,r,s,n,o=[];return Object.keys(t).forEach(r=>{let s=t[r],n=this.getDefinition(r),l=e_.Iw.call(eb.isValidDefinition,this.view,n,s,{elem:e,attrs:t,cell:this.cell,view:this.view});n&&l?"string"==typeof n?(null==i&&(i={}),i[n]=s):null!==s&&o.push({name:r,definition:n}):(null==i&&(i={}),i[e_.is.CASE_SENSITIVE_ATTR.includes(r)?r:e_.kf.kebabCase(r)]=s)}),o.forEach(({name:e,definition:i})=>{let o=t[e];"function"==typeof i.set&&(null==r&&(r={}),r[e]=o),"function"==typeof i.offset&&(null==s&&(s={}),s[e]=o),"function"==typeof i.position&&(null==n&&(n={}),n[e]=o)}),{raw:t,normal:i,set:r,offset:s,position:n}}mergeProcessedAttrs(e,t){e.set=Object.assign(Object.assign({},e.set),t.set),e.position=Object.assign(Object.assign({},e.position),t.position),e.offset=Object.assign(Object.assign({},e.offset),t.offset);let i=e.normal&&e.normal.transform;null!=i&&t.normal&&(t.normal.transform=i),e.normal=t.normal}findAttrs(e,t,i,r){let s=[],n=new e_.Xy;return Object.keys(e).forEach(o=>{let l=e[o];if(!e_.QK.isPlainObject(l))return;let{isCSSSelector:a,elems:h}=rh.find(o,t,r);i[o]=h;for(let e=0,t=h.length;e<t;e+=1){let i=h[e],c=r&&r[o]===i,g=n.get(i);if(g){g.array||(s.push(i),g.array=!0,g.attrs=[g.attrs],g.priority=[g.priority]);let e=g.attrs,r=g.priority;if(c)e.unshift(l),r.unshift(-1);else{let i=e_.RO.sortedIndex(r,a?-1:t);e.splice(i,0,l),r.splice(i,0,t)}}else n.set(i,{elem:i,attrs:l,priority:c?-1:t,array:!1})}}),s.forEach(e=>{let t=n.get(e),i=t.attrs;t.attrs=i.reduceRight((e,t)=>e_.QK.merge(e,t),{})}),n}updateRelativeAttrs(e,t,i){let r=t.raw||{},s=t.normal||{},n=t.set,o=t.position,l=t.offset,a=()=>({elem:e,cell:this.cell,view:this.view,attrs:r,refBBox:i.clone()});if(null!=n&&Object.keys(n).forEach(e=>{let t=n[e],i=this.getDefinition(e);if(null!=i){let r=e_.Iw.call(i.set,this.view,t,a());"object"==typeof r?s=Object.assign(Object.assign({},s),r):null!=r&&(s[e]=r)}}),e instanceof HTMLElement)return void this.view.setAttrs(s,e);let h=s.transform,c=h?`${h}`:null,g=e_.is.transformStringToMatrix(c),u=new e0.E9(g.e,g.f);h&&(delete s.transform,g.e=0,g.f=0);let d=!1;null!=o&&Object.keys(o).forEach(e=>{let t=o[e],i=this.getDefinition(e);if(null!=i){let e=e_.Iw.call(i.position,this.view,t,a());null!=e&&(d=!0,u.translate(e0.E9.create(e)))}}),this.view.setAttrs(s,e);let p=!1;if(null!=l){let t=this.view.getBoundingRectOfElement(e);if(t.width>0&&t.height>0){let i=ev.transformRectangle(t,g);Object.keys(l).forEach(t=>{let s=l[t],n=this.getDefinition(t);if(null!=n){let t=e_.Iw.call(n.offset,this.view,s,{elem:e,cell:this.cell,view:this.view,attrs:r,refBBox:i});null!=t&&(p=!0,u.translate(e0.E9.create(t)))}})}}(null!=h||d||p)&&(u.round(1),g.e=u.x,g.f=u.y,e.setAttribute("transform",e_.is.matrixToTransformString(g)))}update(e,t,i){let r,s={},n=this.findAttrs(i.attrs||t,e,s,i.selectors),o=i.attrs?this.findAttrs(t,e,s,i.selectors):n,l=[];n.each(t=>{let r=t.elem,n=t.attrs,a=this.processAttrs(r,n);if(null==a.set&&null==a.position&&null==a.offset)this.view.setAttrs(a.normal,r);else{let t,h=o.get(r),c=h?h.attrs:null,g=c&&null==n.ref?c.ref:n.ref;if(g){if(!(t=(s[g]||this.view.find(g,e,i.selectors))[0]))throw Error(`"${g}" reference does not exist.`)}else t=null;let u={node:r,refNode:t,attributes:c,processedAttributes:a},d=l.findIndex(e=>e.refNode===r);d>-1?l.splice(d,0,u):l.push(u)}});let a=new e_.Xy;l.forEach(t=>{let s,n,o=t.node,l=t.refNode,h=null!=l&&null!=i.rotatableNode&&e_.is.contains(i.rotatableNode,l);if(l&&(s=a.get(l)),!s){let t=h?i.rotatableNode:e;s=l?ev.getBBox(l,{target:t}):i.rootBBox,l&&a.set(l,s)}i.attrs&&t.attributes?(n=this.processAttrs(o,t.attributes),this.mergeProcessedAttrs(n,t.processedAttributes)):n=t.processedAttributes;let c=s;h&&null!=i.rotatableNode&&!i.rotatableNode.contains(o)&&(r||(r=e_.is.transformStringToMatrix(e_.is.attr(i.rotatableNode,"transform"))),c=ev.transformRectangle(s,r)),this.updateRelativeAttrs(o,n,c)})}}class ru{get cell(){return this.view.cell}constructor(e,t,i=[]){this.view=e;let r={},s={},n=0;Object.keys(t).forEach(e=>{let i=t[e];Array.isArray(i)||(i=[i]),i.forEach(t=>{let i=r[t];i||(n+=1,i=r[t]=1<<n),s[e]|=i})});let o=i;if(Array.isArray(o)||(o=[o]),o.forEach(e=>{r[e]||(n+=1,r[e]=1<<n)}),n>25)throw Error("Maximum number of flags exceeded.");this.flags=r,this.attrs=s,this.bootstrap=i}getFlag(e){let t=this.flags;return null==t?0:Array.isArray(e)?e.reduce((e,i)=>e|t[i],0):0|t[e]}hasAction(e,t){return e&this.getFlag(t)}removeAction(e,t){return e^e&this.getFlag(t)}getBootstrapFlag(){return this.getFlag(this.bootstrap)}getChangedFlag(){let e=0;return this.attrs&&Object.keys(this.attrs).forEach(t=>{this.cell.hasChanged(t)&&(e|=this.attrs[t])}),e}}var rd=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};class rp extends rh{static getDefaults(){return this.defaults}static config(e){this.defaults=this.getOptions(e)}static getOptions(e){let t=(e,t)=>null!=t?e_.RO.uniq([...Array.isArray(e)?e:[e],...Array.isArray(t)?t:[t]]):Array.isArray(e)?[...e]:[e],i=e_.QK.cloneDeep(this.getDefaults()),{bootstrap:r,actions:s,events:n,documentEvents:o}=e,l=rd(e,["bootstrap","actions","events","documentEvents"]);return r&&(i.bootstrap=t(i.bootstrap,r)),s&&Object.entries(s).forEach(([e,r])=>{let s=i.actions[e];r&&s?i.actions[e]=t(s,r):r&&(i.actions[e]=t(r))}),n&&(i.events=Object.assign(Object.assign({},i.events),n)),e.documentEvents&&(i.documentEvents=Object.assign(Object.assign({},i.documentEvents),o)),e_.QK.merge(i,l)}get[Symbol.toStringTag](){return rp.toStringTag}constructor(e,t={}){super(),this.cell=e,this.options=this.ensureOptions(t),this.graph=this.options.graph,this.attr=new rg(this),this.flag=new ru(this,this.options.actions,this.options.bootstrap),this.cache=new rc(this),this.setContainer(this.ensureContainer()),this.setup(),this.init()}init(){}onRemove(){this.removeTools()}get priority(){return this.options.priority}get rootSelector(){return this.options.rootSelector}getConstructor(){return this.constructor}ensureOptions(e){return this.getConstructor().getOptions(e)}getContainerTagName(){return this.options.isSvgElement?"g":"div"}getContainerStyle(){}getContainerAttrs(){return{"data-cell-id":this.cell.id,"data-shape":this.cell.shape}}getContainerClassName(){return this.prefixClassName("cell")}ensureContainer(){return rh.createElement(this.getContainerTagName(),this.options.isSvgElement)}setContainer(e){if(this.container!==e){this.undelegateEvents(),this.container=e,null!=this.options.events&&this.delegateEvents(this.options.events);let t=this.getContainerAttrs();null!=t&&this.setAttrs(t,e);let i=this.getContainerStyle();null!=i&&this.setStyle(i,e);let r=this.getContainerClassName();null!=r&&this.addClass(r,e)}return this}isNodeView(){return!1}isEdgeView(){return!1}render(){return this}confirmUpdate(e,t={}){return 0}getBootstrapFlag(){return this.flag.getBootstrapFlag()}getFlag(e){return this.flag.getFlag(e)}hasAction(e,t){return this.flag.hasAction(e,t)}removeAction(e,t){return this.flag.removeAction(e,t)}handleAction(e,t,i,r){if(this.hasAction(e,t)){i();let s=[t];return r&&("string"==typeof r?s.push(r):s.push(...r)),this.removeAction(e,s)}return e}setup(){this.cell.on("changed",this.onCellChanged,this)}onCellChanged({options:e}){this.onAttrsChange(e)}onAttrsChange(e){let t=this.flag.getChangedFlag();!e.updated&&t&&(e.dirty&&this.hasAction(t,"update")&&(t|=this.getFlag("render")),e.toolId&&(e.async=!1),null!=this.graph&&this.graph.renderer.requestViewUpdate(this,t,e))}parseJSONMarkup(e,t){let i=eO.parseJSONMarkup(e),r=i.selectors,s=this.rootSelector;if(t&&s){if(r[s])throw Error("Invalid root selector");r[s]=t}return i}can(e){let t=this.graph.options.interacting;if("function"==typeof t&&(t=e_.Iw.call(t,this.graph,this)),"object"==typeof t){let i=t[e];return"function"==typeof i&&(i=e_.Iw.call(i,this.graph,this)),!1!==i}return"boolean"==typeof t&&t}cleanCache(){return this.cache.clean(),this}getCache(e){return this.cache.get(e)}getDataOfElement(e){return this.cache.getData(e)}getMatrixOfElement(e){return this.cache.getMatrix(e)}getShapeOfElement(e){return this.cache.getShape(e)}getBoundingRectOfElement(e){return this.cache.getBoundingRect(e)}getBBoxOfElement(e){let t=this.getBoundingRectOfElement(e),i=this.getMatrixOfElement(e),r=this.getRootRotatedMatrix(),s=this.getRootTranslatedMatrix();return ev.transformRectangle(t,s.multiply(r).multiply(i))}getUnrotatedBBoxOfElement(e){let t=this.getBoundingRectOfElement(e),i=this.getMatrixOfElement(e),r=this.getRootTranslatedMatrix();return ev.transformRectangle(t,r.multiply(i))}getBBox(e={}){let t;if(e.useCellGeometry){let e=this.cell,i=e.isNode()?e.getAngle():0;t=e.getBBox().bbox(i)}else t=this.getBBoxOfElement(this.container);return this.graph.coord.localToGraphRect(t)}getRootTranslatedMatrix(){let e=this.cell,t=e.isNode()?e.getPosition():{x:0,y:0};return e_.is.createSVGMatrix().translate(t.x,t.y)}getRootRotatedMatrix(){let e=e_.is.createSVGMatrix(),t=this.cell,i=t.isNode()?t.getAngle():0;if(i){let r=t.getBBox(),s=r.width/2,n=r.height/2;e=e.translate(s,n).rotate(i).translate(-s,-n)}return e}findMagnet(e=this.container){return this.findByAttr("magnet",e)}updateAttrs(e,t,i={}){null==i.rootBBox&&(i.rootBBox=new e0.Ae),null==i.selectors&&(i.selectors=this.selectors),this.attr.update(e,t,i)}isEdgeElement(e){return this.cell.isEdge()&&(null==e||e===this.container)}prepareHighlight(e,t={}){let i=e||this.container;return t.partial=i===this.container,i}highlight(e,t={}){let i=this.prepareHighlight(e,t);return this.notify("cell:highlight",{magnet:i,options:t,view:this,cell:this.cell}),this.isEdgeView()?this.notify("edge:highlight",{magnet:i,options:t,view:this,edge:this.cell,cell:this.cell}):this.isNodeView()&&this.notify("node:highlight",{magnet:i,options:t,view:this,node:this.cell,cell:this.cell}),this}unhighlight(e,t={}){let i=this.prepareHighlight(e,t);return this.notify("cell:unhighlight",{magnet:i,options:t,view:this,cell:this.cell}),this.isNodeView()?this.notify("node:unhighlight",{magnet:i,options:t,view:this,node:this.cell,cell:this.cell}):this.isEdgeView()&&this.notify("edge:unhighlight",{magnet:i,options:t,view:this,edge:this.cell,cell:this.cell}),this}notifyUnhighlight(e,t){}getEdgeTerminal(e,t,i,r,s){let n=this.cell,o=this.findAttr("port",e),l=e.getAttribute("data-selector"),a={cell:n.id};return null!=l&&(a.magnet=l),null!=o?(a.port=o,n.isNode()&&!n.hasPort(o)&&null==l&&(a.selector=this.getSelector(e))):null==l&&this.container!==e&&(a.selector=this.getSelector(e)),a}getMagnetFromEdgeTerminal(e){let t,i=this.cell,r=this.container,s=e.port,n=e.magnet;return null!=s&&i.isNode()&&i.hasPort(s)?t=this.findPortElem(s,n)||r:(n||(n=e.selector),n||null==s||(n=`[port="${s}"]`),t=this.findOne(n,r,this.selectors)),t}hasTools(e){let t=this.tools;return null!=t&&(null==e||t.name===e)}addTools(e){if(this.removeTools(),e){if(!this.can("toolsAddable"))return this;let t=rf.isToolsView(e)?e:new rf(e);this.tools=t,t.config({view:this}),t.mount()}return this}updateTools(e={}){return this.tools&&this.tools.update(e),this}removeTools(){return this.tools&&(this.tools.remove(),this.tools=null),this}hideTools(){return this.tools&&this.tools.hide(),this}showTools(){return this.tools&&this.tools.show(),this}renderTools(){let e=this.cell.getTools();return this.addTools(e),this}notify(e,t){return this.trigger(e,t),this.graph.trigger(e,t),this}getEventArgs(e,t,i){let r=this.cell;return null==t||null==i?{e,view:this,cell:r}:{e,x:t,y:i,view:this,cell:r}}onClick(e,t,i){this.notify("cell:click",this.getEventArgs(e,t,i))}onDblClick(e,t,i){this.notify("cell:dblclick",this.getEventArgs(e,t,i))}onContextMenu(e,t,i){this.notify("cell:contextmenu",this.getEventArgs(e,t,i))}onMouseDown(e,t,i){this.cell.model&&(this.cachedModelForMouseEvent=this.cell.model,this.cachedModelForMouseEvent.startBatch("mouse")),this.notify("cell:mousedown",this.getEventArgs(e,t,i))}onMouseUp(e,t,i){this.notify("cell:mouseup",this.getEventArgs(e,t,i)),this.cachedModelForMouseEvent&&(this.cachedModelForMouseEvent.stopBatch("mouse",{cell:this.cell}),this.cachedModelForMouseEvent=null)}onMouseMove(e,t,i){this.notify("cell:mousemove",this.getEventArgs(e,t,i))}onMouseOver(e){this.notify("cell:mouseover",this.getEventArgs(e))}onMouseOut(e){this.notify("cell:mouseout",this.getEventArgs(e))}onMouseEnter(e){this.notify("cell:mouseenter",this.getEventArgs(e))}onMouseLeave(e){this.notify("cell:mouseleave",this.getEventArgs(e))}onMouseWheel(e,t,i,r){this.notify("cell:mousewheel",Object.assign({delta:r},this.getEventArgs(e,t,i)))}onCustomEvent(e,t,i,r){this.notify("cell:customevent",Object.assign({name:t},this.getEventArgs(e,i,r))),this.notify(t,Object.assign({},this.getEventArgs(e,i,r)))}onMagnetMouseDown(e,t,i,r){}onMagnetDblClick(e,t,i,r){}onMagnetContextMenu(e,t,i,r){}onLabelMouseDown(e,t,i){}checkMouseleave(e){let t=this.getEventTarget(e,{fromPoint:!0}),i=this.graph.findViewByElem(t);i!==this&&(this.onMouseLeave(e),i&&i.onMouseEnter(e))}dispose(){this.cell.off("changed",this.onCellChanged,this)}}rp.defaults={isSvgElement:!0,rootSelector:"root",priority:0,bootstrap:[],actions:{}},function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);n>3&&o&&Object.defineProperty(t,i,o)}([rp.dispose()],rp.prototype,"dispose",null),(E=rp||(rp={})).Flag=ru,E.Attr=rg,(P=rp||(rp={})).toStringTag=`X6.${P.name}`,P.isCellView=function(e){if(null==e)return!1;if(e instanceof P)return!0;let t=e[Symbol.toStringTag];return(null==t||t===P.toStringTag)&&"function"==typeof e.isNodeView&&"function"==typeof e.isEdgeView&&"function"==typeof e.confirmUpdate},(O=rp||(rp={})).priority=function(e){return function(t){t.config({priority:e})}},O.bootstrap=function(e){return function(t){t.config({bootstrap:e})}},(rp||(rp={})).registry=e1.create({type:"view"});class rf extends rh{get name(){return this.options.name}get graph(){return this.cellView.graph}get cell(){return this.cellView.cell}get[Symbol.toStringTag](){return rf.toStringTag}constructor(e={}){super(),this.svgContainer=this.createContainer(!0,e),this.htmlContainer=this.createContainer(!1,e),this.config(e)}createContainer(e,t){let i=e?rh.createElement("g",!0):rh.createElement("div",!1);return e_.is.addClass(i,this.prefixClassName("cell-tools")),t.className&&e_.is.addClass(i,t.className),i}config(e){if(this.options=Object.assign(Object.assign({},this.options),e),!rp.isCellView(e.view)||e.view===this.cellView)return this;this.cellView=e.view,this.cell.isEdge()?(e_.is.addClass(this.svgContainer,this.prefixClassName("edge-tools")),e_.is.addClass(this.htmlContainer,this.prefixClassName("edge-tools"))):this.cell.isNode()&&(e_.is.addClass(this.svgContainer,this.prefixClassName("node-tools")),e_.is.addClass(this.htmlContainer,this.prefixClassName("node-tools"))),this.svgContainer.setAttribute("data-cell-id",this.cell.id),this.htmlContainer.setAttribute("data-cell-id",this.cell.id),this.name&&(this.svgContainer.setAttribute("data-tools-name",this.name),this.htmlContainer.setAttribute("data-tools-name",this.name));let t=this.options.items;if(!Array.isArray(t))return this;this.tools=[];let i=[];t.forEach(e=>{rf.ToolItem.isToolItem(e)?"vertices"===e.name?i.unshift(e):i.push(e):"vertices"===("object"==typeof e?e.name:e)?i.unshift(e):i.push(e)});for(let e=0;e<i.length;e+=1){let t,r=i[e];if(rf.ToolItem.isToolItem(r))t=r;else{let e="object"==typeof r?r.name:r,i="object"==typeof r&&r.args||{};if(e){if(this.cell.isNode()){let r=eM.registry.get(e);if(!r)return eM.registry.onNotFound(e);t=new r(i)}else if(this.cell.isEdge()){let r=eS.registry.get(e);if(!r)return eS.registry.onNotFound(e);t=new r(i)}}}t&&(t.config(this.cellView,this),t.render(),(!1!==t.options.isSVGElement?this.svgContainer:this.htmlContainer).appendChild(t.container),this.tools.push(t))}return this}update(e={}){let t=this.tools;return t&&t.forEach(t=>{e.toolId!==t.cid&&t.isVisible()&&t.update()}),this}focus(e){let t=this.tools;return t&&t.forEach(t=>{e===t?t.show():t.hide()}),this}blur(e){let t=this.tools;return t&&t.forEach(t=>{t===e||t.isVisible()||(t.show(),t.update())}),this}hide(){return this.focus(null)}show(){return this.blur(null)}remove(){let e=this.tools;return e&&(e.forEach(e=>e.remove()),this.tools=null),e_.is.remove(this.svgContainer),e_.is.remove(this.htmlContainer),super.remove()}mount(){let e=this.tools,t=this.cellView;if(t&&e){let i=e.some(e=>!1!==e.options.isSVGElement),r=e.some(e=>!1===e.options.isSVGElement);i&&(this.options.local?t.container:t.graph.view.decorator).appendChild(this.svgContainer),r&&this.graph.container.appendChild(this.htmlContainer)}return this}}(A=rf||(rf={})).toStringTag=`X6.${A.name}`,A.isToolsView=function(e){if(null==e)return!1;if(e instanceof A)return!0;let t=e[Symbol.toStringTag];return(null==t||t===A.toStringTag)&&null!=e.graph&&null!=e.cell&&"function"==typeof e.config&&"function"==typeof e.update&&"function"==typeof e.focus&&"function"==typeof e.blur&&"function"==typeof e.show&&"function"==typeof e.hide||!1},function(e){var t,i;let r;class s extends rh{static getDefaults(){return this.defaults}static config(e){this.defaults=this.getOptions(e)}static getOptions(e){return e_.QK.merge(e_.QK.cloneDeep(this.getDefaults()),e)}get graph(){return this.cellView.graph}get cell(){return this.cellView.cell}get name(){return this.options.name}get[Symbol.toStringTag](){return s.toStringTag}constructor(e={}){super(),this.visible=!0,this.options=this.getOptions(e),this.container=rh.createElement(this.options.tagName||"g",!1!==this.options.isSVGElement),e_.is.addClass(this.container,this.prefixClassName("cell-tool")),"string"==typeof this.options.className&&e_.is.addClass(this.container,this.options.className),this.init()}init(){}getOptions(e){return this.constructor.getOptions(e)}delegateEvents(){return this.options.events&&super.delegateEvents(this.options.events),this}config(e,t){return this.cellView=e,this.parent=t,this.stamp(this.container),this.cell.isEdge()?e_.is.addClass(this.container,this.prefixClassName("edge-tool")):this.cell.isNode()&&e_.is.addClass(this.container,this.prefixClassName("node-tool")),this.name&&this.container.setAttribute("data-tool-name",this.name),this.delegateEvents(),this}render(){this.empty();let e=this.options.markup;if(e){let t=eO.parseJSONMarkup(e);this.container.appendChild(t.fragment),this.childNodes=t.selectors}return this.onRender(),this}onRender(){}update(){return this}stamp(e){e&&e.setAttribute("data-cell-id",this.cellView.cell.id)}show(){return this.container.style.display="",this.visible=!0,this}hide(){return this.container.style.display="none",this.visible=!1,this}isVisible(){return this.visible}focus(){let e=this.options.focusOpacity;return null!=e&&Number.isFinite(e)&&(this.container.style.opacity=`${e}`),this.parent.focus(this),this}blur(){return this.container.style.opacity="",this.parent.blur(this),this}guard(e){return null==this.graph||null==this.cellView||this.graph.view.guard(e,this.cellView)}}s.defaults={isSVGElement:!0,tagName:"g"},e.ToolItem=s,t=s=e.ToolItem||(e.ToolItem={}),r=0,t.define=function(e){var t;let i=e_.QK.createClass((t=e.name)?e_.kf.pascalCase(t):(r+=1,`CustomTool${r}`),this);return i.config(e),i},(i=s=e.ToolItem||(e.ToolItem={})).toStringTag=`X6.${i.name}`,i.isToolItem=function(e){if(null==e)return!1;if(e instanceof i)return!0;let t=e[Symbol.toStringTag];return(null==t||t===i.toStringTag)&&null!=e.graph&&null!=e.cell&&"function"==typeof e.config&&"function"==typeof e.update&&"function"==typeof e.focus&&"function"==typeof e.blur&&"function"==typeof e.show&&"function"==typeof e.hide&&"function"==typeof e.isVisible||!1}}(rf||(rf={}));let rm=e=>e;function ry(e,t){return 0===t?"0%":`${Math.round(e/t*100)}%`}function rb(e){return(t,i,r,s)=>i.isEdgeElement(r)?function(e,t,i,r,s){let n=i.getConnection();if(!n)return t;let o=n.closestPointLength(s);return e?t.anchor={name:"ratio",args:{ratio:o/n.length()}}:t.anchor={name:"length",args:{length:o}},t}(e,t,i,0,s):function(e,t,i,r,s){let n=i.cell,o=n.getAngle(),l=i.getUnrotatedBBoxOfElement(r),a=n.getBBox().getCenter(),h=e0.E9.create(s).rotate(o,a),c=h.x-l.x,g=h.y-l.y;return e&&(c=ry(c,l.width),g=ry(g,l.height)),t.anchor={name:"topLeft",args:{dx:c,dy:g,rotate:!0}},t}(e,t,i,r,s)}let rv=rb(!0),rw=rb(!1);function rx(e,t,i,r){return e_.Iw.call(eA.presets.pinRelative,this.graph,{},t,i,e,this.cell,r,{}).anchor}function rC(e,t){return t?e.cell.getBBox():e.cell.isEdge()?e.getConnection().bbox():e.getUnrotatedBBoxOfElement(e.container)}(M=eA||(eA={})).presets=eW,M.registry=e1.create({type:"connection strategy"}),M.registry.register(M.presets,!0);class rE extends rf.ToolItem{onRender(){e_.is.addClass(this.container,this.prefixClassName("cell-tool-button")),this.update()}update(){return this.updatePosition(),this}updatePosition(){let e=this.cellView.cell.isEdge()?this.getEdgeMatrix():this.getNodeMatrix();e_.is.transform(this.container,e,{absolute:!0})}getNodeMatrix(){let e=this.cellView,t=this.options,{x:i=0,y:r=0}=t,{offset:s,useCellGeometry:n,rotate:o}=t,l=rC(e,n),a=e.cell.getAngle();o||(l=l.bbox(a));let h=0,c=0;"number"==typeof s?(h=s,c=s):"object"==typeof s&&(h=s.x,c=s.y),i=e_.GH.normalizePercentage(i,l.width),r=e_.GH.normalizePercentage(r,l.height);let g=e_.is.createSVGMatrix().translate(l.x+l.width/2,l.y+l.height/2);return o&&(g=g.rotate(a)),g=g.translate(i+h-l.width/2,r+c-l.height/2)}getEdgeMatrix(){let e,t,i,r=this.cellView,{offset:s=0,distance:n=0,rotate:o}=this.options,l=e_.GH.normalizePercentage(n,1);(e=l>=0&&l<=1?r.getTangentAtRatio(l):r.getTangentAtLength(l))?(t=e.start,i=e.vector().vectorAngle(new e0.E9(1,0))||0):(t=r.getConnection().start,i=0);let a=e_.is.createSVGMatrix().translate(t.x,t.y).rotate(i);return a="object"==typeof s?a.translate(s.x||0,s.y||0):a.translate(0,s),o||(a=a.rotate(-i)),a}onMouseDown(e){if(this.guard(e))return;e.stopPropagation(),e.preventDefault();let t=this.options.onClick;"function"==typeof t&&e_.Iw.call(t,this.cellView,{e,view:this.cellView,cell:this.cellView.cell,btn:this})}}(rE||(rE={})).config({name:"button",useCellGeometry:!0,events:{mousedown:"onMouseDown",touchstart:"onMouseDown"}}),(S=rE||(rE={})).Remove=S.define({name:"button-remove",markup:[{tagName:"circle",selector:"button",attrs:{r:7,fill:"#FF1D00",cursor:"pointer"}},{tagName:"path",selector:"icon",attrs:{d:"M -3 -3 3 3 M -3 3 3 -3",fill:"none",stroke:"#FFFFFF","stroke-width":2,"pointer-events":"none"}}],distance:60,offset:0,useCellGeometry:!0,onClick({view:e,btn:t}){t.parent.remove(),e.cell.remove({ui:!0,toolId:t.cid})}});var rP=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};class rO extends rf.ToolItem{onRender(){if(e_.is.addClass(this.container,this.prefixClassName("cell-tool-boundary")),this.options.attrs){let e=this.options.attrs,{class:t}=e,i=rP(e,["class"]);e_.is.attr(this.container,e_.is.kebablizeAttrs(i)),t&&e_.is.addClass(this.container,t)}this.update()}update(){let e=this.cellView,t=this.options,{useCellGeometry:i,rotate:r}=t,s=e_.GH.normalizeSides(t.padding),n=rC(e,i).moveAndExpand({x:-s.left,y:-s.top,width:s.left+s.right,height:s.top+s.bottom}),o=e.cell;if(o.isNode()){let e=o.getAngle();if(e)if(r){let t=o.getBBox().getCenter();e_.is.rotate(this.container,e,t.x,t.y,{absolute:!0})}else n=n.bbox(e)}return e_.is.attr(this.container,n.toJSON()),this}}(rO||(rO={})).config({name:"boundary",tagName:"rect",padding:10,useCellGeometry:!0,attrs:{fill:"none",stroke:"#333","stroke-width":.5,"stroke-dasharray":"5, 5","pointer-events":"none"}});class rA extends rf.ToolItem{constructor(){super(...arguments),this.handles=[]}get vertices(){return this.cellView.cell.getVertices()}onRender(){return this.addClass(this.prefixClassName("edge-tool-vertices")),this.options.addable&&this.updatePath(),this.resetHandles(),this.renderHandles(),this}update(){return this.vertices.length===this.handles.length?this.updateHandles():(this.resetHandles(),this.renderHandles()),this.options.addable&&this.updatePath(),this}resetHandles(){let e=this.handles;this.handles=[],e&&e.forEach(e=>{this.stopHandleListening(e),e.remove()})}renderHandles(){let e=this.vertices;for(let t=0,i=e.length;t<i;t+=1){let i=e[t],r=this.options.createHandle,s=this.options.processHandle,n=r({index:t,graph:this.graph,guard:e=>this.guard(e),attrs:this.options.attrs||{}});s&&s(n),n.updatePosition(i.x,i.y),this.stamp(n.container),this.container.appendChild(n.container),this.handles.push(n),this.startHandleListening(n)}}updateHandles(){let e=this.vertices;for(let t=0,i=e.length;t<i;t+=1){let i=e[t],r=this.handles[t];r&&r.updatePosition(i.x,i.y)}}updatePath(){let e=this.childNodes.connection;e&&e.setAttribute("d",this.cellView.getConnectionPathData())}startHandleListening(e){let t=this.cellView;t.can("vertexMovable")&&(e.on("change",this.onHandleChange,this),e.on("changing",this.onHandleChanging,this),e.on("changed",this.onHandleChanged,this)),t.can("vertexDeletable")&&e.on("remove",this.onHandleRemove,this)}stopHandleListening(e){let t=this.cellView;t.can("vertexMovable")&&(e.off("change",this.onHandleChange,this),e.off("changing",this.onHandleChanging,this),e.off("changed",this.onHandleChanged,this)),t.can("vertexDeletable")&&e.off("remove",this.onHandleRemove,this)}getNeighborPoints(e){let t=this.cellView,i=this.vertices,r=e>0?i[e-1]:t.sourceAnchor,s=e<i.length-1?i[e+1]:t.targetAnchor;return{prev:e0.E9.create(r),next:e0.E9.create(s)}}getMouseEventArgs(e){let t=this.normalizeEvent(e),{x:i,y:r}=this.graph.snapToGrid(t.clientX,t.clientY);return{e:t,x:i,y:r}}onHandleChange({e}){this.focus();let t=this.cellView;if(t.cell.startBatch("move-vertex",{ui:!0,toolId:this.cid}),!this.options.stopPropagation){let{e:i,x:r,y:s}=this.getMouseEventArgs(e);this.eventData(i,{start:{x:r,y:s}}),t.notifyMouseDown(i,r,s)}}onHandleChanging({handle:e,e:t}){let i=this.cellView,r=e.options.index,{e:s,x:n,y:o}=this.getMouseEventArgs(t),l={x:n,y:o};this.snapVertex(l,r),i.cell.setVertexAt(r,l,{ui:!0,toolId:this.cid}),e.updatePosition(l.x,l.y),this.options.stopPropagation||i.notifyMouseMove(s,n,o)}stopBatch(e){this.cell.stopBatch("move-vertex",{ui:!0,toolId:this.cid}),e&&this.cell.stopBatch("add-vertex",{ui:!0,toolId:this.cid})}onHandleChanged({e}){let t=this.options,i=this.cellView;if(t.addable&&this.updatePath(),!t.removeRedundancies)return void this.stopBatch(this.eventData(e).vertexAdded);i.removeRedundantLinearVertices({ui:!0,toolId:this.cid})&&this.render(),this.blur(),this.stopBatch(this.eventData(e).vertexAdded);let{e:r,x:s,y:n}=this.getMouseEventArgs(e);if(!this.options.stopPropagation){i.notifyMouseUp(r,s,n);let{start:e}=this.eventData(r);if(e){let{x:t,y:o}=e;t===s&&o===n&&i.onClick(r,s,n)}}i.checkMouseleave(r),t.onChanged&&t.onChanged({edge:i.cell,edgeView:i})}snapVertex(e,t){let i=this.options.snapRadius||0;if(i>0){let r=this.getNeighborPoints(t),s=r.prev,n=r.next;Math.abs(e.x-s.x)<i?e.x=s.x:Math.abs(e.x-n.x)<i&&(e.x=n.x),Math.abs(e.y-s.y)<i?e.y=r.prev.y:Math.abs(e.y-n.y)<i&&(e.y=n.y)}}onHandleRemove({handle:e,e:t}){if(this.options.removable){let i=e.options.index,r=this.cellView;r.cell.removeVertexAt(i,{ui:!0}),this.options.addable&&this.updatePath(),r.checkMouseleave(this.normalizeEvent(t))}}allowAddVertex(e){let t=this.guard(e),i=this.options.addable&&this.cellView.can("vertexAddable"),r=!this.options.modifiers||e_.tx.isMatch(e,this.options.modifiers);return!t&&i&&r}onPathMouseDown(e){let t=this.cellView;if(!this.allowAddVertex(e))return;e.stopPropagation(),e.preventDefault();let i=this.normalizeEvent(e),r=this.graph.snapToGrid(i.clientX,i.clientY).toJSON();t.cell.startBatch("add-vertex",{ui:!0,toolId:this.cid});let s=t.getVertexIndex(r.x,r.y);this.snapVertex(r,s),t.cell.insertVertex(r,s,{ui:!0,toolId:this.cid}),this.render();let n=this.handles[s];this.eventData(i,{vertexAdded:!0}),n.onMouseDown(i)}onRemove(){this.resetHandles()}}(T=rA||(rA={})).Handle=class extends rh{get graph(){return this.options.graph}constructor(e){super(),this.options=e,this.render(),this.delegateEvents({mousedown:"onMouseDown",touchstart:"onMouseDown",dblclick:"onDoubleClick"})}render(){this.container=rh.createElement("circle",!0);let e=this.options.attrs;if("function"==typeof e){let t=T.getDefaults();this.setAttrs(Object.assign(Object.assign({},t.attrs),e(this)))}else this.setAttrs(e);this.addClass(this.prefixClassName("edge-tool-vertex"))}updatePosition(e,t){this.setAttrs({cx:e,cy:t})}onMouseDown(e){this.options.guard(e)||(e.stopPropagation(),e.preventDefault(),this.graph.view.undelegateEvents(),this.delegateDocumentEvents({mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"},e.data),this.emit("change",{e:e,handle:this}))}onMouseMove(e){this.emit("changing",{e:e,handle:this})}onMouseUp(e){this.emit("changed",{e:e,handle:this}),this.undelegateDocumentEvents(),this.graph.view.delegateEvents()}onDoubleClick(e){this.emit("remove",{e:e,handle:this})}};var rM=rA||(rA={});let rS=iR.prefix("edge-tool-vertex-path");rM.config({name:"vertices",snapRadius:20,addable:!0,removable:!0,removeRedundancies:!0,stopPropagation:!0,attrs:{r:6,fill:"#333",stroke:"#fff",cursor:"move","stroke-width":2},createHandle:e=>new rM.Handle(e),markup:[{tagName:"path",selector:"connection",className:rS,attrs:{fill:"none",stroke:"transparent","stroke-width":10,cursor:"pointer"}}],events:{[`mousedown .${rS}`]:"onPathMouseDown",[`touchstart .${rS}`]:"onPathMouseDown"}});class rT extends rf.ToolItem{constructor(){super(...arguments),this.handles=[]}get vertices(){return this.cellView.cell.getVertices()}update(){return this.render(),this}onRender(){e_.is.addClass(this.container,this.prefixClassName("edge-tool-segments")),this.resetHandles();let e=this.cellView,t=[...this.vertices];t.unshift(e.sourcePoint),t.push(e.targetPoint);for(let e=0,i=t.length;e<i-1;e+=1){let i=t[e],r=t[e+1],s=this.renderHandle(i,r,e);this.stamp(s.container),this.handles.push(s)}return this}renderHandle(e,t,i){let r=this.options.createHandle({index:i,graph:this.graph,guard:e=>this.guard(e),attrs:this.options.attrs||{}});return this.options.processHandle&&this.options.processHandle(r),this.updateHandle(r,e,t),this.container.appendChild(r.container),this.startHandleListening(r),r}startHandleListening(e){e.on("change",this.onHandleChange,this),e.on("changing",this.onHandleChanging,this),e.on("changed",this.onHandleChanged,this)}stopHandleListening(e){e.off("change",this.onHandleChange,this),e.off("changing",this.onHandleChanging,this),e.off("changed",this.onHandleChanged,this)}resetHandles(){let e=this.handles;this.handles=[],e&&e.forEach(e=>{this.stopHandleListening(e),e.remove()})}shiftHandleIndexes(e){let t=this.handles;for(let i=0,r=t.length;i<r;i+=1)t[i].options.index+=e}resetAnchor(e,t){let i=this.cellView.cell,r={ui:!0,toolId:this.cid};t?i.prop([e,"anchor"],t,r):i.removeProp([e,"anchor"],r)}snapHandle(e,t,i){let r=e.options.axis,s=e.options.index,n=this.cellView.cell.getVertices(),o=n[s-2]||i.sourceAnchor,l=n[s+1]||i.targetAnchor,a=this.options.snapRadius;return Math.abs(t[r]-o[r])<a?t[r]=o[r]:Math.abs(t[r]-l[r])<a&&(t[r]=l[r]),t}onHandleChanging({handle:e,e:t}){let i=this.graph,r=this.options,s=this.cellView,n=r.anchor,o=e.options.axis,l=e.options.index-1,a=this.getEventData(t),h=this.normalizeEvent(t),c=i.snapToGrid(h.clientX,h.clientY),g=this.snapHandle(e,c.clone(),a),u=e_.QK.cloneDeep(this.vertices),d=u[l],p=u[l+1],f=s.sourceView,m=s.sourceBBox,y=!1,b=!1;if(d?0===l?m.containsPoint(d)?(u.shift(),this.shiftHandleIndexes(-1),y=!0):(d[o]=g[o],b=!0):d[o]=g[o]:((d=s.sourceAnchor.toJSON())[o]=g[o],m.containsPoint(d)?y=!0:(u.unshift(d),this.shiftHandleIndexes(1),b=!0)),"function"==typeof n&&f){if(y){let e=a.sourceAnchor.clone();e[o]=g[o];let t=e_.Iw.call(n,s,e,f,s.sourceMagnet||f.container,"source",s,this);this.resetAnchor("source",t)}b&&this.resetAnchor("source",a.sourceAnchorDef)}let v=s.targetView,w=s.targetBBox,x=!1,C=!1;if(p?l===u.length-2?w.containsPoint(p)?(u.pop(),x=!0):(p[o]=g[o],C=!0):p[o]=g[o]:((p=s.targetAnchor.toJSON())[o]=g[o],w.containsPoint(p)?x=!0:(u.push(p),C=!0)),"function"==typeof n&&v){if(x){let e=a.targetAnchor.clone();e[o]=g[o];let t=e_.Iw.call(n,s,e,v,s.targetMagnet||v.container,"target",s,this);this.resetAnchor("target",t)}C&&this.resetAnchor("target",a.targetAnchorDef)}e0.E9.equalPoints(u,this.vertices)||this.cellView.cell.setVertices(u,{ui:!0,toolId:this.cid}),this.updateHandle(e,d,p,0),r.stopPropagation||s.notifyMouseMove(h,c.x,c.y)}onHandleChange({handle:e,e:t}){let i=this.options,r=this.handles,s=this.cellView,n=e.options.index;if(Array.isArray(r)){for(let e=0,t=r.length;e<t;e+=1)e!==n&&r[e].hide();if(this.focus(),this.setEventData(t,{sourceAnchor:s.sourceAnchor.clone(),targetAnchor:s.targetAnchor.clone(),sourceAnchorDef:e_.QK.cloneDeep(this.cell.prop(["source","anchor"])),targetAnchorDef:e_.QK.cloneDeep(this.cell.prop(["target","anchor"]))}),this.cell.startBatch("move-segment",{ui:!0,toolId:this.cid}),!i.stopPropagation){let e=this.normalizeEvent(t),i=this.graph.snapToGrid(e.clientX,e.clientY);s.notifyMouseDown(e,i.x,i.y)}}}onHandleChanged({e}){let t=this.options,i=this.cellView;t.removeRedundancies&&i.removeRedundantLinearVertices({ui:!0,toolId:this.cid});let r=this.normalizeEvent(e),s=this.graph.snapToGrid(r.clientX,r.clientY);this.render(),this.blur(),this.cell.stopBatch("move-segment",{ui:!0,toolId:this.cid}),t.stopPropagation||i.notifyMouseUp(r,s.x,s.y),i.checkMouseleave(r),t.onChanged&&t.onChanged({edge:i.cell,edgeView:i})}updateHandle(e,t,i,r=0){let s=this.options.precision||0,n=Math.abs(t.x-i.x)<s,o=Math.abs(t.y-i.y)<s;if(n||o){let s=new e0.x1(t,i);if(s.length()<this.options.threshold)e.hide();else{let t=s.getCenter(),i=n?"x":"y";t[i]+=r||0;let o=s.vector().vectorAngle(new e0.E9(1,0));e.updatePosition(t.x,t.y,o,this.cellView),e.show(),e.options.axis=i}}else e.hide()}onRemove(){this.resetHandles()}}(k=rT||(rT={})).Handle=class extends rh{constructor(e){super(),this.options=e,this.render(),this.delegateEvents({mousedown:"onMouseDown",touchstart:"onMouseDown"})}render(){this.container=rh.createElement("rect",!0);let e=this.options.attrs;if("function"==typeof e){let t=k.getDefaults();this.setAttrs(Object.assign(Object.assign({},t.attrs),e(this)))}else this.setAttrs(e);this.addClass(this.prefixClassName("edge-tool-segment"))}updatePosition(e,t,i,r){let s=r.getClosestPoint(new e0.E9(e,t))||new e0.E9(e,t),n=e_.is.createSVGMatrix().translate(s.x,s.y);if(s.equals({x:e,y:t}))n=n.rotate(i);else{let i=new e0.x1(e,t,s.x,s.y).vector().vectorAngle(new e0.E9(1,0));0!==i&&(i+=90),n=n.rotate(i)}this.setAttrs({transform:e_.is.matrixToTransformString(n),cursor:i%180==0?"row-resize":"col-resize"})}onMouseDown(e){this.options.guard(e)||(this.trigger("change",{e:e,handle:this}),e.stopPropagation(),e.preventDefault(),this.options.graph.view.undelegateEvents(),this.delegateDocumentEvents({mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"},e.data))}onMouseMove(e){this.emit("changing",{e:e,handle:this})}onMouseUp(e){this.emit("changed",{e:e,handle:this}),this.undelegateDocumentEvents(),this.options.graph.view.delegateEvents()}show(){this.container.style.display=""}hide(){this.container.style.display="none"}},(N=rT||(rT={})).config({name:"segments",precision:.5,threshold:40,snapRadius:10,stopPropagation:!0,removeRedundancies:!0,attrs:{width:20,height:8,x:-10,y:-4,rx:4,ry:4,fill:"#333",stroke:"#fff","stroke-width":2},createHandle:e=>new N.Handle(e),anchor:rx});class rk extends rf.ToolItem{get type(){return this.options.type}onRender(){e_.is.addClass(this.container,this.prefixClassName(`edge-tool-${this.type}-anchor`)),this.toggleArea(!1),this.update()}update(){let e=this.type;return this.cellView.getTerminalView(e)?(this.updateAnchor(),this.updateArea(),this.container.style.display=""):this.container.style.display="none",this}updateAnchor(){let e=this.childNodes;if(!e)return;let t=e.anchor;if(!t)return;let i=this.type,r=this.cellView,s=this.options,n=r.getTerminalAnchor(i),o=r.cell.prop([i,"anchor"]);t.setAttribute("transform",`translate(${n.x}, ${n.y})`);let l=o?s.customAnchorAttrs:s.defaultAnchorAttrs;l&&Object.keys(l).forEach(e=>{t.setAttribute(e,l[e])})}updateArea(){let e=this.childNodes;if(!e)return;let t=e.area;if(!t)return;let i=this.type,r=this.cellView,s=r.getTerminalView(i);if(s){let e,n,o,l=s.cell,a=r.getTerminalMagnet(i),h=this.options.areaPadding||0;Number.isFinite(h)||(h=0),s.isEdgeElement(a)?(e=s.getBBox(),n=0,o=e.getCenter()):(e=s.getUnrotatedBBoxOfElement(a),n=l.getAngle(),o=e.getCenter(),n&&o.rotate(-n,l.getBBox().getCenter())),e.inflate(h),e_.is.attr(t,{x:-e.width/2,y:-e.height/2,width:e.width,height:e.height,transform:`translate(${o.x}, ${o.y}) rotate(${n})`})}}toggleArea(e){if(this.childNodes){let t=this.childNodes.area;t&&(t.style.display=e?"":"none")}}onMouseDown(e){this.guard(e)||(e.stopPropagation(),e.preventDefault(),this.graph.view.undelegateEvents(),this.options.documentEvents&&this.delegateDocumentEvents(this.options.documentEvents),this.focus(),this.toggleArea(this.options.restrictArea),this.cell.startBatch("move-anchor",{ui:!0,toolId:this.cid}))}resetAnchor(e){let t=this.type,i=this.cell;e?i.prop([t,"anchor"],e,{rewrite:!0,ui:!0,toolId:this.cid}):i.removeProp([t,"anchor"],{ui:!0,toolId:this.cid})}onMouseMove(e){let t,i=this.type,r=this.cellView,s=r.getTerminalView(i);if(null==s)return;let n=this.normalizeEvent(e),o=s.cell,l=r.getTerminalMagnet(i),a=this.graph.coord.clientToLocalPoint(n.clientX,n.clientY),h=this.options.snap;if("function"==typeof h){let e=e_.Iw.call(h,r,a,s,l,i,r,this);a=e0.E9.create(e)}if(this.options.restrictArea)if(s.isEdgeElement(l)){let e=s.getClosestPoint(a);e&&(a=e)}else{let e=s.getUnrotatedBBoxOfElement(l),t=o.getAngle(),i=o.getBBox().getCenter(),r=a.clone().rotate(t,i);e.containsPoint(r)||(a=e.getNearestPointToPoint(r).rotate(-t,i))}let c=this.options.anchor;"function"==typeof c&&(t=e_.Iw.call(c,r,a,s,l,i,r,this)),this.resetAnchor(t),this.update()}onMouseUp(e){this.graph.view.delegateEvents(),this.undelegateDocumentEvents(),this.blur(),this.toggleArea(!1);let t=this.cellView;this.options.removeRedundancies&&t.removeRedundantLinearVertices({ui:!0,toolId:this.cid}),this.cell.stopBatch("move-anchor",{ui:!0,toolId:this.cid})}onDblClick(){let e=this.options.resetAnchor;e&&this.resetAnchor(!0===e?void 0:e),this.update()}}(rk||(rk={})).config({tagName:"g",markup:[{tagName:"circle",selector:"anchor",attrs:{cursor:"pointer"}},{tagName:"rect",selector:"area",attrs:{"pointer-events":"none",fill:"none",stroke:"#33334F","stroke-dasharray":"2,4",rx:5,ry:5}}],events:{mousedown:"onMouseDown",touchstart:"onMouseDown",dblclick:"onDblClick"},documentEvents:{mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"},customAnchorAttrs:{"stroke-width":4,stroke:"#33334F",fill:"#FFFFFF",r:5},defaultAnchorAttrs:{"stroke-width":2,stroke:"#FFFFFF",fill:"#33334F",r:6},areaPadding:6,snapRadius:10,resetAnchor:!0,restrictArea:!0,removeRedundancies:!0,anchor:rx,snap(e,t,i,r,s,n){let o=n.options.snapRadius||0,l="source"===r,a=this.cell.getVertexAt(l?0:-1)||this.getTerminalAnchor(l?"target":"source");return a&&(Math.abs(a.x-e.x)<o&&(e.x=a.x),Math.abs(a.y-e.y)<o&&(e.y=a.y)),e}});let rN=rk.define({name:"source-anchor",type:"source"}),rj=rk.define({name:"target-anchor",type:"target"});var rB=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};class rR extends rf.ToolItem{get type(){return this.options.type}get ratio(){return this.options.ratio}init(){if(this.options.attrs){let e=this.options.attrs,{class:t}=e,i=rB(e,["class"]);this.setAttrs(i,this.container),t&&e_.is.addClass(this.container,t)}}onRender(){e_.is.addClass(this.container,this.prefixClassName(`edge-tool-${this.type}-arrowhead`)),this.update()}update(){let e=this.ratio,t=this.cellView,i=t.getTangentAtRatio(e),r=i?i.start:t.getPointAtRatio(e),s=i&&i.vector().vectorAngle(new e0.E9(1,0))||0;if(!r)return this;let n=e_.is.createSVGMatrix().translate(r.x,r.y).rotate(s);return e_.is.transform(this.container,n,{absolute:!0}),this}onMouseDown(e){if(this.guard(e))return;e.stopPropagation(),e.preventDefault();let t=this.cellView;if(t.can("arrowheadMovable")){t.cell.startBatch("move-arrowhead",{ui:!0,toolId:this.cid});let i=this.graph.snapToGrid(e.clientX,e.clientY),r=t.prepareArrowheadDragging(this.type,{x:i.x,y:i.y,options:Object.assign(Object.assign({},this.options),{toolId:this.cid})});this.cellView.setEventData(e,r),this.delegateDocumentEvents(this.options.documentEvents,e.data),t.graph.view.undelegateEvents(),this.container.style.pointerEvents="none"}this.focus()}onMouseMove(e){let t=this.normalizeEvent(e),i=this.graph.snapToGrid(t.clientX,t.clientY);this.cellView.onMouseMove(t,i.x,i.y),this.update()}onMouseUp(e){this.undelegateDocumentEvents();let t=this.normalizeEvent(e),i=this.cellView,r=this.graph.snapToGrid(t.clientX,t.clientY);i.onMouseUp(t,r.x,r.y),this.graph.view.delegateEvents(),this.blur(),this.container.style.pointerEvents="",i.cell.stopBatch("move-arrowhead",{ui:!0,toolId:this.cid})}}(rR||(rR={})).config({tagName:"path",isSVGElement:!0,events:{mousedown:"onMouseDown",touchstart:"onMouseDown"},documentEvents:{mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"}});let rD=rR.define({name:"source-arrowhead",type:"source",ratio:0,attrs:{d:"M 10 -8 -10 0 10 8 Z",fill:"#333",stroke:"#fff","stroke-width":2,cursor:"move"}}),rV=rR.define({name:"target-arrowhead",type:"target",ratio:1,attrs:{d:"M -10 -8 10 0 -10 8 Z",fill:"#333",stroke:"#fff","stroke-width":2,cursor:"move"}});class rI extends rf.ToolItem{constructor(){super(...arguments),this.labelIndex=-1,this.distance=.5,this.dblClick=this.onCellDblClick.bind(this)}onRender(){let e=this.cellView;e&&e.on("cell:dblclick",this.dblClick)}createElement(){let e=[this.prefixClassName(`${this.cell.isEdge()?"edge":"node"}-tool-editor`),this.prefixClassName("cell-tool-editor")];this.editor=rf.createElement("div",!1),this.addClass(e,this.editor),this.editor.contentEditable="true",this.container.appendChild(this.editor)}removeElement(){this.undelegateDocumentEvents(),this.editor&&(this.container.removeChild(this.editor),this.editor=null)}updateEditor(){let{cell:e,editor:t}=this;if(!t)return;let{style:i}=t;e.isNode()?this.updateNodeEditorTransform():e.isEdge()&&this.updateEdgeEditorTransform();let{attrs:r}=this.options;return i.fontSize=`${r.fontSize}px`,i.fontFamily=r.fontFamily,i.color=r.color,i.backgroundColor=r.backgroundColor,t.innerText=this.getCellText()||"",this.setCellText(""),this}updateNodeEditorTransform(){let{graph:e,cell:t,editor:i}=this;if(!i)return;let r=e0.E9.create(),s=20,n="",{x:o,y:l}=this.options,{width:a,height:h}=this.options;if(void 0!==o&&void 0!==l){let e=t.getBBox();o=e_.GH.normalizePercentage(o,e.width),l=e_.GH.normalizePercentage(l,e.height),r=e.topLeft.translate(o,l),s=e.width-2*o}else{let e=t.getBBox();r=e.center,s=e.width-4,n="translate(-50%, -50%)"}let c=e.scale(),{style:g}=i;r=e.localToGraph(r),g.left=`${r.x}px`,g.top=`${r.y}px`,g.transform=`scale(${c.sx}, ${c.sy}) ${n}`,g.minWidth=`${s}px`,"number"==typeof a&&(g.width=`${a}px`),"number"==typeof h&&(g.height=`${h}px`)}updateEdgeEditorTransform(){if(!this.event)return;let{graph:e,editor:t}=this;if(!t)return;let i=e0.E9.create(),r=20,{style:s}=t,n=this.event.target,o=n.parentElement;if(o&&e_.is.hasClass(o,this.prefixClassName("edge-label"))){let e=o.getAttribute("data-index")||"0";this.labelIndex=parseInt(e,10);let t=o.getAttribute("transform"),{translation:s}=e_.is.parseTransformString(t);i=new e0.E9(s.tx,s.ty),r=ev.getBBox(n).width}else{if(!this.options.labelAddable)return this;i=e.clientToLocal(e0.E9.create(this.event.clientX,this.event.clientY));let t=this.cellView.path.closestPointLength(i);this.distance=t,this.labelIndex=-1}i=e.localToGraph(i);let l=e.scale();s.left=`${i.x}px`,s.top=`${i.y}px`,s.minWidth=`${r}px`,s.transform=`scale(${l.sx}, ${l.sy}) translate(-50%, -50%)`}onDocumentMouseUp(e){if(this.editor&&e.target!==this.editor){let e=this.editor.innerText.replace(/\n$/,"")||"";this.setCellText(""!==e?e:null),this.removeElement()}}onCellDblClick({e}){this.editor||(e.stopPropagation(),this.removeElement(),this.event=e,this.createElement(),this.updateEditor(),this.autoFocus(),this.delegateDocumentEvents(this.options.documentEvents))}onMouseDown(e){e.stopPropagation()}autoFocus(){setTimeout(()=>{this.editor&&(this.editor.focus(),this.selectText())})}selectText(){if(window.getSelection&&this.editor){let e=document.createRange(),t=window.getSelection();e.selectNodeContents(this.editor),t.removeAllRanges(),t.addRange(e)}}getCellText(){let{getText:e}=this.options;if("function"==typeof e)return e_.Iw.call(e,this.cellView,{cell:this.cell,index:this.labelIndex});if("string"==typeof e){if(this.cell.isNode())return this.cell.attr(e);if(this.cell.isEdge()&&-1!==this.labelIndex)return this.cell.prop(`labels/${this.labelIndex}/attrs/${e}`)}}setCellText(e){let t=this.options.setText;if("function"==typeof t)return void e_.Iw.call(t,this.cellView,{cell:this.cell,value:e,index:this.labelIndex,distance:this.distance});if("string"==typeof t){if(this.cell.isNode()){null!==e&&this.cell.attr(t,e);return}if(this.cell.isEdge()){let i=this.cell;if(-1===this.labelIndex){if(e){let r={position:{distance:this.distance},attrs:{}};e_.QK.setByPath(r,`attrs/${t}`,e),i.appendLabel(r)}}else null!==e?i.prop(`labels/${this.labelIndex}/attrs/${t}`,e):"number"==typeof this.labelIndex&&i.removeLabelAt(this.labelIndex)}}}onRemove(){let e=this.cellView;e&&e.off("cell:dblclick",this.dblClick),this.removeElement()}}(rI||(rI={})).config({tagName:"div",isSVGElement:!1,events:{mousedown:"onMouseDown",touchstart:"onMouseDown"},documentEvents:{mouseup:"onDocumentMouseUp",touchend:"onDocumentMouseUp",touchcancel:"onDocumentMouseUp"}}),(j=rI||(rI={})).NodeEditor=j.define({attrs:{fontSize:14,fontFamily:"Arial, helvetica, sans-serif",color:"#000",backgroundColor:"#fff"},getText:"text/text",setText:"text/text"}),j.EdgeEditor=j.define({attrs:{fontSize:14,fontFamily:"Arial, helvetica, sans-serif",color:"#000",backgroundColor:"#fff"},labelAddable:!0,getText:"label/text",setText:"label/text"});var rL=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};(B=eM||(eM={})).presets={boundary:rO,button:rE,"button-remove":rE.Remove,"node-editor":rI.NodeEditor},B.registry=e1.create({type:"node tool",process(e,t){if("function"==typeof t)return t;let i=rf.ToolItem,{inherit:r}=t,s=rL(t,["inherit"]);if(r){let e=this.get(r);null==e?this.onNotFound(r,"inherited"):i=e}return null==s.name&&(s.name=e),i.define.call(i,s)}}),B.registry.register(B.presets,!0),(R=eS||(eS={})).presets={boundary:rO,vertices:rA,segments:rT,button:rE,"button-remove":rE.Remove,"source-anchor":rN,"target-anchor":rj,"source-arrowhead":rD,"target-arrowhead":rV,"edge-editor":rI.EdgeEditor},R.registry=e1.create({type:"edge tool",process(e,t){if("function"==typeof t)return t;let i=rf.ToolItem,{inherit:r}=t,s=rL(t,["inherit"]);if(r){let e=this.get(r);null==e?this.onNotFound(r,"inherited"):i=e}return null==s.name&&(s.name=e),i.define.call(i,s)}}),R.registry.register(R.presets,!0);let r$=rJ("center"),rz=rJ("topCenter"),rF=rJ("bottomCenter"),rG=rJ("leftMiddle"),rH=rJ("rightMiddle"),rU=rJ("topLeft"),rq=rJ("topRight"),rW=rJ("bottomLeft"),rK=rJ("bottomRight");function rJ(e){return function(t,i,r,s={}){let n=s.rotate?t.getUnrotatedBBoxOfElement(i):t.getBBoxOfElement(i),o=n[e];o.x+=e_.GH.normalizePercentage(s.dx,n.width),o.y+=e_.GH.normalizePercentage(s.dy,n.height);let l=t.cell;return s.rotate?o.rotate(-l.getAngle(),l.getBBox().getCenter()):o}}function rQ(e){return function(t,i,r,s){if(r instanceof Element){let n,o=this.graph.findViewByElem(r);return n=o?o.isEdgeElement(r)?rX(o,null!=s.fixedAt?s.fixedAt:"50%"):o.getBBoxOfElement(r).getCenter():new e0.E9,e.call(this,t,i,n,s)}return e.apply(this,arguments)}}function rX(e,t){let i=e_.GH.isPercentage(t),r="string"==typeof t?parseFloat(t):t;return i?e.getPointAtRatio(r/100):e.getPointAtLength(r)}let rY=rQ(function(e,t,i,r){let s=e0.RZ.normalize(e.cell.getAngle()),n=e.getBBoxOfElement(t),o=n.getCenter(),l=n.getTopLeft(),a=n.getBottomRight(),h=r.padding;if(Number.isFinite(h)||(h=0),l.y+h<=i.y&&i.y<=a.y-h){let e=i.y-o.y;o.x+=0===s||180===s?0:e/Math.tan(e0.RZ.toRad(s)),o.y+=e}else if(l.x+h<=i.x&&i.x<=a.x-h){let e=i.x-o.x;o.y+=90===s||270===s?0:e*Math.tan(e0.RZ.toRad(s)),o.x+=e}return o}),rZ=function(e,t,i,r,s){let n=e.cell.getConnectionPoint(this.cell,s);return(r.dx||r.dy)&&n.translate(r.dx||0,r.dy||0),n},r_=rQ(function(e,t,i,r){let s,n,o,l=0,a=e.cell;r.rotate?(s=e.getUnrotatedBBoxOfElement(t),n=a.getBBox().getCenter(),l=a.getAngle()):s=e.getBBoxOfElement(t);let h=r.padding;null!=h&&Number.isFinite(h)&&s.inflate(h),r.rotate&&i.rotate(l,n);let c=s.getNearestSideToPoint(i);switch(c){case"left":o=s.getLeftMiddle();break;case"right":o=s.getRightMiddle();break;case"top":o=s.getTopCenter();break;case"bottom":o=s.getBottomCenter()}let g=r.direction;return"H"===g?("top"===c||"bottom"===c)&&(o=i.x<=s.x+s.width?s.getLeftMiddle():s.getRightMiddle()):"V"===g&&(o=i.y<=s.y+s.height?s.getTopCenter():s.getBottomCenter()),r.rotate?o.rotate(-l,n):o});(D=eT||(eT={})).presets=eK,D.registry=e1.create({type:"node endpoint"}),D.registry.register(D.presets,!0);let r0=function(e,t,i,r){let s=null!=r.ratio?r.ratio:.5;return s>1&&(s/=100),e.getPointAtRatio(s)},r1=function(e,t,i,r){let s=null!=r.length?r.length:20;return e.getPointAtLength(s)},r2=function(e,t,i,r){let s=e.getClosestPoint(i);return null!=s?s:new e0.E9},r3=rQ(r2),r9=rQ(function(e,t,i,r){let s=e.getConnection(),n=e.getConnectionSubdivisions(),o=new e0.x1(i.clone().translate(0,1e6),i.clone().translate(0,-1e6)),l=new e0.x1(i.clone().translate(1e6,0),i.clone().translate(-1e6,0)),a=o.intersect(s,{segmentSubdivisions:n}),h=l.intersect(s,{segmentSubdivisions:n}),c=[];return(a&&c.push(...a),h&&c.push(...h),c.length>0)?i.closest(c):null!=r.fallbackAt?rX(e,r.fallbackAt):e_.Iw.call(r2,this,e,t,i,r)});function r6(e,t,i){let r;if("object"==typeof i){if(Number.isFinite(i.y)){let{start:r,end:s}=new e0.x1(t,e).parallel(i.y);t=r,e=s}r=i.x}else r=i;if(null==r||!Number.isFinite(r))return e;let s=e.distance(t);return 0===r&&s>0?e:e.move(t,-Math.min(r,s-1))}function r5(e){let t=e.getAttribute("stroke-width");return null===t?0:parseFloat(t)||0}(V=ek||(ek={})).presets=eJ,V.registry=e1.create({type:"edge endpoint"}),V.registry.register(V.presets,!0);let r4=function(e,t,i,r){let s=t.getBBoxOfElement(i);r.stroked&&s.inflate(r5(i)/2);let n=e.intersect(s);return r6(n&&n.length?e.start.closest(n):e.end,e.start,r.offset)},r8=function(e,t,i,r,s){let n=t.cell,o=n.isNode()?n.getAngle():0;if(0===o)return e_.Iw.call(r4,this,e,t,i,r,s);let l=t.getUnrotatedBBoxOfElement(i);r.stroked&&l.inflate(r5(i)/2);let a=l.getCenter(),h=e.clone().rotate(o,a),c=h.setLength(1e6).intersect(l);return r6(c&&c.length?h.start.closest(c).rotate(-o,a):e.end,e.start,r.offset)},r7=function(e,t,i,r){let s,n,o,l=e.end,a=r.selector;if(s="string"==typeof a?t.findOne(a):Array.isArray(a)?e_.QK.getByPath(i,a):function(e){if(null==e)return null;let t=e;do{let e=t.tagName;if("string"!=typeof e)return null;if("G"===(e=e.toUpperCase()))t=t.firstElementChild;else if("TITLE"===e)t=t.nextElementSibling;else break}while(t);return t}(i),!e_.is.isSVGGraphicsElement(s)){if(s===i||!e_.is.isSVGGraphicsElement(i))return l;s=i}let h=t.getShapeOfElement(s),c=t.getMatrixOfElement(s),g=t.getRootTranslatedMatrix(),u=t.getRootRotatedMatrix(),d=g.multiply(u).multiply(c),p=d.inverse(),f=ev.transformLine(e,p),m=f.start.clone(),y=t.getDataOfElement(s);if(!1===r.insideout){null==y.shapeBBox&&(y.shapeBBox=h.bbox());let e=y.shapeBBox;if(null!=e&&e.containsPoint(m))return l}if(!0===r.extrapolate&&f.setLength(1e6),e0.y$.isPath(h)){let e=r.precision||2;null==y.segmentSubdivisions&&(y.segmentSubdivisions=h.getSegmentSubdivisions({precision:e})),o={precision:e,segmentSubdivisions:y.segmentSubdivisions},n=f.intersect(h,o)}else n=f.intersect(h);n?Array.isArray(n)&&(n=m.closest(n)):!0===r.sticky&&(n=e0.Ae.isRectangle(h)?h.getNearestPointToPoint(m):e0.Pj.isEllipse(h)?h.intersectsWithLineFromCenterToPoint(m):h.closestPoint(m,o));let b=n?ev.transformPoint(n,d):l,v=r.offset||0;return!1!==r.stroked&&("object"==typeof v?(null==(v=Object.assign({},v)).x&&(v.x=0),v.x+=r5(s)/2):v+=r5(s)/2),r6(b,e.start,v)},se=function(e,t,i,r){let{alignOffset:s,align:n}=r;return n&&function(e,t,i=0){let r,s,n,o,{start:l,end:a}=e;switch(t){case"left":o="x",r=a,s=l,n=-1;break;case"right":o="x",r=l,s=a,n=1;break;case"top":o="y",r=a,s=l,n=-1;break;case"bottom":o="y",r=l,s=a,n=1;break;default:return}l[o]<a[o]?r[o]=s[o]:s[o]=r[o],Number.isFinite(i)&&(r[o]+=n*i,s[o]+=n*i)}(e,n,s),r6(e.end,e.start,r.offset)};(I=eN||(eN={})).presets=eQ,I.registry=e1.create({type:"connection point"}),I.registry.register(I.presets,!0);let st=function(e){return[...e]},si=function(e,t,i){let r,s,n,o=t.side||"bottom",l=e_.GH.normalizeSides(t.padding||40),a=i.sourceBBox,h=i.targetBBox,c=a.getCenter(),g=h.getCenter();switch(o){case"top":n=-1,r="y",s="height";break;case"left":n=-1,r="x",s="width";break;case"right":n=1,r="x",s="width";break;default:n=1,r="y",s="height"}return c[r]+=n*(a[s]/2+l[o]),g[r]+=n*(h[s]/2+l[o]),n*(c[r]-g[r])>0?g[r]=c[r]:c[r]=g[r],[c.toJSON(),...e,g.toJSON()]};function sr(e){return new e0.Ae(e.x,e.y,0,0)}function ss(e={}){let t=e_.GH.normalizeSides(e.padding||20);return{x:-t.left,y:-t.top,width:t.left+t.right,height:t.top+t.bottom}}function sn(e,t={}){return e.sourceBBox.clone().moveAndExpand(ss(t))}function so(e,t={}){return e.targetBBox.clone().moveAndExpand(ss(t))}let sl=function(e,t,i){let r=sn(i,t),s=so(i,t),n=function(e,t={}){return e.sourceAnchor?e.sourceAnchor:sn(e,t).getCenter()}(i,t),o=function(e,t={}){return e.targetAnchor?e.targetAnchor:so(e,t).getCenter()}(i,t);r=r.union(sr(n)),s=s.union(sr(o));let l=e.map(e=>e0.E9.create(e));l.unshift(n),l.push(o);let a=null,h=[];for(let e=0,i=l.length-1;e<i;e+=1){let n=null,o=l[e],c=l[e+1],g=null!=ej.getBearing(o,c);if(0===e)e+1===i?r.intersectsWithRect(s.clone().inflate(1))?n=ej.insideNode(o,c,r,s):g||(n=ej.nodeToNode(o,c,r,s)):r.containsPoint(c)?n=ej.insideNode(o,c,r,sr(c).moveAndExpand(ss(t))):g||(n=ej.nodeToVertex(o,c,r));else if(e+1===i){let e=g&&ej.getBearing(c,o)===a;s.containsPoint(o)||e?n=ej.insideNode(o,c,sr(o).moveAndExpand(ss(t)),s,a):g||(n=ej.vertexToNode(o,c,s,a))}else g||(n=ej.vertexToVertex(o,c,a));n?(h.push(...n.points),a=n.direction):a=ej.getBearing(o,c),e+1<i&&h.push(c)}return h};!function(e){let t={N:"S",S:"N",E:"W",W:"E"},i={N:-Math.PI/2*3,S:-Math.PI/2,E:0,W:Math.PI};function r(e,t,i){let r=new e0.E9(e.x,t.y);return i.containsPoint(r)&&(r=new e0.E9(t.x,e.y)),r}function s(e,t){return e["W"===t||"E"===t?"width":"height"]}function n(e,t){return e.x===t.x?e.y>t.y?"N":"S":e.y===t.y?e.x>t.x?"W":"E":null}function o(e,i,r){let s=new e0.E9(e.x,i.y),o=new e0.E9(i.x,e.y),l=n(e,s),a=n(e,o),h=r?t[r]:null,c=l===r||l!==h&&(a===h||a!==r)?s:o;return{points:[c],direction:n(c,i)}}function l(e,t,i){let s=r(e,t,i);return{points:[s],direction:n(s,t)}}e.getBBoxSize=s,e.getBearing=n,e.vertexToVertex=o,e.nodeToVertex=l,e.vertexToNode=function(e,t,i,o){let l,a=[new e0.E9(e.x,t.y),new e0.E9(t.x,e.y)],h=a.filter(e=>!i.containsPoint(e)),c=h.filter(t=>n(t,e)!==o);if(c.length>0)return{points:[l=(l=c.filter(t=>n(e,t)===o).pop())||c[0]],direction:n(l,t)};{l=e_.RO.difference(a,h)[0];let c=e0.E9.create(t).move(l,-s(i,o)/2);return{points:[r(c,e,i),c],direction:n(c,t)}}},e.nodeToNode=function(e,t,i,r){let a=l(t,e,r),h=a.points[0];if(i.containsPoint(h)){let c=(a=l(e,t,i)).points[0];if(r.containsPoint(c)){let g=e0.E9.create(e).move(c,-s(i,n(e,c))/2),u=e0.E9.create(t).move(h,-s(r,n(t,h))/2),d=new e0.x1(g,u).getCenter(),p=l(e,d,i),f=o(d,t,p.direction);a.points=[p.points[0],f.points[0]],a.direction=f.direction}}return a},e.insideNode=function(e,t,s,o,l){let a,h,c,g,u=s.union(o).inflate(1),d=u.getCenter(),p=d.distance(t)>d.distance(e),f=p?t:e,m=p?e:t;return l?(a=e0.E9.fromPolar(u.width+u.height,i[l],f),a=u.getNearestPointToPoint(a).move(a,-1)):a=u.getNearestPointToPoint(f).move(f,1),h=r(a,m,u),a.round().equals(h.round())?(h=e0.E9.fromPolar(u.width+u.height,e0.RZ.toRad(a.theta(f))+Math.PI/2,m),c=r(a,h=u.getNearestPointToPoint(h).move(m,1).round(),u),g=p?[h,c,a]:[a,c,h]):g=p?[h,a]:[a,h],{points:g,direction:p?n(a,t):n(h,t)}}}(ej||(ej={}));let sa={step:10,maxLoopCount:2e3,precision:1,maxDirectionChange:90,perpendicular:!0,excludeTerminals:[],excludeNodes:[],excludeShapes:[],startDirections:["top","right","bottom","left"],endDirections:["top","right","bottom","left"],directionMap:{top:{x:0,y:-1},right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0}},cost(){return sh(this.step,this)},directions(){let e=sh(this.step,this),t=sh(this.cost,this);return[{cost:t,offsetX:e,offsetY:0},{cost:t,offsetX:-e,offsetY:0},{cost:t,offsetX:0,offsetY:e},{cost:t,offsetX:0,offsetY:-e}]},penalties(){let e=sh(this.step,this);return{0:0,45:e/2,90:e/2}},paddingBox(){let e=sh(this.step,this);return{x:-e,y:-e,width:2*e,height:2*e}},fallbackRouter:sl,draggingRouter:null,snapToGrid:!0};function sh(e,t){return"function"==typeof e?e.call(t):e}class sc{constructor(){this.items=[],this.hash={},this.values={}}add(e,t){this.hash[e]?this.items.splice(this.items.indexOf(e),1):this.hash[e]=1,this.values[e]=t;let i=e_.RO.sortedIndexBy(this.items,e,e=>this.values[e]);this.items.splice(i,0,e)}pop(){let e=this.items.shift();return e&&(this.hash[e]=2),e}isOpen(e){return 1===this.hash[e]}isClose(e){return 2===this.hash[e]}isEmpty(){return 0===this.items.length}}class sg{constructor(e){this.options=e,this.mapGridSize=100,this.map={}}build(e,t){let i=this.options,r=i.excludeTerminals.reduce((i,r)=>{let s=t[r];if(s){let t=e.getCell(s.cell);t&&i.push(t)}return i},[]),s=[],n=e.getCell(t.getSourceCellId());n&&(s=e_.RO.union(s,n.getAncestors().map(e=>e.id)));let o=e.getCell(t.getTargetCellId());o&&(s=e_.RO.union(s,o.getAncestors().map(e=>e.id)));let l=this.mapGridSize;return e.getNodes().reduce((e,t)=>{let n=r.some(e=>e.id===t.id),o=!!t.shape&&i.excludeShapes.includes(t.shape),a=i.excludeNodes.some(e=>"string"==typeof e?t.id===e:e===t),h=s.includes(t.id);if(t.isVisible()&&!(o||n||a||h)){let r=t.getBBox().moveAndExpand(i.paddingBox),s=r.getOrigin().snapToGrid(l),n=r.getCorner().snapToGrid(l);for(let t=s.x;t<=n.x;t+=l)for(let i=s.y;i<=n.y;i+=l){let s=new e0.E9(t,i).toString();null==e[s]&&(e[s]=[]),e[s].push(r)}}return e},this.map),this}isAccessible(e){let t=e.clone().snapToGrid(this.mapGridSize).toString(),i=this.map[t];return!i||i.every(t=>!t.containsPoint(e))}}function su(e,t){let i=e.sourceBBox.clone();return t&&t.paddingBox?i.moveAndExpand(t.paddingBox):i}function sd(e,t){let i=e.targetBBox.clone();return t&&t.paddingBox?i.moveAndExpand(t.paddingBox):i}function sp(e,t){return e.sourceAnchor?e.sourceAnchor:su(e,t).getCenter()}function sf(e,t,i,r,s){let n=360/i,o=e.theta(function(e,t,i,r){let s=r.step,n=t.x-e.x,o=t.y-e.y,l=n/i.x,a=o/i.y;return new e0.E9(e.x+l*s,e.y+a*s)}(e,t,r,s)),l=e0.RZ.normalize(o+n/2);return n*Math.floor(l/n)}function sm(e,t){let i=Math.abs(e-t);return i>180?360-i:i}function sy(e,t){if(!e)return t;let i=Math.abs(e),r=Math.round(i/t);return r?t+(i-r*t)/r:i}function sb(e,t){return e.round(t)}function sv(e,t,i){return sb(function(e,t){let i=t.source,r=e0.Z4.snapToGrid(e.x-i.x,t.x)+i.x,s=e0.Z4.snapToGrid(e.y-i.y,t.y)+i.y;return new e0.E9(r,s)}(e.clone(),t),i)}function sw(e){return e.toString()}function sx(e){return new e0.E9(0===e.x?0:Math.abs(e.x)/e.x,0===e.y?0:Math.abs(e.y)/e.y)}function sC(e,t){let i=1/0;for(let r=0,s=t.length;r<s;r+=1){let s=e.manhattanDistance(t[r]);s<i&&(i=s)}return i}function sE(e,t,i,r,s){let n=s.precision,o=s.directionMap,l=e.diff(t.getCenter()),a=Object.keys(o).reduce((s,a)=>{if(i.includes(a)){let i,h=o[a],c=new e0.E9(e.x+h.x*(Math.abs(l.x)+t.width),e.y+h.y*(Math.abs(l.y)+t.height)),g=new e0.x1(e,c).intersect(t)||[],u=null;for(let t=0;t<g.length;t+=1){let r=g[t],s=e.squaredDistance(r);(null==i||s>i)&&(i=s,u=r)}if(u){let e=sv(u,r,n);t.containsPoint(e)&&(e=sv(e.translate(h.x*r.x,h.y*r.y),r,n)),s.push(e)}}return s},[]);return t.containsPoint(e)||a.push(sv(e,r,n)),a}let sP=function(e,t,i){let r,s,n=function(e){let t=Object.keys(e).reduce((t,i)=>("fallbackRouter"===i||"draggingRouter"===i||"fallbackRoute"===i?t[i]=e[i]:t[i]=sh(e[i],e),t),{});if(t.padding){let e=e_.GH.normalizeSides(t.padding);t.paddingBox={x:-e.left,y:-e.top,width:e.left+e.right,height:e.top+e.bottom}}return t.directions.forEach(e=>{let t=new e0.E9(0,0),i=new e0.E9(e.offsetX,e.offsetY);e.angle=e0.RZ.normalize(t.theta(i))}),t}(t),o=su(i,n),l=sd(i,n),a=sp(i,n),h=new sg(n).build(i.graph.model,i.cell),c=e.map(e=>e0.E9.create(e)),g=[],u=a;for(let t=0,d=c.length;t<=d;t+=1){let d=null;if(r=s||o,null==(s=c[t])){s=l;let e=i.cell;if((null==e.getSourceCellId()||null==e.getTargetCellId())&&"function"==typeof n.draggingRouter){let e=r===o?a:r,t=s.getOrigin();d=e_.Iw.call(n.draggingRouter,i,e,t,n)}}if(null==d&&(d=function(e,t,i,r,s){var n,o;let l,a,h,c,g=s.precision;l=e0.Ae.isRectangle(t)?sb(sp(e,s).clone(),g):sb(t.clone(),g),a=e0.Ae.isRectangle(i)?sb((e.targetAnchor?e.targetAnchor:sd(e,s).getCenter()).clone(),g):sb(i.clone(),g);let u=(n=s.step,o=a,{source:l.clone(),x:sy(o.x-l.x,n),y:sy(o.y-l.y,n)}),d=a;if(h=e0.Ae.isRectangle(t)?sE(l,t,s.startDirections,u,s):[l],c=e0.Ae.isRectangle(i)?sE(a,i,s.endDirections,u,s):[d],h=h.filter(e=>r.isAccessible(e)),c=c.filter(e=>r.isAccessible(e)),h.length>0&&c.length>0){let e,t,i=new sc,n={},o={},a={};for(let e=0,t=h.length;e<t;e+=1){let t=h[e],r=sw(t);i.add(r,sC(t,c)),n[r]=t,a[r]=0}let p=s.previousDirectionAngle,f=void 0===p,m=function(e,t){let i=t.step;return t.directions.forEach(t=>{t.gridOffsetX=t.offsetX/i*e.x,t.gridOffsetY=t.offsetY/i*e.y}),t.directions}(u,s),y=m.length,b=c.reduce((e,t)=>{let i=sw(t);return e.push(i),e},[]),v=e0.E9.equalPoints(h,c),w=s.maxLoopCount;for(;!i.isEmpty()&&w>0;){let h,x=i.pop(),C=n[x],E=o[x],P=a[x],O=C.equals(l),A=null==E;if(h=A?f?O?null:sf(l,C,y,u,s):p:sf(E,C,y,u,s),!(A&&v)&&b.indexOf(x)>=0)return s.previousDirectionAngle=h,function(e,t,i,r,s){let n,o=[],l=sx(s.diff(i)),a=sw(i),h=e[a];for(;h;){let i=sx((n=t[a]).diff(h));i.equals(l)||(o.unshift(n),l=i),h=e[a=sw(h)]}let c=t[a];return sx(c.diff(r)).equals(l)||o.unshift(c),o}(o,n,C,l,d);for(let l=0;l<y;l+=1){let p=(e=m[l]).angle;if(t=sm(h,p),!(f&&O)&&t>s.maxDirectionChange)continue;let v=sv(C.clone().translate(e.gridOffsetX||0,e.gridOffsetY||0),u,g),w=sw(v);if(i.isClose(w)||!r.isAccessible(v)||b.indexOf(w)>=0&&!v.equals(d)&&sm(p,sf(v,d,y,u,s))>s.maxDirectionChange)continue;let x=P+e.cost+(O?0:s.penalties[t]);(!i.isOpen(w)||x<a[w])&&(n[w]=v,o[w]=C,a[w]=x,i.add(w,x+sC(v,c)))}w-=1}}return s.fallbackRoute?e_.Iw.call(s.fallbackRoute,this,l,d,s):null}(i,r,s,h,n)),null===d)return e_.Iw.call(n.fallbackRouter,this,e,n,i);let p=d[0];p&&p.equals(u)&&d.shift(),u=d[d.length-1]||u,g.push(...d)}return n.snapToGrid?function(e,t=10){if(e.length<=1)return e;for(let i=0,r=e.length;i<r-1;i+=1){let r=e[i],s=e[i+1];if(r.x===s.x){let e=t*Math.round(r.x/t);r.x!==e&&(r.x=e,s.x=e)}else if(r.y===s.y){let e=t*Math.round(r.y/t);r.y!==e&&(r.y=e,s.y=e)}}return e}(g,i.graph.grid.getGridSize()):g},sO=function(e,t,i){return e_.Iw.call(sP,this,e,Object.assign(Object.assign({},sa),t),i)},sA={maxDirectionChange:45,directions(){let e=sh(this.step,this),t=sh(this.cost,this),i=Math.ceil(Math.sqrt(e*e<<1));return[{cost:t,offsetX:e,offsetY:0},{cost:i,offsetX:e,offsetY:e},{cost:t,offsetX:0,offsetY:e},{cost:i,offsetX:-e,offsetY:e},{cost:t,offsetX:-e,offsetY:0},{cost:i,offsetX:-e,offsetY:-e},{cost:t,offsetX:0,offsetY:-e},{cost:i,offsetX:e,offsetY:-e}]},fallbackRoute(e,t,i){let r=e.theta(t),s=[],n={x:t.x,y:e.y},o={x:e.x,y:t.y};if(r%180>90){let e=n;n=o,o=e}let l=r%90<45?n:o,a=new e0.x1(e,l),h=90*Math.ceil(r/90),c=e0.E9.fromPolar(a.squaredLength(),e0.RZ.toRad(h+135),l),g=new e0.x1(t,c),u=a.intersectsWithLine(g),d=u||t,p=u?d:e,f=360/i.directions.length,m=p.theta(t),y=e0.RZ.normalize(m+f/2);return i.previousDirectionAngle=f*Math.floor(y/f),d&&s.push(d.round()),s.push(t),s}},sM=function(e,t,i){return e_.Iw.call(sO,this,e,Object.assign(Object.assign({},sA),t),i)},sS=function(e,t,i){let r,s,n,o=t.offset||32,l=null==t.min?16:t.min,a=0,h=t.direction,c=i.sourceBBox,g=i.targetBBox,u=c.getCenter(),d=g.getCenter();if("number"==typeof o&&(a=o),null==h){let e=g.left-c.right,t=g.top-c.bottom;e>=0&&t>=0?h=e>=t?"L":"T":e<=0&&t>=0?h=(e=c.left-g.right)>=0&&e>=t?"R":"T":e>=0&&t<=0?h=(t=c.top-g.bottom)>=0?e>=t?"L":"B":"L":(e=c.left-g.right,t=c.top-g.bottom,h=e>=0&&t>=0?e>=t?"R":"B":e<=0&&t>=0?"B":e>=0&&t<=0||Math.abs(e)>Math.abs(t)?"R":"B")}"H"===h?h=d.x-u.x>=0?"L":"R":"V"===h&&(h=d.y-u.y>=0?"T":"B"),"center"===o&&("L"===h?a=(g.left-c.right)/2:"R"===h?a=(c.left-g.right)/2:"T"===h?a=(g.top-c.bottom)/2:"B"===h&&(a=(c.top-g.bottom)/2));let p="L"===h||"R"===h;if(p){if(d.y===u.y)return[...e];n="L"===h?1:-1,r="x",s="width"}else{if(d.x===u.x)return[...e];n="T"===h?1:-1,r="y",s="height"}let f=u.clone(),m=d.clone();if(f[r]+=n*(c[s]/2+a),m[r]-=n*(g[s]/2+a),p){let e=f.x,t=m.x,i=c.width/2+l,r=g.width/2+l;d.x>u.x?t<=e&&(f.x=Math.max(t,u.x+i),m.x=Math.min(e,d.x-r)):t>=e&&(f.x=Math.min(t,u.x-i),m.x=Math.max(e,d.x+r))}else{let e=f.y,t=m.y,i=c.height/2+l,r=g.height/2+l;d.y>u.y?t<=e&&(f.y=Math.max(t,u.y+i),m.y=Math.min(e,d.y-r)):t>=e&&(f.y=Math.min(t,u.y-i),m.y=Math.max(e,d.y+r))}return[f.toJSON(),...e,m.toJSON()]};function sT(e,t){if(null!=t&&!1!==t){let i="boolean"==typeof t?0:t;if(i>0){let t=e0.E9.create(e[1]).move(e[2],i),r=e0.E9.create(e[1]).move(e[0],i);return[t.toJSON(),...e,r.toJSON()]}{let t=e[1];return[Object.assign({},t),...e,Object.assign({},t)]}}return e}let sk=function(e,t,i){let r=t.width||50,s=(t.height||80)/2,n=t.angle||"auto",o=i.sourceAnchor,l=i.targetAnchor,a=i.sourceBBox,h=i.targetBBox;if(o.equals(l)){let e=e=>{let t=e0.RZ.toRad(e),i=Math.sin(t),n=Math.cos(t),l=new e0.E9(o.x+n*r,o.y+i*r),a=new e0.E9(l.x-n*s,l.y-i*s),h=a.clone().rotate(-90,l),c=a.clone().rotate(90,l);return[h.toJSON(),l.toJSON(),c.toJSON()]},i=e=>{let t=o.clone().move(e,-1),i=new e0.x1(t,e);return!a.containsPoint(e)&&!a.intersectsWithLine(i)},l=[0,90,180,270,45,135,225,315];if("number"==typeof n)return sT(e(n),t.merge);let h=a.getCenter();if(h.equals(o))return sT(e(0),t.merge);let c=h.angleBetween(o,h.clone().translate(1,0)),g=e(c);if(i(g[1]))return sT(g,t.merge);for(let t=1,r=l.length;t<r&&!i((g=e(c+l[t]))[1]);t+=1);return sT(g,t.merge)}{let e=new e0.x1(o,l),n=e.parallel(-r),c=n.getCenter(),g=n.start.clone().move(n.end,s),u=n.end.clone().move(n.start,s),d=e.parallel(-1),p=new e0.x1(d.start,c),f=new e0.x1(d.end,c);if((a.containsPoint(c)||h.containsPoint(c)||a.intersectsWithLine(p)||a.intersectsWithLine(f)||h.intersectsWithLine(p)||h.intersectsWithLine(f))&&(c=(n=e.parallel(r)).getCenter(),g=n.start.clone().move(n.end,s),u=n.end.clone().move(n.start,s)),t.merge){let e=new e0.x1(o,l),t=new e0.x1(c,e.center).setLength(Number.MAX_SAFE_INTEGER),r=a.intersectsWithLine(t),s=h.intersectsWithLine(t),n=r?Array.isArray(r)?r:[r]:[];s&&(Array.isArray(s)?n.push(...s):n.push(s));let g=e.center.closest(n);g?(i.sourceAnchor=g.clone(),i.targetAnchor=g.clone()):(i.sourceAnchor=e.center.clone(),i.targetAnchor=e.center.clone())}return sT([g.toJSON(),c.toJSON(),u.toJSON()],t.merge)}};(L=eB||(eB={})).presets=eX,L.registry=e1.create({type:"router"}),L.registry.register(L.presets,!0);let sN=function(e,t,i,r={}){let s=[e,...i,t],n=new e0.aH(s),o=new e0.y$(n);return r.raw?o:o.serialize()},sj=function(e,t,i,r={}){let s=+(3!==i.length),n=e0.E9.create(i[0+s]),o=e0.E9.create(i[2+s]),l=e0.E9.create(i[1+s]);if(!e0.E9.equals(e,t)){let i=new e0.E9((e.x+t.x)/2,(e.y+t.y)/2),r=i.angleBetween(e0.E9.create(e).rotate(90,i),l);r>1&&(n.rotate(180-r,i),o.rotate(180-r,i),l.rotate(180-r,i))}let a=`
     M ${e.x} ${e.y}
     Q ${n.x} ${n.y} ${l.x} ${l.y}
     Q ${o.x} ${o.y} ${t.x} ${t.y}
  `;return r.raw?e0.y$.parse(a):a},sB=function(e,t,i,r={}){let s,n,o=new e0.y$;o.appendSegment(e0.y$.createSegment("M",e));let l=1/3,a=2/3,h=r.radius||10;for(let r=0,c=i.length;r<c;r+=1){let c=e0.E9.create(i[r]),g=i[r-1]||e,u=i[r+1]||t;s=n||c.distance(g)/2,n=c.distance(u)/2;let d=-Math.min(h,s),p=-Math.min(h,n),f=c.clone().move(g,d).round(),m=c.clone().move(u,p).round(),y=new e0.E9(l*f.x+a*c.x,a*c.y+l*f.y),b=new e0.E9(l*m.x+a*c.x,a*c.y+l*m.y);o.appendSegment(e0.y$.createSegment("L",f)),o.appendSegment(e0.y$.createSegment("C",y,b,m))}return o.appendSegment(e0.y$.createSegment("L",t)),r.raw?o:o.serialize()},sR=function(e,t,i,r={}){let s,n=r.direction;if(i&&0!==i.length){let r=[e,...i,t],n=e0.Hy.throughPoints(r);s=new e0.y$(n)}else if((s=new e0.y$).appendSegment(e0.y$.createSegment("M",e)),n||(n=Math.abs(e.x-t.x)>=Math.abs(e.y-t.y)?"H":"V"),"H"===n){let i=(e.x+t.x)/2;s.appendSegment(e0.y$.createSegment("C",i,e.y,i,t.y,t.x,t.y))}else{let i=(e.y+t.y)/2;s.appendSegment(e0.y$.createSegment("C",e.x,i,t.x,i,t.x,t.y))}return r.raw?s:s.serialize()},sD=1/3,sV=2/3;function sI(e,t,i=[]){let r=[e,...i,t],s=[];return r.forEach((e,t)=>{let i=r[t+1];null!=i&&s.push(new e0.x1(e,i))}),s}function sL(e,t){return new e0.x1(e,t).squaredLength()}function s$(e,t,i,s){let n,o=new e0.y$;return n=e0.y$.createSegment("M",e[0].start),o.appendSegment(n),e.forEach((l,a)=>{if(r.includes(l)){let e,r,s,a;if("arc"===i){let t;e=-90,((r=l.start.diff(l.end)).x<0||0===r.x&&r.y<0)&&(e+=180);let i=l.getCenter(),h=new e0.x1(i,l.end).rotate(e,i);s=(t=new e0.x1(l.start,i)).pointAt(2/3).rotate(e,l.start),a=h.pointAt(1/3).rotate(-e,h.end),n=e0.y$.createSegment("C",s,a,h.end),o.appendSegment(n),t=new e0.x1(i,l.end),s=h.pointAt(1/3).rotate(e,h.end),a=t.pointAt(1/3).rotate(-e,l.end),n=e0.y$.createSegment("C",s,a,l.end),o.appendSegment(n)}else if("gap"===i)n=e0.y$.createSegment("M",l.end),o.appendSegment(n);else if("cubic"===i){e=l.start.theta(l.end);let i=.6*t,h=1.35*t;((r=l.start.diff(l.end)).x<0||0===r.x&&r.y<0)&&(h*=-1),s=new e0.E9(l.start.x+i,l.start.y+h).rotate(e,l.start),a=new e0.E9(l.end.x-i,l.end.y+h).rotate(e,l.end),n=e0.y$.createSegment("C",s,a,l.end),o.appendSegment(n)}}else{let t=e[a+1];0===s||!t||r.includes(t)?(n=e0.y$.createSegment("L",l.end),o.appendSegment(n)):function(e,t,i,r,s){let n,o=i.distance(r)/2,l=i.distance(s)/2,a=-Math.min(e,o),h=-Math.min(e,l),c=i.clone().move(r,a).round(),g=i.clone().move(s,h).round(),u=new e0.E9(sD*c.x+sV*i.x,sV*i.y+sD*c.y),d=new e0.E9(sD*g.x+sV*i.x,sV*i.y+sD*g.y);n=e0.y$.createSegment("L",c),t.appendSegment(n),n=e0.y$.createSegment("C",u,d,g),t.appendSegment(n)}(s,o,l.end,l.start,t.end)}}),o}let sz=function(e,t,i,n={}){r=[],s=[];var o=this;let l=o.graph._jumpOverUpdateList;if(null==l&&(l=o.graph._jumpOverUpdateList=[],o.graph.on("cell:mouseup",()=>{let e=o.graph._jumpOverUpdateList;setTimeout(()=>{for(let t=0;t<e.length;t+=1)e[t].update()})}),o.graph.on("model:reseted",()=>{l=o.graph._jumpOverUpdateList=[]})),0>l.indexOf(o)){l.push(o);let e=()=>l.splice(l.indexOf(o),1);o.cell.once("change:connector",e),o.cell.once("removed",e)}let a=n.size||5,h=n.type||"arc",c=n.radius||0,g=n.ignoreConnectors||["smooth"],u=this.graph,d=u.model.getEdges();if(1===d.length)return s$(sI(e,t,i),a,h,c);let p=this.cell,f=d.indexOf(p),m=u.options.connecting.connector||{},y=d.filter((e,t)=>{let i=e.getConnector()||m;return!g.includes(i.name)&&(!(t>f)||"jumpover"!==i.name)}),b=y.map(e=>u.findViewByCell(e)),v=sI(e,t,i),w=b.map(e=>null==e?[]:e===this?v:sI(e.sourcePoint,e.targetPoint,e.routePoints)),x=[];v.forEach(e=>{let t=y.reduce((t,i,r)=>{if(i!==p){let i=function(e,t){let i=[];return t.forEach(t=>{let r=e.intersectsWithLine(t);r&&i.push(r)}),i}(e,w[r]);t.push(...i)}return t},[]).sort((t,i)=>sL(e.start,t)-sL(e.start,i));if(t.length>0)x.push(...t.reduce((i,n,o)=>{if(s.includes(n))return i;let l=i.pop()||e,h=e0.E9.create(n).move(l.start,-a),c=e0.E9.create(n).move(l.start,+a),g=t[o+1];if(null!=g){let e=c.distance(g);e<=a&&(c=g.move(l.start,e),s.push(g))}else if(h.distance(l.end)<2*a+1)return i.push(l),i;if(c.distance(l.start)<2*a+1)return i.push(l),i;let u=new e0.x1(h,c);return r.push(u),i.push(new e0.x1(l.start,h),u,new e0.x1(c,l.end)),i},[]));else x.push(e)});let C=s$(x,a,h,c);return r=[],s=[],n.raw?C:C.serialize()};($=eR||(eR={})).presets=eY,$.registry=e1.create({type:"connector"}),$.registry.register($.presets,!0);class sF extends e_.ew{constructor(e={}){super(),this.pending=!1,this.changing=!1,this.data={},this.mutate(e_.QK.cloneDeep(e)),this.changed={}}mutate(e,t={}){let i=!0===t.unset,r=!0===t.silent,s=[],n=this.changing;this.changing=!0,n||(this.previous=e_.QK.cloneDeep(this.data),this.changed={});let o=this.data,l=this.previous,a=this.changed;if(Object.keys(e).forEach(t=>{let r=e[t];e_.QK.isEqual(o[t],r)||s.push(t),e_.QK.isEqual(l[t],r)?delete a[t]:a[t]=r,i?delete o[t]:o[t]=r}),!r&&s.length>0&&(this.pending=!0,this.pendingOptions=t,s.forEach(e=>{this.emit("change:*",{key:e,options:t,store:this,current:o[e],previous:l[e]})})),n)return this;if(!r)for(;this.pending;)this.pending=!1,this.emit("changed",{current:o,previous:l,store:this,options:this.pendingOptions});return this.pending=!1,this.changing=!1,this.pendingOptions=null,this}get(e,t){if(null==e)return this.data;let i=this.data[e];return null==i?t:i}getPrevious(e){if(this.previous){let t=this.previous[e];return null==t?void 0:t}}set(e,t,i){return null!=e&&("object"==typeof e?this.mutate(e,t):this.mutate({[e]:t},i)),this}remove(e,t){let i,r=void 0,s={};if("string"==typeof e)s[e]=r,i=t;else if(Array.isArray(e))e.forEach(e=>s[e]=r),i=t;else{for(let e in this.data)s[e]=r;i=e}return this.mutate(s,Object.assign(Object.assign({},i),{unset:!0})),this}getByPath(e){return e_.QK.getByPath(this.data,e,"/")}setByPath(e,t,i={}){let r=Array.isArray(e)?[...e]:e.split("/"),s=Array.isArray(e)?e.join("/"):e,n=r[0],o=r.length;if(i.propertyPath=s,i.propertyValue=t,i.propertyPathArray=r,1===o)this.set(n,t,i);else{let s={},l=s,a=n;for(let e=1;e<o;e+=1){let t=r[e],i=Number.isFinite(Number(t));l=l[a]=i?[]:{},a=t}e_.QK.setByPath(s,r,t,"/");let h=e_.QK.cloneDeep(this.data);i.rewrite&&e_.QK.unsetByPath(h,e,"/");let c=e_.QK.merge(h,s);this.set(n,c[n],i)}return this}removeByPath(e,t){let i=Array.isArray(e)?e:e.split("/"),r=i[0];if(1===i.length)this.remove(r,t);else{let e=i.slice(1),s=e_.QK.cloneDeep(this.get(r));s&&e_.QK.unsetByPath(s,e),this.set(r,s,t)}return this}hasChanged(e){return null==e?Object.keys(this.changed).length>0:e in this.changed}getChanges(e){let t;if(null==e)return this.hasChanged()?e_.QK.cloneDeep(this.changed):null;let i=this.changing?this.previous:this.data,r={};for(let s in e){let n=e[s];e_.QK.isEqual(i[s],n)||(r[s]=n,t=!0)}return t?e_.QK.cloneDeep(r):null}toJSON(){return e_.QK.cloneDeep(this.data)}clone(){return new this.constructor(this.data)}dispose(){this.off(),this.data={},this.previous={},this.changed={},this.pending=!1,this.changing=!1,this.pendingOptions=null,this.trigger("disposed",{store:this})}}!function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);n>3&&o&&Object.defineProperty(t,i,o)}([e_.ew.dispose()],sF.prototype,"dispose",null);class sG{constructor(e){this.cell=e,this.ids={},this.cache={}}get(){return Object.keys(this.ids)}start(e,t,i={},r="/"){let s=this.cell.getPropByPath(e),n=e_.QK.defaults(i,sG.defaultOptions),o=this.getTiming(n.timing),l=this.getInterp(n.interp,s,t),a=0,h=Array.isArray(e)?e.join(r):e,c=Array.isArray(e)?e:e.split(r),g=()=>{let e=new Date().getTime();0===a&&(a=e);let t=(e-a)/n.duration;t<1?this.ids[h]=requestAnimationFrame(g):t=1;let r=l(o(t));this.cell.setPropByPath(c,r),i.progress&&i.progress(Object.assign({progress:t,currentValue:r},this.getArgs(h))),1===t&&(this.cell.notify("transition:complete",this.getArgs(h)),i.complete&&i.complete(this.getArgs(h)),this.cell.notify("transition:finish",this.getArgs(h)),i.finish&&i.finish(this.getArgs(h)),this.clean(h))};return setTimeout(()=>{this.stop(e,void 0,r),this.cache[h]={startValue:s,targetValue:t,options:n},this.ids[h]=requestAnimationFrame(g),this.cell.notify("transition:start",this.getArgs(h)),i.start&&i.start(this.getArgs(h))},i.delay),this.stop.bind(this,e,r,i)}stop(e,t={},i="/"){let r=Array.isArray(e)?e:e.split(i);return Object.keys(this.ids).filter(e=>e_.QK.isEqual(r,e.split(i).slice(0,r.length))).forEach(e=>{cancelAnimationFrame(this.ids[e]);let i=this.cache[e],r=this.getArgs(e),s=Object.assign(Object.assign({},i.options),t),n=s.jumpedToEnd;n&&null!=i.targetValue&&(this.cell.setPropByPath(e,i.targetValue),this.cell.notify("transition:end",Object.assign({},r)),this.cell.notify("transition:complete",Object.assign({},r)),s.complete&&s.complete(Object.assign({},r)));let o=Object.assign({jumpedToEnd:n},r);this.cell.notify("transition:stop",Object.assign({},o)),s.stop&&s.stop(Object.assign({},o)),this.cell.notify("transition:finish",Object.assign({},r)),s.finish&&s.finish(Object.assign({},r)),this.clean(e)}),this}clean(e){delete this.ids[e],delete this.cache[e]}getTiming(e){return"string"==typeof e?e_.Yt[e]:e}getInterp(e,t,i){return e?e(t,i):"number"==typeof i?e_.CG.number(t,i):"string"==typeof i?"#"===i[0]?e_.CG.color(t,i):e_.CG.unit(t,i):e_.CG.object(t,i)}getArgs(e){let t=this.cache[e];return{path:e,startValue:t.startValue,targetValue:t.targetValue,cell:this.cell}}}(sG||(sG={})).defaultOptions={delay:10,duration:100,timing:"linear"};var sH=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};class sU extends e_.ew{static config(e){let{markup:t,propHooks:i,attrHooks:r}=e,s=sH(e,["markup","propHooks","attrHooks"]);null!=t&&(this.markup=t),i&&(this.propHooks=this.propHooks.slice(),Array.isArray(i)?this.propHooks.push(...i):"function"==typeof i?this.propHooks.push(i):Object.values(i).forEach(e=>{"function"==typeof e&&this.propHooks.push(e)})),r&&(this.attrHooks=Object.assign(Object.assign({},this.attrHooks),r)),this.defaults=e_.QK.merge({},this.defaults,s)}static getMarkup(){return this.markup}static getDefaults(e){return e?this.defaults:e_.QK.cloneDeep(this.defaults)}static getAttrHooks(){return this.attrHooks}static applyPropHooks(e,t){return this.propHooks.reduce((t,i)=>i?e_.Iw.call(i,e,t):t,t)}get[Symbol.toStringTag](){return sU.toStringTag}constructor(e={}){super();let t=this.constructor.getDefaults(!0),i=e_.QK.merge({},this.preprocess(t),this.preprocess(e));this.id=i.id||e_.kf.uuid(),this.store=new sF(i),this.animation=new sG(this),this.setup(),this.init(),this.postprocess(e)}init(){}get model(){return this._model}set model(e){this._model!==e&&(this._model=e)}preprocess(e,t){let i=e.id,r=this.constructor.applyPropHooks(this,e);return null==i&&!0!==t&&(r.id=e_.kf.uuid()),r}postprocess(e){}setup(){this.store.on("change:*",e=>{let{key:t,current:i,previous:r,options:s}=e;this.notify("change:*",{key:t,options:s,current:i,previous:r,cell:this}),this.notify(`change:${t}`,{options:s,current:i,previous:r,cell:this}),("source"===t||"target"===t)&&this.notify("change:terminal",{type:t,current:i,previous:r,options:s,cell:this})}),this.store.on("changed",({options:e})=>this.notify("changed",{options:e,cell:this}))}notify(e,t){this.trigger(e,t);let i=this.model;return i&&(i.notify(`cell:${e}`,t),this.isNode()?i.notify(`node:${e}`,Object.assign(Object.assign({},t),{node:this})):this.isEdge()&&i.notify(`edge:${e}`,Object.assign(Object.assign({},t),{edge:this}))),this}isNode(){return!1}isEdge(){return!1}isSameStore(e){return this.store===e.store}get view(){return this.store.get("view")}get shape(){return this.store.get("shape","")}getProp(e,t){return null==e?this.store.get():this.store.get(e,t)}setProp(e,t,i){if("string"==typeof e)this.store.set(e,t,i);else{let i=this.preprocess(e,!0);this.store.set(e_.QK.merge({},this.getProp(),i),t),this.postprocess(e)}return this}removeProp(e,t){return"string"==typeof e||Array.isArray(e)?this.store.removeByPath(e,t):this.store.remove(t),this}hasChanged(e){return null==e?this.store.hasChanged():this.store.hasChanged(e)}getPropByPath(e){return this.store.getByPath(e)}setPropByPath(e,t,i={}){return this.model&&("children"===e?this._children=t?t.map(e=>this.model.getCell(e)).filter(e=>null!=e):null:"parent"===e&&(this._parent=t?this.model.getCell(t):null)),this.store.setByPath(e,t,i),this}removePropByPath(e,t={}){let i=Array.isArray(e)?e:e.split("/");return"attrs"===i[0]&&(t.dirty=!0),this.store.removeByPath(i,t),this}prop(e,t,i){return null==e?this.getProp():"string"==typeof e||Array.isArray(e)?1==arguments.length?this.getPropByPath(e):null==t?this.removePropByPath(e,i||{}):this.setPropByPath(e,t,i||{}):this.setProp(e,t||{})}previous(e){return this.store.getPrevious(e)}get zIndex(){return this.getZIndex()}set zIndex(e){null==e?this.removeZIndex():this.setZIndex(e)}getZIndex(){return this.store.get("zIndex")}setZIndex(e,t={}){return this.store.set("zIndex",e,t),this}removeZIndex(e={}){return this.store.remove("zIndex",e),this}toFront(e={}){let t=this.model;if(t){let i,r=t.getMaxZIndex();e.deep?(i=this.getDescendants({deep:!0,breadthFirst:!0})).unshift(this):i=[this],r=r-i.length+1;let s=t.total(),n=t.indexOf(this)!==s-i.length;n||(n=i.some((e,t)=>e.getZIndex()!==r+t)),n&&this.batchUpdate("to-front",()=>{r+=i.length,i.forEach((t,i)=>{t.setZIndex(r+i,e)})})}return this}toBack(e={}){let t=this.model;if(t){let i,r=t.getMinZIndex();e.deep?(i=this.getDescendants({deep:!0,breadthFirst:!0})).unshift(this):i=[this];let s=0!==t.indexOf(this);s||(s=i.some((e,t)=>e.getZIndex()!==r+t)),s&&this.batchUpdate("to-back",()=>{r-=i.length,i.forEach((t,i)=>{t.setZIndex(r+i,e)})})}return this}get markup(){return this.getMarkup()}set markup(e){null==e?this.removeMarkup():this.setMarkup(e)}getMarkup(){let e=this.store.get("markup");return null==e&&(e=this.constructor.getMarkup()),e}setMarkup(e,t={}){return this.store.set("markup",e,t),this}removeMarkup(e={}){return this.store.remove("markup",e),this}get attrs(){return this.getAttrs()}set attrs(e){null==e?this.removeAttrs():this.setAttrs(e)}getAttrs(){let e=this.store.get("attrs");return e?Object.assign({},e):{}}setAttrs(e,t={}){if(null==e)this.removeAttrs(t);else{let i=e=>this.store.set("attrs",e,t);if(!0===t.overwrite)i(e);else{let r=this.getAttrs();i(!1===t.deep?Object.assign(Object.assign({},r),e):e_.QK.merge({},r,e))}}return this}replaceAttrs(e,t={}){return this.setAttrs(e,Object.assign(Object.assign({},t),{overwrite:!0}))}updateAttrs(e,t={}){return this.setAttrs(e,Object.assign(Object.assign({},t),{deep:!1}))}removeAttrs(e={}){return this.store.remove("attrs",e),this}getAttrDefinition(e){if(!e)return null;let t=this.constructor.getAttrHooks()||{},i=t[e]||eb.registry.get(e);if(!i){let r=e_.kf.camelCase(e);i=t[r]||eb.registry.get(r)}return i||null}getAttrByPath(e){return null==e||""===e?this.getAttrs():this.getPropByPath(this.prefixAttrPath(e))}setAttrByPath(e,t,i={}){return this.setPropByPath(this.prefixAttrPath(e),t,i),this}removeAttrByPath(e,t={}){return this.removePropByPath(this.prefixAttrPath(e),t),this}prefixAttrPath(e){return Array.isArray(e)?["attrs"].concat(e):`attrs/${e}`}attr(e,t,i){return null==e?this.getAttrByPath():"string"==typeof e||Array.isArray(e)?1==arguments.length?this.getAttrByPath(e):null==t?this.removeAttrByPath(e,i||{}):this.setAttrByPath(e,t,i||{}):this.setAttrs(e,t||{})}get visible(){return this.isVisible()}set visible(e){this.setVisible(e)}setVisible(e,t={}){return this.store.set("visible",e,t),this}isVisible(){return!1!==this.store.get("visible")}show(e={}){return this.isVisible()||this.setVisible(!0,e),this}hide(e={}){return this.isVisible()&&this.setVisible(!1,e),this}toggleVisible(e,t={}){let i="boolean"==typeof e?e:!this.isVisible(),r="boolean"==typeof e?t:e;return i?this.show(r):this.hide(r),this}get data(){return this.getData()}set data(e){this.setData(e)}getData(){return this.store.get("data")}setData(e,t={}){if(null==e)this.removeData(t);else{let i=e=>this.store.set("data",e,t);if(!0===t.overwrite)i(e);else{let r=this.getData();i(!1===t.deep?"object"==typeof e?Object.assign(Object.assign({},r),e):e:e_.QK.merge({},r,e))}}return this}replaceData(e,t={}){return this.setData(e,Object.assign(Object.assign({},t),{overwrite:!0}))}updateData(e,t={}){return this.setData(e,Object.assign(Object.assign({},t),{deep:!1}))}removeData(e={}){return this.store.remove("data",e),this}get parent(){return this.getParent()}get children(){return this.getChildren()}getParentId(){return this.store.get("parent")}getParent(){let e=this.getParentId();if(e&&this.model){let t=this.model.getCell(e);return this._parent=t,t}return null}getChildren(){let e=this.store.get("children");if(e&&e.length&&this.model){let t=e.map(e=>{var t;return null==(t=this.model)?void 0:t.getCell(e)}).filter(e=>null!=e);return this._children=t,[...t]}return null}hasParent(){return null!=this.parent}isParentOf(e){return null!=e&&e.getParent()===this}isChildOf(e){return null!=e&&this.getParent()===e}eachChild(e,t){return this.children&&this.children.forEach(e,t),this}filterChild(e,t){return this.children?this.children.filter(e,t):[]}getChildCount(){return null==this.children?0:this.children.length}getChildIndex(e){return null==this.children?-1:this.children.indexOf(e)}getChildAt(e){return null!=this.children&&e>=0?this.children[e]:null}getAncestors(e={}){let t=[],i=this.getParent();for(;i;)t.push(i),i=!1!==e.deep?i.getParent():null;return t}getDescendants(e={}){if(!1!==e.deep){if(e.breadthFirst){let e=[],t=this.getChildren()||[];for(;t.length>0;){let i=t.shift(),r=i.getChildren();e.push(i),r&&t.push(...r)}return e}{let t=this.getChildren()||[];return t.forEach(i=>{t.push(...i.getDescendants(e))}),t}}return this.getChildren()||[]}isDescendantOf(e,t={}){if(null==e)return!1;if(!1!==t.deep){let t=this.getParent();for(;t;){if(t===e)return!0;t=t.getParent()}return!1}return this.isChildOf(e)}isAncestorOf(e,t={}){return null!=e&&e.isDescendantOf(this,t)}contains(e){return this.isAncestorOf(e)}getCommonAncestor(...e){return sU.getCommonAncestor(this,...e)}setParent(e,t={}){return this._parent=e,e?this.store.set("parent",e.id,t):this.store.remove("parent",t),this}setChildren(e,t={}){return this._children=e,null!=e?this.store.set("children",e.map(e=>e.id),t):this.store.remove("children",t),this}unembed(e,t={}){let i=this.children;if(null!=i&&null!=e){let r=this.getChildIndex(e);-1!==r&&(i.splice(r,1),e.setParent(null,t),this.setChildren(i,t))}return this}embed(e,t={}){return e.addTo(this,t),this}addTo(e,t={}){return sU.isCell(e)?e.addChild(this,t):e.addCell(this,t),this}insertTo(e,t,i={}){return e.insertChild(this,t,i),this}addChild(e,t={}){return this.insertChild(e,void 0,t)}insertChild(e,t,i={}){if(null!=e&&e!==this){let r=e.getParent(),s=this!==r,n=t;if(null==n&&(n=this.getChildCount(),s||(n-=1)),r){let t=r.getChildren();if(t){let s=t.indexOf(e);s>=0&&(e.setParent(null,i),t.splice(s,1),r.setChildren(t,i))}}let o=this.children;if(null==o?(o=[]).push(e):o.splice(n,0,e),e.setParent(this,i),this.setChildren(o,i),s&&this.model){let e=this.model.getIncomingEdges(this),t=this.model.getOutgoingEdges(this);e&&e.forEach(e=>e.updateParent(i)),t&&t.forEach(e=>e.updateParent(i))}this.model&&this.model.addCell(e,i)}return this}removeFromParent(e={}){let t=this.getParent();if(null!=t){let i=t.getChildIndex(this);t.removeChildAt(i,e)}return this}removeChild(e,t={}){let i=this.getChildIndex(e);return this.removeChildAt(i,t)}removeChildAt(e,t={}){let i=this.getChildAt(e);return null!=this.children&&null!=i&&(this.unembed(i,t),i.remove(t)),i}remove(e={}){return this.batchUpdate("remove",()=>{let t=this.getParent();t&&t.removeChild(this,e),!1!==e.deep&&this.eachChild(t=>t.remove(e)),this.model&&this.model.removeCell(this,e)}),this}transition(e,t,i={},r="/"){return this.animation.start(e,t,i,r)}stopTransition(e,t,i="/"){return this.animation.stop(e,t,i),this}getTransitions(){return this.animation.get()}translate(e,t,i){return this}scale(e,t,i,r){return this}addTools(e,t,i){let r=Array.isArray(e)?e:[e],s="string"==typeof t?t:null,n="object"==typeof t?t:"object"==typeof i?i:{};if(n.reset)return this.setTools({name:s,items:r,local:n.local},n);let o=e_.QK.cloneDeep(this.getTools());if(null==o||null==s||o.name===s)return null==o&&(o={}),o.items||(o.items=[]),o.name=s,o.items=[...o.items,...r],this.setTools(Object.assign({},o),n)}setTools(e,t={}){return null==e?this.removeTools():this.store.set("tools",sU.normalizeTools(e),t),this}getTools(){return this.store.get("tools")}removeTools(e={}){return this.store.remove("tools",e),this}hasTools(e){let t=this.getTools();return null!=t&&(null==e||t.name===e)}hasTool(e){let t=this.getTools();return null!=t&&t.items.some(t=>"string"==typeof t?t===e:t.name===e)}removeTool(e,t={}){let i=e_.QK.cloneDeep(this.getTools());if(i){let r=!1,s=i.items.slice(),n=e=>{s.splice(e,1),r=!0};if("number"==typeof e)n(e);else for(let t=s.length-1;t>=0;t-=1){let i=s[t];("string"==typeof i?i===e:i.name===e)&&n(t)}r&&(i.items=s,this.setTools(i,t))}return this}getBBox(e){return new e0.Ae}getConnectionPoint(e,t){return new e0.E9}toJSON(e={}){let t=Object.assign({},this.store.get()),i=Object.prototype.toString,r=this.isNode()?"node":this.isEdge()?"edge":"cell";if(!t.shape){let e=this.constructor;throw Error(`Unable to serialize ${r} missing "shape" prop, check the ${r} "${e.name||i.call(e)}"`)}let s=this.constructor,n=!0===e.diff,o=t.attrs||{},l=s.getDefaults(!0),a=n?this.preprocess(l,!0):l,h=a.attrs||{},c={};Object.entries(t).forEach(([e,s])=>{if(null!=s&&!Array.isArray(s)&&"object"==typeof s&&!e_.QK.isPlainObject(s))throw Error(`Can only serialize ${r} with plain-object props, but got a "${i.call(s)}" type of key "${e}" on ${r} "${this.id}"`);if("attrs"!==e&&"shape"!==e&&n){let i=a[e];e_.QK.isEqual(s,i)&&delete t[e]}}),Object.keys(o).forEach(e=>{let t=o[e],i=h[e];Object.keys(t).forEach(r=>{let s=t[r],n=i?i[r]:null;null==s||"object"!=typeof s||Array.isArray(s)?null!=i&&e_.QK.isEqual(n,s)||(null==c[e]&&(c[e]={}),c[e][r]=s):Object.keys(s).forEach(t=>{let o=s[t];null!=i&&null!=n&&e_.QK.isObject(n)&&e_.QK.isEqual(n[t],o)||(null==c[e]&&(c[e]={}),null==c[e][r]&&(c[e][r]={}),c[e][r][t]=o)})})});let g=Object.assign(Object.assign({},t),{attrs:e_.QK.isEmpty(c)?void 0:c});return null==g.attrs&&delete g.attrs,0===g.angle&&delete g.angle,e_.QK.cloneDeep(g)}clone(e={}){if(!e.deep){let t=Object.assign({},this.store.get());return e.keepId||delete t.id,delete t.parent,delete t.children,new this.constructor(t)}return sU.deepClone(this)[this.id]}findView(e){return e.findViewByCell(this)}startBatch(e,t={},i=this.model){return this.notify("batch:start",{name:e,data:t,cell:this}),i&&i.startBatch(e,Object.assign(Object.assign({},t),{cell:this})),this}stopBatch(e,t={},i=this.model){return i&&i.stopBatch(e,Object.assign(Object.assign({},t),{cell:this})),this.notify("batch:stop",{name:e,data:t,cell:this}),this}batchUpdate(e,t,i){let r=this.model;this.startBatch(e,i,r);let s=t();return this.stopBatch(e,i,r),s}dispose(){this.removeFromParent(),this.store.dispose()}}sU.defaults={},sU.attrHooks={},sU.propHooks=[],function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);n>3&&o&&Object.defineProperty(t,i,o)}([e_.ew.dispose()],sU.prototype,"dispose",null),(sU||(sU={})).normalizeTools=function(e){return"string"==typeof e?{items:[e]}:Array.isArray(e)?{items:e}:e.items?e:{items:[e]}},(z=sU||(sU={})).toStringTag=`X6.${z.name}`,z.isCell=function(e){if(null==e)return!1;if(e instanceof z)return!0;let t=e[Symbol.toStringTag];return(null==t||t===z.toStringTag)&&"function"==typeof e.isNode&&"function"==typeof e.isEdge&&"function"==typeof e.prop&&"function"==typeof e.attr},(F=sU||(sU={})).getCommonAncestor=function(...e){let t=e.filter(e=>null!=e).map(e=>e.getAncestors()).sort((e,t)=>e.length-t.length);return t.shift().find(e=>t.every(t=>t.includes(e)))||null},F.getCellsBBox=function(e,t={}){let i=null;for(let r=0,s=e.length;r<s;r+=1){let s=e[r],n=s.getBBox(t);if(n){if(s.isNode()){let e=s.getAngle();null!=e&&0!==e&&(n=n.bbox(e))}i=null==i?n:i.union(n)}}return i},F.deepClone=function(e){let t=[e,...e.getDescendants({deep:!0})];return F.cloneCells(t)},F.cloneCells=function(e){let t=e_.RO.uniq(e),i=t.reduce((e,t)=>(e[t.id]=t.clone(),e),{});return t.forEach(e=>{let t=i[e.id];if(t.isEdge()){let e=t.getSourceCellId(),r=t.getTargetCellId();e&&i[e]&&t.setSource(Object.assign(Object.assign({},t.getSource()),{cell:i[e].id})),r&&i[r]&&t.setTarget(Object.assign(Object.assign({},t.getTarget()),{cell:i[r].id}))}let r=e.getParent();r&&i[r.id]&&t.setParent(i[r.id]);let s=e.getChildren();if(s&&s.length){let e=s.reduce((e,t)=>(i[t.id]&&e.push(i[t.id]),e),[]);e.length>0&&t.setChildren(e)}}),i},(G=sU||(sU={})).config({propHooks(e){var{tools:t}=e,i=sH(e,["tools"]);return t&&(i.tools=G.normalizeTools(t)),i}}),(H=eD||(eD={})).exist=function(e,t){return t?null!=o&&o.exist(e):null!=l&&l.exist(e)},H.setEdgeRegistry=function(e){o=e},H.setNodeRegistry=function(e){l=e};class sq{constructor(e){this.ports=[],this.groups={},this.init(e_.QK.cloneDeep(e))}getPorts(){return this.ports}getGroup(e){return null!=e?this.groups[e]:null}getPortsByGroup(e){return this.ports.filter(t=>t.group===e||null==t.group&&null==e)}getPortsLayoutByGroup(e,t){let i,r=this.getPortsByGroup(e),s=e?this.getGroup(e):null,n=s?s.position:null,o=n?n.name:null;if(null!=o){let e=eC.registry.get(o);if(null==e)return eC.registry.onNotFound(o);i=e}else i=eC.presets.left;return i(r.map(e=>e&&e.position&&e.position.args||{}),t,n&&n.args||{}).map((e,i)=>{let s=r[i];return{portLayout:e,portId:s.id,portSize:s.size,portAttrs:s.attrs,labelSize:s.label.size,labelLayout:this.getPortLabelLayout(s,e0.E9.create(e.position),t)}})}init(e){let{groups:t,items:i}=e;null!=t&&Object.keys(t).forEach(e=>{this.groups[e]=this.parseGroup(t[e])}),Array.isArray(i)&&i.forEach(e=>{this.ports.push(this.parsePort(e))})}parseGroup(e){return Object.assign(Object.assign({},e),{label:this.getLabel(e,!0),position:this.getPortPosition(e.position,!0)})}parsePort(e){let t=Object.assign({},e),i=this.getGroup(e.group)||{};return t.markup=t.markup||i.markup,t.attrs=e_.QK.merge({},i.attrs,t.attrs),t.position=this.createPosition(i,t),t.label=e_.QK.merge({},i.label,this.getLabel(t)),t.zIndex=this.getZIndex(i,t),t.size=Object.assign(Object.assign({},i.size),t.size),t}getZIndex(e,t){return"number"==typeof t.zIndex?t.zIndex:"number"==typeof e.zIndex||"auto"===e.zIndex?e.zIndex:"auto"}createPosition(e,t){return e_.QK.merge({name:"left",args:{}},e.position,{args:t.args})}getPortPosition(e,t=!1){if(null==e){if(t)return{name:"left",args:{}}}else{if("string"==typeof e)return{name:e,args:{}};if(Array.isArray(e))return{name:"absolute",args:{x:e[0],y:e[1]}};if("object"==typeof e)return e}return{args:{}}}getPortLabelPosition(e,t=!1){if(null==e){if(t)return{name:"left",args:{}}}else{if("string"==typeof e)return{name:e,args:{}};if("object"==typeof e)return e}return{args:{}}}getLabel(e,t=!1){let i=e.label||{};return i.position=this.getPortLabelPosition(i.position,t),i}getPortLabelLayout(e,t,i){let r=e.label.position.name||"left",s=e.label.position.args||{},n=eE.registry.get(r)||eE.presets.left;return n?n(t,i,s):null}}var sW=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};class sK extends sU{get[Symbol.toStringTag](){return sK.toStringTag}constructor(e={}){super(e),this.initPorts()}preprocess(e,t){let{x:i,y:r,width:s,height:n}=e,o=sW(e,["x","y","width","height"]);if(null!=i||null!=r){let e=o.position;o.position=Object.assign(Object.assign({},e),{x:null!=i?i:e?e.x:0,y:null!=r?r:e?e.y:0})}if(null!=s||null!=n){let e=o.size;o.size=Object.assign(Object.assign({},e),{width:null!=s?s:e?e.width:0,height:null!=n?n:e?e.height:0})}return super.preprocess(o,t)}isNode(){return!0}size(e,t,i){return void 0===e?this.getSize():"number"==typeof e?this.setSize(e,t,i):this.setSize(e,t)}getSize(){let e=this.store.get("size");return e?Object.assign({},e):{width:1,height:1}}setSize(e,t,i){return"object"==typeof e?this.resize(e.width,e.height,t):this.resize(e,t,i),this}resize(e,t,i={}){this.startBatch("resize",i);let r=i.direction;if(r){let s=this.getSize();switch(r){case"left":case"right":t=s.height;break;case"top":case"bottom":e=s.width}let n={right:0,"top-right":0,top:1,"top-left":1,left:2,"bottom-left":2,bottom:3,"bottom-right":3}[r],o=e0.RZ.normalize(this.getAngle()||0);i.absolute&&(n+=Math.floor((o+45)/90),n%=4);let l=this.getBBox(),a=(0===n?l.getBottomLeft():1===n?l.getCorner():2===n?l.getTopRight():l.getOrigin()).clone().rotate(-o,l.getCenter()),h=Math.sqrt(e*e+t*t)/2,c=n*Math.PI/2;c+=Math.atan(n%2==0?t/e:e/t),c-=e0.RZ.toRad(o);let g=e0.E9.fromPolar(h,c,a).clone().translate(-(e/2),-(t/2));this.store.set("size",{width:e,height:t},i),this.setPosition(g.x,g.y,i)}else this.store.set("size",{width:e,height:t},i);return this.stopBatch("resize",i),this}scale(e,t,i,r={}){let s=this.getBBox().scale(e,t,null==i?void 0:i);return this.startBatch("scale",r),this.setPosition(s.x,s.y,r),this.resize(s.width,s.height,r),this.stopBatch("scale"),this}position(e,t,i){return"number"==typeof e?this.setPosition(e,t,i):this.getPosition(e)}getPosition(e={}){if(e.relative){let e=this.getParent();if(null!=e&&e.isNode()){let t=this.getPosition(),i=e.getPosition();return{x:t.x-i.x,y:t.y-i.y}}}let t=this.store.get("position");return t?Object.assign({},t):{x:0,y:0}}setPosition(e,t,i={}){let r,s,n;if("object"==typeof e?(r=e.x,s=e.y,n=t||{}):(r=e,s=t,n=i||{}),n.relative){let e=this.getParent();if(null!=e&&e.isNode()){let t=e.getPosition();r+=t.x,s+=t.y}}if(n.deep){let e=this.getPosition();this.translate(r-e.x,s-e.y,n)}else this.store.set("position",{x:r,y:s},n);return this}translate(e=0,t=0,i={}){if(0===e&&0===t)return this;i.translateBy=i.translateBy||this.id;let r=this.getPosition();if(null!=i.restrict&&i.translateBy===this.id){let s=this.getBBox({deep:!0}),n=i.restrict,o=r.x-s.x,l=r.y-s.y,a=Math.max(n.x+o,Math.min(n.x+n.width+o-s.width,r.x+e)),h=Math.max(n.y+l,Math.min(n.y+n.height+l-s.height,r.y+t));e=a-r.x,t=h-r.y}let s={x:r.x+e,y:r.y+t};return i.tx=e,i.ty=t,i.transition?("object"!=typeof i.transition&&(i.transition={}),this.transition("position",s,Object.assign(Object.assign({},i.transition),{interp:e_.CG.object})),this.eachChild(r=>{var s;(null==(s=i.exclude)?void 0:s.includes(r))||r.translate(e,t,i)})):(this.startBatch("translate",i),this.store.set("position",s,i),this.eachChild(r=>{var s;(null==(s=i.exclude)?void 0:s.includes(r))||r.translate(e,t,i)}),this.stopBatch("translate",i)),this}angle(e,t){return null==e?this.getAngle():this.rotate(e,t)}getAngle(){return this.store.get("angle",0)}rotate(e,t={}){let i=this.getAngle();if(t.center){let r=this.getSize(),s=this.getPosition(),n=this.getBBox().getCenter();n.rotate(i-e,t.center);let o=n.x-r.width/2-s.x,l=n.y-r.height/2-s.y;this.startBatch("rotate",{angle:e,options:t}),this.setPosition(s.x+o,s.y+l,t),this.rotate(e,Object.assign(Object.assign({},t),{center:null})),this.stopBatch("rotate")}else this.store.set("angle",t.absolute?e:(i+e)%360,t);return this}getBBox(e={}){if(e.deep){let e=this.getDescendants({deep:!0,breadthFirst:!0});return e.push(this),sU.getCellsBBox(e)}return e0.Ae.fromPositionAndSize(this.getPosition(),this.getSize())}getConnectionPoint(e,t){let i=this.getBBox(),r=i.getCenter(),s=e.getTerminal(t);if(null==s)return r;let n=s.port;if(!n||!this.hasPort(n))return r;let o=this.getPort(n);if(!o||!o.group)return r;let l=this.getPortsPosition(o.group)[n].position,a=e0.E9.create(l).translate(i.getOrigin()),h=this.getAngle();return h&&a.rotate(-h,r),a}fit(e={}){let t=(this.getChildren()||[]).filter(e=>e.isNode());if(0===t.length)return this;this.startBatch("fit-embeds",e),e.deep&&t.forEach(t=>t.fit(e));let{x:i,y:r,width:s,height:n}=sU.getCellsBBox(t),o=e_.GH.normalizeSides(e.padding);return i-=o.left,r-=o.top,s+=o.left+o.right,n+=o.bottom+o.top,this.store.set({position:{x:i,y:r},size:{width:s,height:n}},e),this.stopBatch("fit-embeds"),this}get portContainerMarkup(){return this.getPortContainerMarkup()}set portContainerMarkup(e){this.setPortContainerMarkup(e)}getDefaultPortContainerMarkup(){return this.store.get("defaultPortContainerMarkup")||eO.getPortContainerMarkup()}getPortContainerMarkup(){return this.store.get("portContainerMarkup")||this.getDefaultPortContainerMarkup()}setPortContainerMarkup(e,t={}){return this.store.set("portContainerMarkup",eO.clone(e),t),this}get portMarkup(){return this.getPortMarkup()}set portMarkup(e){this.setPortMarkup(e)}getDefaultPortMarkup(){return this.store.get("defaultPortMarkup")||eO.getPortMarkup()}getPortMarkup(){return this.store.get("portMarkup")||this.getDefaultPortMarkup()}setPortMarkup(e,t={}){return this.store.set("portMarkup",eO.clone(e),t),this}get portLabelMarkup(){return this.getPortLabelMarkup()}set portLabelMarkup(e){this.setPortLabelMarkup(e)}getDefaultPortLabelMarkup(){return this.store.get("defaultPortLabelMarkup")||eO.getPortLabelMarkup()}getPortLabelMarkup(){return this.store.get("portLabelMarkup")||this.getDefaultPortLabelMarkup()}setPortLabelMarkup(e,t={}){return this.store.set("portLabelMarkup",eO.clone(e),t),this}get ports(){let e=this.store.get("ports",{items:[]});return null==e.items&&(e.items=[]),e}getPorts(){return e_.QK.cloneDeep(this.ports.items)}getPortsByGroup(e){return this.getPorts().filter(t=>t.group===e)}getPort(e){return e_.QK.cloneDeep(this.ports.items.find(t=>t.id&&t.id===e))}getPortAt(e){return this.ports.items[e]||null}hasPorts(){return this.ports.items.length>0}hasPort(e){return -1!==this.getPortIndex(e)}getPortIndex(e){let t="string"==typeof e?e:e.id;return null!=t?this.ports.items.findIndex(e=>e.id===t):-1}getPortsPosition(e){let t=this.getSize();return this.port.getPortsLayoutByGroup(e,new e0.Ae(0,0,t.width,t.height)).reduce((e,t)=>{let i=t.portLayout;return e[t.portId]={position:Object.assign({},i.position),angle:i.angle||0},e},{})}getPortProp(e,t){return this.getPropByPath(this.prefixPortPath(e,t))}setPortProp(e,t,i,r){if("string"==typeof t||Array.isArray(t)){let s=this.prefixPortPath(e,t);return this.setPropByPath(s,i,r)}let s=this.prefixPortPath(e);return this.setPropByPath(s,t,i)}removePortProp(e,t,i){return"string"==typeof t||Array.isArray(t)?this.removePropByPath(this.prefixPortPath(e,t),i):this.removePropByPath(this.prefixPortPath(e),t)}portProp(e,t,i,r){return null==t?this.getPortProp(e):"string"==typeof t||Array.isArray(t)?2==arguments.length?this.getPortProp(e,t):null==i?this.removePortProp(e,t,r):this.setPortProp(e,t,i,r):this.setPortProp(e,t,i)}prefixPortPath(e,t){let i=this.getPortIndex(e);if(-1===i)throw Error(`Unable to find port with id: "${e}"`);return null==t||""===t?["ports","items",`${i}`]:Array.isArray(t)?["ports","items",`${i}`,...t]:`ports/items/${i}/${t}`}addPort(e,t){let i=[...this.ports.items];return i.push(e),this.setPropByPath("ports/items",i,t),this}addPorts(e,t){return this.setPropByPath("ports/items",[...this.ports.items,...e],t),this}insertPort(e,t,i){let r=[...this.ports.items];return r.splice(e,0,t),this.setPropByPath("ports/items",r,i),this}removePort(e,t={}){return this.removePortAt(this.getPortIndex(e),t)}removePortAt(e,t={}){if(e>=0){let i=[...this.ports.items];i.splice(e,1),t.rewrite=!0,this.setPropByPath("ports/items",i,t)}return this}removePorts(e,t){let i;if(Array.isArray(e)){if(i=t||{},e.length){i.rewrite=!0;let t=[...this.ports.items].filter(t=>!e.some(e=>{let i="string"==typeof e?e:e.id;return t.id===i}));this.setPropByPath("ports/items",t,i)}}else(i=e||{}).rewrite=!0,this.setPropByPath("ports/items",[],i);return this}getParsedPorts(){return this.port.getPorts()}getParsedGroups(){return this.port.groups}getPortsLayoutByGroup(e,t){return this.port.getPortsLayoutByGroup(e,t)}initPorts(){this.updatePortData(),this.on("change:ports",()=>{this.processRemovedPort(),this.updatePortData()})}processRemovedPort(){let e=this.ports,t={};e.items.forEach(e=>{e.id&&(t[e.id]=!0)});let i={};(this.store.getPrevious("ports")||{items:[]}).items.forEach(e=>{e.id&&!t[e.id]&&(i[e.id]=!0)});let r=this.model;r&&!e_.QK.isEmpty(i)&&(r.getConnectedEdges(this,{incoming:!0}).forEach(e=>{let t=e.getTargetPortId();t&&i[t]&&e.remove()}),r.getConnectedEdges(this,{outgoing:!0}).forEach(e=>{let t=e.getSourcePortId();t&&i[t]&&e.remove()}))}validatePorts(){let e={},t=[];return this.ports.items.forEach(i=>{"object"!=typeof i&&t.push(`Invalid port ${i}.`),null==i.id&&(i.id=this.generatePortId()),e[i.id]&&t.push("Duplicitied port id."),e[i.id]=!0}),t}generatePortId(){return e_.kf.uuid()}updatePortData(){let e=this.validatePorts();if(e.length>0)throw this.store.set("ports",this.store.getPrevious("ports")),Error(e.join(" "));let t=this.port?this.port.getPorts():null;this.port=new sq(this.ports);let i=this.port.getPorts(),r=t?i.filter(e=>t.find(t=>t.id===e.id)?null:e):[...i],s=t?t.filter(e=>i.find(t=>t.id===e.id)?null:e):[];r.length>0&&this.notify("ports:added",{added:r,cell:this,node:this}),s.length>0&&this.notify("ports:removed",{removed:s,cell:this,node:this})}}sK.defaults={angle:0,position:{x:0,y:0},size:{width:1,height:1}},(U=sK||(sK={})).toStringTag=`X6.${U.name}`,U.isNode=function(e){if(null==e)return!1;if(e instanceof U)return!0;let t=e[Symbol.toStringTag];return(null==t||t===U.toStringTag)&&"function"==typeof e.isNode&&"function"==typeof e.isEdge&&"function"==typeof e.prop&&"function"==typeof e.attr&&"function"==typeof e.size&&"function"==typeof e.position||!1},(sK||(sK={})).config({propHooks(e){var{ports:t}=e,i=sW(e,["ports"]);return t&&(i.ports=Array.isArray(t)?{items:t}:t),i}}),(q=sK||(sK={})).registry=e1.create({type:"node",process(e,t){if(eD.exist(e,!0))throw Error(`Node with name '${e}' was registered by anthor Edge`);if("function"==typeof t)return t.config({shape:e}),t;let i=q,{inherit:r}=t,s=sW(t,["inherit"]);if(r)if("string"==typeof r){let e=this.get(r);null==e?this.onNotFound(r,"inherited"):i=e}else i=r;null==s.constructorName&&(s.constructorName=e);let n=i.define.call(i,s);return n.config({shape:e}),n}}),eD.setNodeRegistry(q.registry),W=sK||(sK={}),a=0,W.define=function(e){var t;let{constructorName:i,overwrite:r}=e,s=sW(e,["constructorName","overwrite"]),n=e_.QK.createClass((t=i||s.shape)?e_.kf.pascalCase(t):(a+=1,`CustomNode${a}`),this);return n.config(s),s.shape&&W.registry.register(s.shape,n,r),n},W.create=function(e){let t=e.shape||"rect",i=W.registry.get(t);return i?new i(e):W.registry.onNotFound(t)};var sJ=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};class sQ extends sU{get[Symbol.toStringTag](){return sQ.toStringTag}constructor(e={}){super(e)}preprocess(e,t){let{source:i,sourceCell:r,sourcePort:s,sourcePoint:n,target:o,targetCell:l,targetPort:a,targetPoint:h}=e,c=sJ(e,["source","sourceCell","sourcePort","sourcePoint","target","targetCell","targetPort","targetPoint"]),g=e=>"string"==typeof e||"number"==typeof e;if(null!=i)if(sU.isCell(i))c.source={cell:i.id};else if(g(i))c.source={cell:i};else if(e0.E9.isPoint(i))c.source=i.toJSON();else if(Array.isArray(i))c.source={x:i[0],y:i[1]};else{let e=i.cell;sU.isCell(e)?c.source=Object.assign(Object.assign({},i),{cell:e.id}):c.source=i}if(null!=r||null!=s){let e=c.source;if(null!=r){let t=g(r)?r:r.id;e?e.cell=t:e=c.source={cell:t}}null!=s&&e&&(e.port=s)}else null!=n&&(c.source=e0.E9.create(n).toJSON());if(null!=o)if(sU.isCell(o))c.target={cell:o.id};else if(g(o))c.target={cell:o};else if(e0.E9.isPoint(o))c.target=o.toJSON();else if(Array.isArray(o))c.target={x:o[0],y:o[1]};else{let e=o.cell;sU.isCell(e)?c.target=Object.assign(Object.assign({},o),{cell:e.id}):c.target=o}if(null!=l||null!=a){let e=c.target;if(null!=l){let t=g(l)?l:l.id;e?e.cell=t:e=c.target={cell:t}}null!=a&&e&&(e.port=a)}else null!=h&&(c.target=e0.E9.create(h).toJSON());return super.preprocess(c,t)}setup(){super.setup(),this.on("change:labels",e=>this.onLabelsChanged(e)),this.on("change:vertices",e=>this.onVertexsChanged(e))}isEdge(){return!0}disconnect(e={}){return this.store.set({source:{x:0,y:0},target:{x:0,y:0}},e),this}get source(){return this.getSource()}set source(e){this.setSource(e)}getSource(){return this.getTerminal("source")}getSourceCellId(){return this.source.cell}getSourcePortId(){return this.source.port}setSource(e,t,i={}){return this.setTerminal("source",e,t,i)}get target(){return this.getTarget()}set target(e){this.setTarget(e)}getTarget(){return this.getTerminal("target")}getTargetCellId(){return this.target.cell}getTargetPortId(){return this.target.port}setTarget(e,t,i={}){return this.setTerminal("target",e,t,i)}getTerminal(e){return Object.assign({},this.store.get(e))}setTerminal(e,t,i,r={}){return sU.isCell(t)?this.store.set(e,e_.QK.merge({},i,{cell:t.id}),r):e0.E9.isPoint(t)||null!=t.x&&null!=t.y?this.store.set(e,e_.QK.merge({},i,{x:t.x,y:t.y}),r):this.store.set(e,e_.QK.cloneDeep(t),r),this}getSourcePoint(){return this.getTerminalPoint("source")}getTargetPoint(){return this.getTerminalPoint("target")}getTerminalPoint(e){let t=this[e];if(e0.E9.isPointLike(t))return e0.E9.create(t);let i=this.getTerminalCell(e);return i?i.getConnectionPoint(this,e):new e0.E9}getSourceCell(){return this.getTerminalCell("source")}getTargetCell(){return this.getTerminalCell("target")}getTerminalCell(e){if(this.model){let t="source"===e?this.getSourceCellId():this.getTargetCellId();if(t)return this.model.getCell(t)}return null}getSourceNode(){return this.getTerminalNode("source")}getTargetNode(){return this.getTerminalNode("target")}getTerminalNode(e){let t=this,i={};for(;t&&t.isEdge();){if(i[t.id])return null;i[t.id]=!0,t=t.getTerminalCell(e)}return t&&t.isNode()?t:null}get router(){return this.getRouter()}set router(e){null==e?this.removeRouter():this.setRouter(e)}getRouter(){return this.store.get("router")}setRouter(e,t,i){return"object"==typeof e?this.store.set("router",e,t):this.store.set("router",{name:e,args:t},i),this}removeRouter(e={}){return this.store.remove("router",e),this}get connector(){return this.getConnector()}set connector(e){null==e?this.removeConnector():this.setConnector(e)}getConnector(){return this.store.get("connector")}setConnector(e,t,i){return"object"==typeof e?this.store.set("connector",e,t):this.store.set("connector",{name:e,args:t},i),this}removeConnector(e={}){return this.store.remove("connector",e)}getDefaultLabel(){let e=this.constructor,t=this.store.get("defaultLabel")||e.defaultLabel||{};return e_.QK.cloneDeep(t)}get labels(){return this.getLabels()}set labels(e){this.setLabels(e)}getLabels(){return[...this.store.get("labels",[])].map(e=>this.parseLabel(e))}setLabels(e,t={}){return this.store.set("labels",Array.isArray(e)?e:[e],t),this}insertLabel(e,t,i={}){let r=this.getLabels(),s=r.length,n=null!=t&&Number.isFinite(t)?t:s;return n<0&&(n=s+n+1),r.splice(n,0,this.parseLabel(e)),this.setLabels(r,i)}appendLabel(e,t={}){return this.insertLabel(e,-1,t)}getLabelAt(e){let t=this.getLabels();return null!=e&&Number.isFinite(e)?this.parseLabel(t[e]):null}setLabelAt(e,t,i={}){if(null!=e&&Number.isFinite(e)){let r=this.getLabels();r[e]=this.parseLabel(t),this.setLabels(r,i)}return this}removeLabelAt(e,t={}){let i=this.getLabels(),r=null!=e&&Number.isFinite(e)?e:-1,s=i.splice(r,1);return this.setLabels(i,t),s.length?s[0]:null}parseLabel(e){return"string"==typeof e?this.constructor.parseStringLabel(e):e}onLabelsChanged({previous:e,current:t}){let i=e&&t?t.filter(t=>e.find(e=>t===e||e_.QK.isEqual(t,e))?null:t):t?[...t]:[],r=e&&t?e.filter(e=>t.find(t=>e===t||e_.QK.isEqual(e,t))?null:e):e?[...e]:[];i.length>0&&this.notify("labels:added",{added:i,cell:this,edge:this}),r.length>0&&this.notify("labels:removed",{removed:r,cell:this,edge:this})}get vertices(){return this.getVertices()}set vertices(e){this.setVertices(e)}getVertices(){return[...this.store.get("vertices",[])]}setVertices(e,t={}){let i=Array.isArray(e)?e:[e];return this.store.set("vertices",i.map(e=>e0.E9.toJSON(e)),t),this}insertVertex(e,t,i={}){let r=this.getVertices(),s=r.length,n=null!=t&&Number.isFinite(t)?t:s;return n<0&&(n=s+n+1),r.splice(n,0,e0.E9.toJSON(e)),this.setVertices(r,i)}appendVertex(e,t={}){return this.insertVertex(e,-1,t)}getVertexAt(e){return null!=e&&Number.isFinite(e)?this.getVertices()[e]:null}setVertexAt(e,t,i={}){if(null!=e&&Number.isFinite(e)){let r=this.getVertices();r[e]=t,this.setVertices(r,i)}return this}removeVertexAt(e,t={}){let i=this.getVertices(),r=null!=e&&Number.isFinite(e)?e:-1;return i.splice(r,1),this.setVertices(i,t)}onVertexsChanged({previous:e,current:t}){let i=e&&t?t.filter(t=>e.find(e=>e0.E9.equals(t,e))?null:t):t?[...t]:[],r=e&&t?e.filter(e=>t.find(t=>e0.E9.equals(e,t))?null:e):e?[...e]:[];i.length>0&&this.notify("vertexs:added",{added:i,cell:this,edge:this}),r.length>0&&this.notify("vertexs:removed",{removed:r,cell:this,edge:this})}getDefaultMarkup(){return this.store.get("defaultMarkup")||eO.getEdgeMarkup()}getMarkup(){return super.getMarkup()||this.getDefaultMarkup()}translate(e,t,i={}){return i.translateBy=i.translateBy||this.id,i.tx=e,i.ty=t,this.applyToPoints(i=>({x:(i.x||0)+e,y:(i.y||0)+t}),i)}scale(e,t,i,r={}){return this.applyToPoints(r=>e0.E9.create(r).scale(e,t,i).toJSON(),r)}applyToPoints(e,t={}){let i={},r=this.getSource(),s=this.getTarget();e0.E9.isPointLike(r)&&(i.source=e(r)),e0.E9.isPointLike(s)&&(i.target=e(s));let n=this.getVertices();return n.length>0&&(i.vertices=n.map(e)),this.store.set(i,t),this}getBBox(){return this.getPolyline().bbox()}getConnectionPoint(){return this.getPolyline().pointAt(.5)}getPolyline(){let e=[this.getSourcePoint(),...this.getVertices().map(e=>e0.E9.create(e)),this.getTargetPoint()];return new e0.aH(e)}updateParent(e){let t=null,i=this.getSourceCell(),r=this.getTargetCell(),s=this.getParent();return i&&r&&(t=i===r||i.isDescendantOf(r)?r:r.isDescendantOf(i)?i:sU.getCommonAncestor(i,r)),s&&t&&t.id!==s.id&&s.unembed(this,e),t&&(!s||s.id!==t.id)&&t.embed(this,e),t}hasLoop(e={}){let t=this.getSource(),i=this.getTarget(),r=t.cell,s=i.cell;if(!r||!s)return!1;let n=r===s;if(!n&&e.deep&&this._model){let t=this.getSourceCell(),i=this.getTargetCell();t&&i&&(n=t.isAncestorOf(i,e)||i.isAncestorOf(t,e))}return n}getFragmentAncestor(){let e=[this,this.getSourceNode(),this.getTargetNode()].filter(e=>null!=e);return this.getCommonAncestor(...e)}isFragmentDescendantOf(e){let t=this.getFragmentAncestor();return!!t&&(t.id===e.id||t.isDescendantOf(e))}}sQ.defaults={},(sQ||(sQ={})).equalTerminals=function(e,t){return e.cell===t.cell&&(e.port===t.port||null==e.port&&null==t.port)},(K=sQ||(sQ={})).defaultLabel={markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"}],attrs:{text:{fill:"#000",fontSize:14,textAnchor:"middle",textVerticalAnchor:"middle",pointerEvents:"none"},rect:{ref:"label",fill:"#fff",rx:3,ry:3,refWidth:1,refHeight:1,refX:0,refY:0}},position:{distance:.5}},K.parseStringLabel=function(e){return{attrs:{label:{text:e}}}},(J=sQ||(sQ={})).toStringTag=`X6.${J.name}`,J.isEdge=function(e){if(null==e)return!1;if(e instanceof J)return!0;let t=e[Symbol.toStringTag];return(null==t||t===J.toStringTag)&&"function"==typeof e.isNode&&"function"==typeof e.isEdge&&"function"==typeof e.prop&&"function"==typeof e.attr&&"function"==typeof e.disconnect&&"function"==typeof e.getSource&&"function"==typeof e.getTarget||!1},(Q=sQ||(sQ={})).registry=e1.create({type:"edge",process(e,t){if(eD.exist(e,!1))throw Error(`Edge with name '${e}' was registered by anthor Node`);if("function"==typeof t)return t.config({shape:e}),t;let i=Q,{inherit:r="edge"}=t,s=sJ(t,["inherit"]);if("string"==typeof r){let e=this.get(r||"edge");null==e&&r?this.onNotFound(r,"inherited"):i=e}else i=r;null==s.constructorName&&(s.constructorName=e);let n=i.define.call(i,s);return n.config({shape:e}),n}}),eD.setEdgeRegistry(Q.registry),X=sQ||(sQ={}),h=0,X.define=function(e){var t;let{constructorName:i,overwrite:r}=e,s=sJ(e,["constructorName","overwrite"]),n=e_.QK.createClass((t=i||s.shape)?e_.kf.pascalCase(t):(h+=1,`CustomEdge${h}`),this);return n.config(s),s.shape&&X.registry.register(s.shape,n,r),n},X.create=function(e){let t=e.shape||"edge",i=X.registry.get(t);return i?new i(e):X.registry.onNotFound(t)};var sX=sQ||(sQ={});let sY="basic.edge";sX.config({shape:sY,propHooks(e){let{label:t,vertices:i}=e,r=sJ(e,["label","vertices"]);if(t){null==r.labels&&(r.labels=[]);let e="string"==typeof t?sX.parseStringLabel(t):t;r.labels.push(e)}return i&&Array.isArray(i)&&(r.vertices=i.map(e=>e0.E9.create(e).toJSON())),r}}),sX.registry.register(sY,sX);class sZ extends e_.ew{constructor(e,t={}){super(),this.length=0,this.comparator=t.comparator||"zIndex",this.clean(),e&&this.reset(e,{silent:!0})}toJSON(){return this.cells.map(e=>e.toJSON())}add(e,t,i){let r,s;"number"==typeof t?(r=t,s=Object.assign({merge:!1},i)):(r=this.length,s=Object.assign({merge:!1},t)),r>this.length&&(r=this.length),r<0&&(r+=this.length+1);let n=Array.isArray(e)?e:[e],o=this.comparator&&"number"!=typeof t&&!1!==s.sort,l=this.comparator||null,a=!1,h=[],c=[];return n.forEach(e=>{let t=this.get(e);t?s.merge&&!e.isSameStore(t)&&(t.setProp(e.getProp(),i),c.push(t),o&&!a&&(a=null==l||"function"==typeof l?t.hasChanged():"string"==typeof l?t.hasChanged(l):l.some(e=>t.hasChanged(e)))):(h.push(e),this.reference(e))}),h.length&&(o&&(a=!0),this.cells.splice(r,0,...h),this.length=this.cells.length),a&&this.sort({silent:!0}),!s.silent&&(h.forEach((e,t)=>{let i={cell:e,index:r+t,options:s};this.trigger("added",i),s.dryrun||e.notify("added",Object.assign({},i))}),a&&this.trigger("sorted"),(h.length||c.length)&&this.trigger("updated",{added:h,merged:c,removed:[],options:s})),this}remove(e,t={}){let i=Array.isArray(e)?e:[e],r=this.removeCells(i,t);return!t.silent&&r.length>0&&this.trigger("updated",{options:t,removed:r,added:[],merged:[]}),Array.isArray(e)?r:r[0]}removeCells(e,t){let i=[];for(let r=0;r<e.length;r+=1){let s=this.get(e[r]);if(null==s)continue;let n=this.cells.indexOf(s);this.cells.splice(n,1),this.length-=1,delete this.map[s.id],i.push(s),this.unreference(s),t.dryrun||s.remove(),!t.silent&&(this.trigger("removed",{cell:s,index:n,options:t}),t.dryrun||s.notify("removed",{cell:s,index:n,options:t}))}return i}reset(e,t={}){let i=this.cells.slice();if(i.forEach(e=>this.unreference(e)),this.clean(),this.add(e,Object.assign({silent:!0},t)),!t.silent){let e=this.cells.slice();this.trigger("reseted",{options:t,previous:i,current:e});let r=[],s=[];e.forEach(e=>{i.some(t=>t.id===e.id)||r.push(e)}),i.forEach(t=>{e.some(e=>e.id===t.id)||s.push(t)}),this.trigger("updated",{options:t,added:r,removed:s,merged:[]})}return this}push(e,t){return this.add(e,this.length,t)}pop(e){let t=this.at(this.length-1);return this.remove(t,e)}unshift(e,t){return this.add(e,0,t)}shift(e){let t=this.at(0);return this.remove(t,e)}get(e){if(null==e)return null;let t="string"==typeof e||"number"==typeof e?e:e.id;return this.map[t]||null}has(e){return null!=this.get(e)}at(e){return e<0&&(e+=this.length),this.cells[e]||null}first(){return this.at(0)}last(){return this.at(-1)}indexOf(e){return this.cells.indexOf(e)}toArray(){return this.cells.slice()}sort(e={}){return null!=this.comparator&&(this.cells=e_.RO.sortBy(this.cells,this.comparator),e.silent||this.trigger("sorted")),this}clone(){return new this.constructor(this.cells.slice(),{comparator:this.comparator})}reference(e){this.map[e.id]=e,e.on("*",this.notifyCellEvent,this)}unreference(e){e.off("*",this.notifyCellEvent,this),delete this.map[e.id]}notifyCellEvent(e,t){let i=t.cell;this.trigger(`cell:${e}`,t),i&&(i.isNode()?this.trigger(`node:${e}`,Object.assign(Object.assign({},t),{node:i})):i.isEdge()&&this.trigger(`edge:${e}`,Object.assign(Object.assign({},t),{edge:i})))}clean(){this.length=0,this.cells=[],this.map={}}dispose(){this.reset([])}}!function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);n>3&&o&&Object.defineProperty(t,i,o)}([sZ.dispose()],sZ.prototype,"dispose",null);class s_ extends e_.ew{get[Symbol.toStringTag](){return s_.toStringTag}constructor(e=[]){super(),this.batches={},this.addings=new WeakMap,this.nodes={},this.edges={},this.outgoings={},this.incomings={},this.collection=new sZ(e),this.setup()}notify(e,t){this.trigger(e,t);let i=this.graph;return i&&("sorted"===e||"reseted"===e||"updated"===e?i.trigger(`model:${e}`,t):i.trigger(e,t)),this}setup(){let e=this.collection;e.on("sorted",()=>this.notify("sorted",null)),e.on("updated",e=>this.notify("updated",e)),e.on("cell:change:zIndex",()=>this.sortOnChangeZ()),e.on("added",({cell:e})=>{this.onCellAdded(e)}),e.on("removed",e=>{let t=e.cell;this.onCellRemoved(t,e.options),this.notify("cell:removed",e),t.isNode()?this.notify("node:removed",Object.assign(Object.assign({},e),{node:t})):t.isEdge()&&this.notify("edge:removed",Object.assign(Object.assign({},e),{edge:t}))}),e.on("reseted",e=>{this.onReset(e.current),this.notify("reseted",e)}),e.on("edge:change:source",({edge:e})=>this.onEdgeTerminalChanged(e,"source")),e.on("edge:change:target",({edge:e})=>{this.onEdgeTerminalChanged(e,"target")})}sortOnChangeZ(){this.collection.sort()}onCellAdded(e){let t=e.id;e.isEdge()?(e.updateParent(),this.edges[t]=!0,this.onEdgeTerminalChanged(e,"source"),this.onEdgeTerminalChanged(e,"target")):this.nodes[t]=!0}onCellRemoved(e,t){let i=e.id;if(e.isEdge()){delete this.edges[i];let t=e.getSource(),r=e.getTarget();if(t&&t.cell){let e=this.outgoings[t.cell],r=e?e.indexOf(i):-1;r>=0&&(e.splice(r,1),0===e.length&&delete this.outgoings[t.cell])}if(r&&r.cell){let e=this.incomings[r.cell],t=e?e.indexOf(i):-1;t>=0&&(e.splice(t,1),0===e.length&&delete this.incomings[r.cell])}}else delete this.nodes[i];t.clear||(t.disconnectEdges?this.disconnectConnectedEdges(e,t):this.removeConnectedEdges(e,t)),e.model===this&&(e.model=null)}onReset(e){this.nodes={},this.edges={},this.outgoings={},this.incomings={},e.forEach(e=>this.onCellAdded(e))}onEdgeTerminalChanged(e,t){let i="source"===t?this.outgoings:this.incomings,r=e.previous(t);if(r&&r.cell){let t=sU.isCell(r.cell)?r.cell.id:r.cell,s=i[t],n=s?s.indexOf(e.id):-1;n>=0&&(s.splice(n,1),0===s.length&&delete i[t])}let s=e.getTerminal(t);if(s&&s.cell){let t=sU.isCell(s.cell)?s.cell.id:s.cell,r=i[t]||[];-1===r.indexOf(e.id)&&r.push(e.id),i[t]=r}}prepareCell(e,t){return e.model||t&&t.dryrun||(e.model=this),null==e.zIndex&&e.setZIndex(this.getMaxZIndex()+1,{silent:!0}),e}resetCells(e,t={}){return e.map(e=>this.prepareCell(e,Object.assign(Object.assign({},t),{dryrun:!0}))),this.collection.reset(e,t),e.map(e=>this.prepareCell(e,{options:t})),this}clear(e={}){let t=this.getCells();if(0===t.length)return this;let i=Object.assign(Object.assign({},e),{clear:!0});return this.batchUpdate("clear",()=>{let e=t.sort((e,t)=>(e.isEdge()?1:2)-(t.isEdge()?1:2));for(;e.length>0;){let t=e.shift();t&&t.remove(i)}},i),this}addNode(e,t={}){let i=sK.isNode(e)?e:this.createNode(e);return this.addCell(i,t),i}updateNode(e,t={}){let i=this.createNode(e),r=i.getProp();return i.dispose(),this.updateCell(r,t)}createNode(e){return sK.create(e)}addEdge(e,t={}){let i=sQ.isEdge(e)?e:this.createEdge(e);return this.addCell(i,t),i}createEdge(e){return sQ.create(e)}updateEdge(e,t={}){let i=this.createEdge(e),r=i.getProp();return i.dispose(),this.updateCell(r,t)}addCell(e,t={}){return Array.isArray(e)?this.addCells(e,t):(this.collection.has(e)||this.addings.has(e)||(this.addings.set(e,!0),this.collection.add(this.prepareCell(e,t),t),e.eachChild(e=>this.addCell(e,t)),this.addings.delete(e)),this)}addCells(e,t={}){let i=e.length;if(0===i)return this;let r=Object.assign(Object.assign({},t),{position:i-1,maxPosition:i-1});return this.startBatch("add",Object.assign(Object.assign({},r),{cells:e})),e.forEach(e=>{this.addCell(e,r),r.position-=1}),this.stopBatch("add",Object.assign(Object.assign({},r),{cells:e})),this}updateCell(e,t={}){let i=e.id&&this.getCell(e.id);return!!i&&this.batchUpdate("update",()=>(Object.entries(e).forEach(([e,r])=>i.setProp(e,r,t)),!0),e)}removeCell(e,t={}){let i="string"==typeof e?this.getCell(e):e;return i&&this.has(i)?this.collection.remove(i,t):null}updateCellId(e,t){if(e.id===t)return;this.startBatch("update",{id:t}),e.prop("id",t);let i=e.clone({keepId:!0});return this.addCell(i),this.getConnectedEdges(e).forEach(i=>{let r=i.getSourceCell(),s=i.getTargetCell();r===e&&i.setSource(Object.assign(Object.assign({},i.getSource()),{cell:t})),s===e&&i.setTarget(Object.assign(Object.assign({},i.getTarget()),{cell:t}))}),this.removeCell(e),this.stopBatch("update",{id:t}),i}removeCells(e,t={}){return e.length?this.batchUpdate("remove",()=>e.map(e=>this.removeCell(e,t))):[]}removeConnectedEdges(e,t={}){let i=this.getConnectedEdges(e);return i.forEach(e=>{e.remove(t)}),i}disconnectConnectedEdges(e,t={}){let i="string"==typeof e?e:e.id;this.getConnectedEdges(e).forEach(e=>{let r=e.getSourceCellId(),s=e.getTargetCellId();r===i&&e.setSource({x:0,y:0},t),s===i&&e.setTarget({x:0,y:0},t)})}has(e){return this.collection.has(e)}total(){return this.collection.length}indexOf(e){return this.collection.indexOf(e)}getCell(e){return this.collection.get(e)}getCells(){return this.collection.toArray()}getFirstCell(){return this.collection.first()}getLastCell(){return this.collection.last()}getMinZIndex(){let e=this.collection.first();return e&&e.getZIndex()||0}getMaxZIndex(){let e=this.collection.last();return e&&e.getZIndex()||0}getCellsFromCache(e){return e?Object.keys(e).map(e=>this.getCell(e)).filter(e=>null!=e):[]}getNodes(){return this.getCellsFromCache(this.nodes)}getEdges(){return this.getCellsFromCache(this.edges)}getOutgoingEdges(e){let t="string"==typeof e?e:e.id,i=this.outgoings[t];return i?i.map(e=>this.getCell(e)).filter(e=>e&&e.isEdge()):null}getIncomingEdges(e){let t="string"==typeof e?e:e.id,i=this.incomings[t];return i?i.map(e=>this.getCell(e)).filter(e=>e&&e.isEdge()):null}getConnectedEdges(e,t={}){let i=[],r="string"==typeof e?this.getCell(e):e;if(null==r)return i;let s={},n=t.indirect,o=t.incoming,l=t.outgoing;null==o&&null==l&&(o=l=!0);let a=(e,t)=>{let r=t?this.getOutgoingEdges(e):this.getIncomingEdges(e);if(null!=r&&r.forEach(e=>{!s[e.id]&&(i.push(e),s[e.id]=!0,n&&(o&&a(e,!1),l&&a(e,!0)))}),n&&e.isEdge()){let r=t?e.getTargetCell():e.getSourceCell();r&&r.isEdge()&&!s[r.id]&&(i.push(r),a(r,t))}};if(l&&a(r,!0),o&&a(r,!1),t.deep){let e=r.getDescendants({deep:!0}),n={};e.forEach(e=>{e.isNode()&&(n[e.id]=!0)});let a=(e,r)=>{let o=r?this.getOutgoingEdges(e.id):this.getIncomingEdges(e.id);null!=o&&o.forEach(e=>{if(!s[e.id]){let r=e.getSourceCell(),o=e.getTargetCell();!t.enclosed&&r&&n[r.id]&&o&&n[o.id]||(i.push(e),s[e.id]=!0)}})};e.forEach(e=>{!e.isEdge()&&(l&&a(e,!0),o&&a(e,!1))})}return i}isBoundary(e,t){let i="string"==typeof e?this.getCell(e):e,r=t?this.getIncomingEdges(i):this.getOutgoingEdges(i);return null==r||0===r.length}getBoundaryNodes(e){let t=[];return Object.keys(this.nodes).forEach(i=>{if(this.isBoundary(i,e)){let e=this.getCell(i);e&&t.push(e)}}),t}getRoots(){return this.getBoundaryNodes(!0)}getLeafs(){return this.getBoundaryNodes(!1)}isRoot(e){return this.isBoundary(e,!0)}isLeaf(e){return this.isBoundary(e,!1)}getNeighbors(e,t={}){let i=t.incoming,r=t.outgoing;null==i&&null==r&&(i=r=!0);let s=this.getConnectedEdges(e,t).reduce((s,n)=>{let o=n.hasLoop(t),l=n.getSourceCell(),a=n.getTargetCell();return i&&l&&l.isNode()&&!s[l.id]&&(o||l!==e&&(!t.deep||!l.isDescendantOf(e)))&&(s[l.id]=l),r&&a&&a.isNode()&&!s[a.id]&&(o||a!==e&&(!t.deep||!a.isDescendantOf(e)))&&(s[a.id]=a),s},{});if(e.isEdge()){if(i){let t=e.getSourceCell();t&&t.isNode()&&!s[t.id]&&(s[t.id]=t)}if(r){let t=e.getTargetCell();t&&t.isNode()&&!s[t.id]&&(s[t.id]=t)}}return Object.keys(s).map(e=>s[e])}isNeighbor(e,t,i={}){let r=i.incoming,s=i.outgoing;return null==r&&null==s&&(r=s=!0),this.getConnectedEdges(e,i).some(e=>{let i=e.getSourceCell(),n=e.getTargetCell();return!!r&&!!i&&i.id===t.id||!!s&&!!n&&n.id===t.id})}getSuccessors(e,t={}){let i=[];return this.search(e,(r,s)=>{r!==e&&this.matchDistance(s,t.distance)&&i.push(r)},Object.assign(Object.assign({},t),{outgoing:!0})),i}isSuccessor(e,t,i={}){let r=!1;return this.search(e,(s,n)=>{if(s===t&&s!==e&&this.matchDistance(n,i.distance))return r=!0,!1},Object.assign(Object.assign({},i),{outgoing:!0})),r}getPredecessors(e,t={}){let i=[];return this.search(e,(r,s)=>{r!==e&&this.matchDistance(s,t.distance)&&i.push(r)},Object.assign(Object.assign({},t),{incoming:!0})),i}isPredecessor(e,t,i={}){let r=!1;return this.search(e,(s,n)=>{if(s===t&&s!==e&&this.matchDistance(n,i.distance))return r=!0,!1},Object.assign(Object.assign({},i),{incoming:!0})),r}matchDistance(e,t){return null==t||("function"==typeof t?t(e):!!(Array.isArray(t)&&t.includes(e))||e===t)}getCommonAncestor(...e){let t=[];return e.forEach(e=>{e&&(Array.isArray(e)?t.push(...e):t.push(e))}),sU.getCommonAncestor(...t)}getSubGraph(e,t={}){let i=[],r={},s=[],n=[],o=e=>{!r[e.id]&&(i.push(e),r[e.id]=e,e.isEdge()&&n.push(e),e.isNode()&&s.push(e))};return e.forEach(e=>{o(e),t.deep&&e.getDescendants({deep:!0}).forEach(e=>o(e))}),n.forEach(e=>{let t=e.getSourceCell(),n=e.getTargetCell();t&&!r[t.id]&&(i.push(t),r[t.id]=t,t.isNode()&&s.push(t)),n&&!r[n.id]&&(i.push(n),r[n.id]=n,n.isNode()&&s.push(n))}),s.forEach(e=>{this.getConnectedEdges(e,t).forEach(e=>{let t=e.getSourceCell(),s=e.getTargetCell();!r[e.id]&&t&&r[t.id]&&s&&r[s.id]&&(i.push(e),r[e.id]=e)})}),i}cloneSubGraph(e,t={}){let i=this.getSubGraph(e,t);return this.cloneCells(i)}cloneCells(e){return sU.cloneCells(e)}getNodesFromPoint(e,t){let i="number"==typeof e?{x:e,y:t||0}:e;return this.getNodes().filter(e=>e.getBBox().containsPoint(i))}getNodesInArea(e,t,i,r,s){let n="number"==typeof e?new e0.Ae(e,t,i,r):e0.Ae.create(e),o="number"==typeof e?s:t,l=o&&o.strict;return this.getNodes().filter(e=>{let t=e.getBBox();return l?n.containsRect(t):n.isIntersectWithRect(t)})}getEdgesInArea(e,t,i,r,s){let n="number"==typeof e?new e0.Ae(e,t,i,r):e0.Ae.create(e),o="number"==typeof e?s:t,l=o&&o.strict;return this.getEdges().filter(e=>{let t=e.getBBox();return 0===t.width?t.inflate(1,0):0===t.height&&t.inflate(0,1),l?n.containsRect(t):n.isIntersectWithRect(t)})}getNodesUnderNode(e,t={}){let i=e.getBBox();return(null==t.by||"bbox"===t.by?this.getNodesInArea(i):this.getNodesFromPoint(i[t.by])).filter(t=>e.id!==t.id&&!t.isDescendantOf(e))}getAllCellsBBox(){return this.getCellsBBox(this.getCells())}getCellsBBox(e,t={}){return sU.getCellsBBox(e,t)}search(e,t,i={}){i.breadthFirst?this.breadthFirstSearch(e,t,i):this.depthFirstSearch(e,t,i)}breadthFirstSearch(e,t,i={}){let r=[],s={},n={};for(r.push(e),n[e.id]=0;r.length>0;){let e=r.shift();if(null!=e&&!s[e.id])s[e.id]=!0,!1!==e_.Iw.call(t,this,e,n[e.id])&&this.getNeighbors(e,i).forEach(t=>{n[t.id]=n[e.id]+1,r.push(t)})}}depthFirstSearch(e,t,i={}){let r=[],s={},n={};for(r.push(e),n[e.id]=0;r.length>0;){let e=r.pop();if(null==e||s[e.id]||(s[e.id]=!0,!1===e_.Iw.call(t,this,e,n[e.id])))continue;let o=this.getNeighbors(e,i),l=r.length;o.forEach(t=>{n[t.id]=n[e.id]+1,r.splice(l,0,t)})}}getShortestPath(e,t,i={}){let r={};this.getEdges().forEach(e=>{let t=e.getSourceCellId(),s=e.getTargetCellId();t&&s&&(r[t]||(r[t]=[]),r[s]||(r[s]=[]),r[t].push(s),i.directed||r[s].push(t))});let s="string"==typeof e?e:e.id,n=e_.Db.run(r,s,i.weight),o=[],l="string"==typeof t?t:t.id;for(n[l]&&o.push(l);l=n[l];)o.unshift(l);return o}translate(e,t,i){return this.getCells().filter(e=>!e.hasParent()).forEach(r=>r.translate(e,t,i)),this}resize(e,t,i){return this.resizeCells(e,t,this.getCells(),i)}resizeCells(e,t,i,r={}){let s=this.getCellsBBox(i);if(s){let n=Math.max(e/s.width,0),o=Math.max(t/s.height,0),l=s.getOrigin();i.forEach(e=>e.scale(n,o,l,r))}return this}toJSON(e={}){return s_.toJSON(this.getCells(),e)}parseJSON(e){return s_.fromJSON(e)}fromJSON(e,t={}){let i=this.parseJSON(e);return this.resetCells(i,t),this}startBatch(e,t={}){return this.batches[e]=(this.batches[e]||0)+1,this.notify("batch:start",{name:e,data:t}),this}stopBatch(e,t={}){return this.batches[e]=(this.batches[e]||0)-1,this.notify("batch:stop",{name:e,data:t}),this}batchUpdate(e,t,i={}){this.startBatch(e,i);let r=t();return this.stopBatch(e,i),r}hasActiveBatch(e=Object.keys(this.batches)){return(Array.isArray(e)?e:[e]).some(e=>this.batches[e]>0)}dispose(){this.collection.dispose()}}!function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);n>3&&o&&Object.defineProperty(t,i,o)}([s_.dispose()],s_.prototype,"dispose",null),(Y=s_||(s_={})).toStringTag=`X6.${Y.name}`,Y.isModel=function(e){if(null==e)return!1;if(e instanceof Y)return!0;let t=e[Symbol.toStringTag];return(null==t||t===Y.toStringTag)&&"function"==typeof e.addNode&&"function"==typeof e.addEdge&&null!=e.collection},(Z=s_||(s_={})).toJSON=function(e,t={}){return{cells:e.map(e=>e.toJSON(t))}},Z.fromJSON=function(e){let t=[];return Array.isArray(e)?t.push(...e):(e.cells&&t.push(...e.cells),e.nodes&&e.nodes.forEach(e=>{null==e.shape&&(e.shape="rect"),t.push(e)}),e.edges&&e.edges.forEach(e=>{null==e.shape&&(e.shape="edge"),t.push(e)})),t.map(e=>{let t=e.shape;if(t){if(sK.registry.exist(t))return sK.create(e);if(sQ.registry.exist(t))return sQ.create(e)}throw Error("The `shape` should be specified when creating a node/edge instance")})};var s0=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};class s1 extends sK{get label(){return this.getLabel()}set label(e){this.setLabel(e)}getLabel(){return this.getAttrByPath("text/text")}setLabel(e,t){return null==e?this.removeLabel():this.setAttrByPath("text/text",e,t),this}removeLabel(){return this.removeAttrByPath("text/text"),this}}(_=s1||(s1={})).bodyAttr={fill:"#ffffff",stroke:"#333333",strokeWidth:2},_.labelAttr={fontSize:14,fill:"#000000",refX:.5,refY:.5,textAnchor:"middle",textVerticalAnchor:"middle",fontFamily:"Arial, helvetica, sans-serif"},_.config({attrs:{text:Object.assign({},_.labelAttr)},propHooks(e){let{label:t}=e,i=s0(e,["label"]);return t&&e_.QK.setByPath(i,"attrs/text/text",t),i},visible:!0});var s2=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};function s3(e,t,i={}){let r={constructorName:e,markup:function(e,t="body"){return[{tagName:e,selector:t},{tagName:"text",selector:"label"}]}(e,i.selector),attrs:{[e]:Object.assign({},s1.bodyAttr)}};return(i.parent||s1).define(e_.QK.merge(r,t,{shape:e}))}s3("rect",{attrs:{body:{refWidth:"100%",refHeight:"100%"}}});let s9=sQ.define({shape:"edge",markup:[{tagName:"path",selector:"wrap",groupSelector:"lines",attrs:{fill:"none",cursor:"pointer",stroke:"transparent",strokeLinecap:"round"}},{tagName:"path",selector:"line",groupSelector:"lines",attrs:{fill:"none",pointerEvents:"none"}}],attrs:{lines:{connection:!0,strokeLinejoin:"round"},wrap:{strokeWidth:10},line:{stroke:"#333",strokeWidth:2,targetMarker:"classic"}}});s3("ellipse",{attrs:{body:{refCx:"50%",refCy:"50%",refRx:"50%",refRy:"50%"}}});var s6=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};class s5 extends s1{get points(){return this.getPoints()}set points(e){this.setPoints(e)}getPoints(){return this.getAttrByPath("body/refPoints")}setPoints(e,t){return null==e?this.removePoints():this.setAttrByPath("body/refPoints",s5.pointsToString(e),t),this}removePoints(){return this.removeAttrByPath("body/refPoints"),this}}var s4=s5||(s5={});function s8(e){return"string"==typeof e?e:e.map(e=>Array.isArray(e)?e.join(","):e0.E9.isPointLike(e)?`${e.x}, ${e.y}`:"").join(" ")}s4.pointsToString=s8,s4.config({propHooks(e){let{points:t}=e,i=s6(e,["points"]);if(t){let e=s8(t);e&&e_.QK.setByPath(i,"attrs/body/refPoints",e)}return i}}),s3("polygon",{},{parent:s5}),s3("polyline",{},{parent:s5});var s7=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};s1.define({shape:"path",markup:[{tagName:"rect",selector:"bg"},{tagName:"path",selector:"body"},{tagName:"text",selector:"label"}],attrs:{bg:{refWidth:"100%",refHeight:"100%",fill:"none",stroke:"none",pointerEvents:"all"},body:{fill:"none",stroke:"#000",strokeWidth:2}},propHooks(e){let{path:t}=e,i=s7(e,["path"]);return t&&e_.QK.setByPath(i,"attrs/body/refD",t),i}});var ne=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};s1.define({shape:"text-block",markup:[{tagName:"rect",selector:"body"},e_.t4.SUPPORT_FOREIGNOBJECT?{tagName:"foreignObject",selector:"foreignObject",children:[{tagName:"div",ns:e_.is.ns.xhtml,selector:"label",style:{width:"100%",height:"100%",position:"static",backgroundColor:"transparent",textAlign:"center",margin:0,padding:"0px 5px",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center"}}]}:{tagName:"text",selector:"label",attrs:{textAnchor:"middle"}}],attrs:{body:Object.assign(Object.assign({},s1.bodyAttr),{refWidth:"100%",refHeight:"100%"}),foreignObject:{refWidth:"100%",refHeight:"100%"},label:{style:{fontSize:14}}},propHooks(e){let{text:t}=e,i=ne(e,["text"]);return t&&e_.QK.setByPath(i,"attrs/label/text",t),i},attrHooks:{text:{set(e,{cell:t,view:i,refBBox:r,elem:s,attrs:n}){if(s instanceof HTMLElement)s.textContent=e;else{let o=n.style||{},l=Object.assign({textVerticalAnchor:"middle"},o),a=eb.presets.textWrap;return e_.Iw.call(a.set,this,{text:e,width:-5,height:"100%"},{cell:t,view:i,elem:s,refBBox:r,attrs:l}),{fill:o.color||null}}},position(e,{refBBox:t,elem:i}){if(i instanceof SVGElement)return t.getCenter()}}}}),s3("image",{attrs:{image:{refWidth:"100%",refHeight:"100%"}},propHooks:function(e="xlink:href"){return t=>{let{imageUrl:i,imageWidth:r,imageHeight:s}=t,n=s2(t,["imageUrl","imageWidth","imageHeight"]);return(null!=i||null!=r||null!=s)&&(n.attrs?null==n.attrs.image&&(n.attrs.image={}):n.attrs={image:{}},(()=>{if(n.attrs){let t=n.attrs.image;null!=i&&(t[e]=i),null!=r&&(t.width=r),null!=s&&(t.height=s),n.attrs.image=t}})()),n}}()},{selector:"image"}),s3("circle",{attrs:{body:{refCx:"50%",refCy:"50%",refR:"50%"}}});class nt extends rp{constructor(){super(...arguments),this.portsCache={}}get[Symbol.toStringTag](){return nt.toStringTag}getContainerClassName(){let e=[super.getContainerClassName(),this.prefixClassName("node")];return this.can("nodeMovable")||e.push(this.prefixClassName("node-immovable")),e.join(" ")}updateClassName(e){let t=e.target;if(t.hasAttribute("magnet")){let e=this.prefixClassName("port-unconnectable");this.can("magnetConnectable")?e_.is.removeClass(t,e):e_.is.addClass(t,e)}else{let e=this.prefixClassName("node-immovable");this.can("nodeMovable")?this.removeClass(e):this.addClass(e)}}isNodeView(){return!0}confirmUpdate(e,t={}){let i=e;return this.hasAction(i,"ports")&&(this.removePorts(),this.cleanPortsCache()),this.hasAction(i,"render")?(this.render(),i=this.removeAction(i,["render","update","resize","translate","rotate","ports","tools"])):(i=this.handleAction(i,"resize",()=>this.resize(),"update"),i=this.handleAction(i,"update",()=>this.update(),iR.useCSSSelector?"ports":null),i=this.handleAction(i,"translate",()=>this.translate()),i=this.handleAction(i,"rotate",()=>this.rotate()),i=this.handleAction(i,"ports",()=>this.renderPorts()),i=this.handleAction(i,"tools",()=>{this.getFlag("tools")===e?this.renderTools():this.updateTools(t)})),i}update(e){this.cleanCache(),iR.useCSSSelector&&this.removePorts();let t=this.cell,i=t.getSize(),r=t.getAttrs();this.updateAttrs(this.container,r,{attrs:e===r?null:e,rootBBox:new e0.Ae(0,0,i.width,i.height),selectors:this.selectors}),iR.useCSSSelector&&this.renderPorts()}renderMarkup(){let e=this.cell.markup;if(e){if("string"==typeof e)throw TypeError("Not support string markup.");return this.renderJSONMarkup(e)}throw TypeError("Invalid node markup.")}renderJSONMarkup(e){let t=this.parseJSONMarkup(e,this.container);this.selectors=t.selectors,this.container.appendChild(t.fragment)}render(){return this.empty(),this.renderMarkup(),this.resize(),this.updateTransform(),iR.useCSSSelector||this.renderPorts(),this.renderTools(),this}resize(){this.cell.getAngle()&&this.rotate(),this.update()}translate(){this.updateTransform()}rotate(){this.updateTransform()}getTranslationString(){let e=this.cell.getPosition();return`translate(${e.x},${e.y})`}getRotationString(){let e=this.cell.getAngle();if(e){let t=this.cell.getSize();return`rotate(${e},${t.width/2},${t.height/2})`}}updateTransform(){let e=this.getTranslationString(),t=this.getRotationString();t&&(e+=` ${t}`),this.container.setAttribute("transform",e)}findPortElem(e,t){let i=e?this.portsCache[e]:null;if(!i)return null;let r=i.portContentElement,s=i.portContentSelectors||{};return this.findOne(t,r,s)}cleanPortsCache(){this.portsCache={}}removePorts(){Object.values(this.portsCache).forEach(e=>{e_.is.remove(e.portElement)})}renderPorts(){let e=this.container,t=[];e.childNodes.forEach(e=>{t.push(e)});let i=this.cell.getParsedPorts(),r=e_.RO.groupBy(i,"zIndex"),s="auto";r[s]&&r[s].forEach(i=>{let r=this.getPortElement(i);e.append(r),t.push(r)}),Object.keys(r).forEach(e=>{if(e!==s){let i=parseInt(e,10);this.appendPorts(r[e],i,t)}}),this.updatePorts()}appendPorts(e,t,i){let r=e.map(e=>this.getPortElement(e));i[t]||t<0?e_.is.before(i[Math.max(t,0)],r):e_.is.append(this.container,r)}getPortElement(e){let t=this.portsCache[e.id];return t?t.portElement:this.createPortElement(e)}createPortElement(e){let t,i,r=eO.renderMarkup(this.cell.getPortContainerMarkup()),s=r.elem;if(null==s)throw Error("Invalid port container markup.");let n=(r=eO.renderMarkup(this.getPortMarkup(e))).elem,o=r.selectors;if(null==n)throw Error("Invalid port markup.");this.setAttrs({port:e.id,"port-group":e.group},n);let l="x6-port";e.group&&(l+=` x6-port-${e.group}`),e_.is.addClass(s,l),e_.is.addClass(s,"x6-port"),e_.is.addClass(n,"x6-port-body"),s.appendChild(n);let a=o;if(this.existPortLabel(e)){if(t=(r=eO.renderMarkup(this.getPortLabelMarkup(e.label))).elem,i=r.selectors,null==t)throw Error("Invalid port label markup.");if(o&&i){for(let e in i)if(o[e]&&e!==this.rootSelector)throw Error("Selectors within port must be unique.");a=Object.assign(Object.assign({},o),i)}e_.is.addClass(t,"x6-port-label"),s.appendChild(t)}return this.portsCache[e.id]={portElement:s,portSelectors:a,portLabelElement:t,portLabelSelectors:i,portContentElement:n,portContentSelectors:o},this.graph.options.onPortRendered&&this.graph.options.onPortRendered({port:e,node:this.cell,container:s,selectors:a,labelContainer:t,labelSelectors:i,contentContainer:n,contentSelectors:o}),s}updatePorts(){let e=Object.keys(this.cell.getParsedGroups());0===e.length?this.updatePortGroup():e.forEach(e=>this.updatePortGroup(e))}updatePortGroup(e){let t=e0.Ae.fromSize(this.cell.getSize()),i=this.cell.getPortsLayoutByGroup(e,t);for(let e=0,t=i.length;e<t;e+=1){let t=i[e],r=t.portId,s=this.portsCache[r]||{},n=t.portLayout;if(this.applyPortTransform(s.portElement,n),null!=t.portAttrs){let e={selectors:s.portSelectors||{}};t.portSize&&(e.rootBBox=e0.Ae.fromSize(t.portSize)),this.updateAttrs(s.portElement,t.portAttrs,e)}let o=t.labelLayout;if(o&&s.portLabelElement&&(this.applyPortTransform(s.portLabelElement,o,-(n.angle||0)),o.attrs)){let e={selectors:s.portLabelSelectors||{}};t.labelSize&&(e.rootBBox=e0.Ae.fromSize(t.labelSize)),this.updateAttrs(s.portLabelElement,o.attrs,e)}}}applyPortTransform(e,t,i=0){let r=t.angle,s=t.position,n=e_.is.createSVGMatrix().rotate(i).translate(s.x||0,s.y||0).rotate(r||0);e_.is.transform(e,n,{absolute:!0})}getPortMarkup(e){return e.markup||this.cell.portMarkup}getPortLabelMarkup(e){return e.markup||this.cell.portLabelMarkup}existPortLabel(e){return e.attrs&&e.attrs.text}getEventArgs(e,t,i){let r=this.cell;return null==t||null==i?{e,view:this,node:r,cell:r}:{e,x:t,y:i,view:this,node:r,cell:r}}getPortEventArgs(e,t,i){let r=this.cell;return i?{e,x:i.x,y:i.y,view:this,node:r,cell:r,port:t}:{e,view:this,node:r,cell:r,port:t}}notifyMouseDown(e,t,i){super.onMouseDown(e,t,i),this.notify("node:mousedown",this.getEventArgs(e,t,i))}notifyMouseMove(e,t,i){super.onMouseMove(e,t,i),this.notify("node:mousemove",this.getEventArgs(e,t,i))}notifyMouseUp(e,t,i){super.onMouseUp(e,t,i),this.notify("node:mouseup",this.getEventArgs(e,t,i))}notifyPortEvent(e,t,i){let r=this.findAttr("port",t.target);if(r){let s=t.type;"node:port:mouseenter"===e?t.type="mouseenter":"node:port:mouseleave"===e&&(t.type="mouseleave"),this.notify(e,this.getPortEventArgs(t,r,i)),t.type=s}}onClick(e,t,i){super.onClick(e,t,i),this.notify("node:click",this.getEventArgs(e,t,i)),this.notifyPortEvent("node:port:click",e,{x:t,y:i})}onDblClick(e,t,i){super.onDblClick(e,t,i),this.notify("node:dblclick",this.getEventArgs(e,t,i)),this.notifyPortEvent("node:port:dblclick",e,{x:t,y:i})}onContextMenu(e,t,i){super.onContextMenu(e,t,i),this.notify("node:contextmenu",this.getEventArgs(e,t,i)),this.notifyPortEvent("node:port:contextmenu",e,{x:t,y:i})}onMouseDown(e,t,i){this.isPropagationStopped(e)||(this.notifyMouseDown(e,t,i),this.notifyPortEvent("node:port:mousedown",e,{x:t,y:i}),this.startNodeDragging(e,t,i))}onMouseMove(e,t,i){let r=this.getEventData(e),s=r.action;if("magnet"===s)this.dragMagnet(e,t,i);else{if("move"===s){let s=r.targetView||this;s.dragNode(e,t,i),s.notify("node:moving",{e,x:t,y:i,view:s,cell:s.cell,node:s.cell})}this.notifyMouseMove(e,t,i),this.notifyPortEvent("node:port:mousemove",e,{x:t,y:i})}this.setEventData(e,r)}onMouseUp(e,t,i){let r=this.getEventData(e),s=r.action;"magnet"===s?this.stopMagnetDragging(e,t,i):(this.notifyMouseUp(e,t,i),this.notifyPortEvent("node:port:mouseup",e,{x:t,y:i}),"move"===s&&(r.targetView||this).stopNodeDragging(e,t,i));let n=r.targetMagnet;n&&this.onMagnetClick(e,n,t,i),this.checkMouseleave(e)}onMouseOver(e){super.onMouseOver(e),this.notify("node:mouseover",this.getEventArgs(e)),this.notifyPortEvent("node:port:mouseenter",e),this.notifyPortEvent("node:port:mouseover",e)}onMouseOut(e){super.onMouseOut(e),this.notify("node:mouseout",this.getEventArgs(e)),this.notifyPortEvent("node:port:mouseleave",e),this.notifyPortEvent("node:port:mouseout",e)}onMouseEnter(e){this.updateClassName(e),super.onMouseEnter(e),this.notify("node:mouseenter",this.getEventArgs(e))}onMouseLeave(e){super.onMouseLeave(e),this.notify("node:mouseleave",this.getEventArgs(e))}onMouseWheel(e,t,i,r){super.onMouseWheel(e,t,i,r),this.notify("node:mousewheel",Object.assign({delta:r},this.getEventArgs(e,t,i)))}onMagnetClick(e,t,i,r){let s=this.graph;s.view.getMouseMovedCount(e)>s.options.clickThreshold||this.notify("node:magnet:click",Object.assign({magnet:t},this.getEventArgs(e,i,r)))}onMagnetDblClick(e,t,i,r){this.notify("node:magnet:dblclick",Object.assign({magnet:t},this.getEventArgs(e,i,r)))}onMagnetContextMenu(e,t,i,r){this.notify("node:magnet:contextmenu",Object.assign({magnet:t},this.getEventArgs(e,i,r)))}onMagnetMouseDown(e,t,i,r){this.startMagnetDragging(e,i,r)}onCustomEvent(e,t,i,r){this.notify("node:customevent",Object.assign({name:t},this.getEventArgs(e,i,r))),super.onCustomEvent(e,t,i,r)}prepareEmbedding(e){let t=this.graph,i=this.getEventData(e).cell||this.cell,r=t.findViewByCell(i),s=t.snapToGrid(e.clientX,e.clientY);this.notify("node:embed",{e,node:i,view:r,cell:i,x:s.x,y:s.y,currentParent:i.getParent()})}processEmbedding(e,t){let i=t.cell||this.cell,r=t.graph||this.graph,s=r.options.embedding,n=s.findParent,o="function"==typeof n?e_.Iw.call(n,r,{view:this,node:this.cell}).filter(e=>sU.isCell(e)&&this.cell.id!==e.id&&!e.isDescendantOf(this.cell)):r.model.getNodesUnderNode(i,{by:n});if(s.frontOnly&&o.length>0){let e=e_.RO.groupBy(o,"zIndex"),t=e_.RO.max(Object.keys(e).map(e=>parseInt(e,10)));t&&(o=e[t])}o=o.filter(e=>e.visible);let l=null,a=t.candidateEmbedView,h=s.validate;for(let e=o.length-1;e>=0;e-=1){let t=o[e];if(a&&a.cell.id===t.id){l=a;break}{let e=t.findView(r);if(h&&e_.Iw.call(h,r,{child:this.cell,parent:e.cell,childView:this,parentView:e})){l=e;break}}}this.clearEmbedding(t),l&&l.highlight(null,{type:"embedding"}),t.candidateEmbedView=l;let c=r.snapToGrid(e.clientX,e.clientY);this.notify("node:embedding",{e,cell:i,node:i,view:r.findViewByCell(i),x:c.x,y:c.y,currentParent:i.getParent(),candidateParent:l?l.cell:null})}clearEmbedding(e){let t=e.candidateEmbedView;t&&(t.unhighlight(null,{type:"embedding"}),e.candidateEmbedView=null)}finalizeEmbedding(e,t){this.graph.startBatch("embedding");let i=t.cell||this.cell,r=t.graph||this.graph,s=r.findViewByCell(i),n=i.getParent(),o=t.candidateEmbedView;if(o?(o.unhighlight(null,{type:"embedding"}),t.candidateEmbedView=null,(null==n||n.id!==o.cell.id)&&o.cell.insertChild(i,void 0,{ui:!0})):n&&n.unembed(i,{ui:!0}),r.model.getConnectedEdges(i,{deep:!0}).forEach(e=>{e.updateParent({ui:!0})}),s&&o){let t=r.snapToGrid(e.clientX,e.clientY);s.notify("node:embedded",{e,cell:i,x:t.x,y:t.y,node:i,view:r.findViewByCell(i),previousParent:n,currentParent:i.getParent()})}this.graph.stopBatch("embedding")}getDelegatedView(){let e=this.cell,t=this;for(;t&&!e.isEdge();){if(!e.hasParent()||t.can("stopDelegateOnDragging"))return t;e=e.getParent(),t=this.graph.findViewByCell(e)}return null}validateMagnet(e,t,i){if("passive"!==t.getAttribute("magnet")){let r=this.graph.options.connecting.validateMagnet;return!r||e_.Iw.call(r,this.graph,{e:i,magnet:t,view:e,cell:e.cell})}return!1}startMagnetDragging(e,t,i){if(!this.can("magnetConnectable"))return;e.stopPropagation();let r=e.currentTarget,s=this.graph;this.setEventData(e,{targetMagnet:r}),this.validateMagnet(this,r,e)?(s.options.magnetThreshold<=0&&this.startConnectting(e,r,t,i),this.setEventData(e,{action:"magnet"}),this.stopPropagation(e)):this.onMouseDown(e,t,i),s.view.delegateDragEvents(e,this)}startConnectting(e,t,i,r){this.graph.model.startBatch("add-edge");let s=this.createEdgeFromMagnet(t,i,r);s.setEventData(e,s.prepareArrowheadDragging("target",{x:i,y:r,isNewEdge:!0,fallbackAction:"remove"})),this.setEventData(e,{edgeView:s}),s.notifyMouseDown(e,i,r)}getDefaultEdge(e,t){let i,r=this.graph.options.connecting.createEdge;return r&&(i=e_.Iw.call(r,this.graph,{sourceMagnet:t,sourceView:e,sourceCell:e.cell})),i}createEdgeFromMagnet(e,t,i){let r=this.graph,s=r.model,n=this.getDefaultEdge(this,e);return n.setSource(Object.assign(Object.assign({},n.getSource()),this.getEdgeTerminal(e,t,i,n,"source"))),n.setTarget(Object.assign(Object.assign({},n.getTarget()),{x:t,y:i})),n.addTo(s,{async:!1,ui:!0}),n.findView(r)}dragMagnet(e,t,i){let r=this.getEventData(e),s=r.edgeView;if(s)s.onMouseMove(e,t,i),this.autoScrollGraph(e.clientX,e.clientY);else{let s=this.graph,n=s.options.magnetThreshold,o=this.getEventTarget(e),l=r.targetMagnet;if("onleave"===n){if(l===o||l.contains(o))return}else if(s.view.getMouseMovedCount(e)<=n)return;this.startConnectting(e,l,t,i)}}stopMagnetDragging(e,t,i){let r=this.eventData(e).edgeView;r&&(r.onMouseUp(e,t,i),this.graph.model.stopBatch("add-edge"))}notifyUnhandledMouseDown(e,t,i){this.notify("node:unhandled:mousedown",{e,x:t,y:i,view:this,cell:this.cell,node:this.cell})}notifyNodeMove(e,t,i,r,s){let n=[s],o=this.graph.getPlugin("selection");if(o&&o.isSelectionMovable()){let e=o.getSelectedCells();e.includes(s)&&(n=e.filter(e=>e.isNode()))}n.forEach(s=>{this.notify(e,{e:t,x:i,y:r,cell:s,node:s,view:s.findView(this.graph)})})}getRestrictArea(e){let t=this.graph.options.translating.restrict,i="function"==typeof t?e_.Iw.call(t,this.graph,e):t;return"number"==typeof i?this.graph.transform.getGraphArea().inflate(i):!0===i?this.graph.transform.getGraphArea():i||null}startNodeDragging(e,t,i){let r=this.getDelegatedView();if(null==r||!r.can("nodeMovable"))return this.notifyUnhandledMouseDown(e,t,i);this.setEventData(e,{targetView:r,action:"move"});let s=e0.E9.create(r.cell.getPosition());r.setEventData(e,{moving:!1,offset:s.diff(t,i),restrict:this.getRestrictArea(r)})}dragNode(e,t,i){let r=this.cell,s=this.graph,n=s.getGridSize(),o=this.getEventData(e),l=o.offset,a=o.restrict;o.moving||(o.moving=!0,this.addClass("node-moving"),this.notifyNodeMove("node:move",e,t,i,this.cell)),this.autoScrollGraph(e.clientX,e.clientY);let h=e0.Z4.snapToGrid(t+l.x,n),c=e0.Z4.snapToGrid(i+l.y,n);r.setPosition(h,c,{restrict:a,deep:!0,ui:!0}),s.options.embedding.enabled&&(o.embedding||(this.prepareEmbedding(e),o.embedding=!0),this.processEmbedding(e,o))}stopNodeDragging(e,t,i){let r=this.getEventData(e);r.embedding&&this.finalizeEmbedding(e,r),r.moving&&(this.removeClass("node-moving"),this.notifyNodeMove("node:moved",e,t,i,this.cell)),r.moving=!1,r.embedding=!1}autoScrollGraph(e,t){let i=this.graph.getPlugin("scroller");i&&i.autoScroll(e,t)}}(ee=nt||(nt={})).toStringTag=`X6.${ee.name}`,ee.isNodeView=function(e){if(null==e)return!1;if(e instanceof ee)return!0;let t=e[Symbol.toStringTag];return(null==t||t===ee.toStringTag)&&"function"==typeof e.isNodeView&&"function"==typeof e.isEdgeView&&"function"==typeof e.confirmUpdate&&"function"==typeof e.update&&"function"==typeof e.findPortElem&&"function"==typeof e.resize&&"function"==typeof e.rotate&&"function"==typeof e.translate||!1},nt.config({isSvgElement:!0,priority:0,bootstrap:["render"],actions:{view:["render"],markup:["render"],attrs:["update"],size:["resize","ports","tools"],angle:["rotate","tools"],position:["translate","tools"],ports:["ports"],tools:["tools"]}}),nt.registry.register("node",nt,!0);var ni=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};class nr extends rp{constructor(){super(...arguments),this.POINT_ROUNDING=2,this.labelDestroyFn={}}get[Symbol.toStringTag](){return nr.toStringTag}getContainerClassName(){return[super.getContainerClassName(),this.prefixClassName("edge")].join(" ")}get sourceBBox(){let e=this.sourceView;if(!e){let e=this.cell.getSource();return new e0.Ae(e.x,e.y)}let t=this.sourceMagnet;return e.isEdgeElement(t)?new e0.Ae(this.sourceAnchor.x,this.sourceAnchor.y):e.getBBoxOfElement(t||e.container)}get targetBBox(){let e=this.targetView;if(!e){let e=this.cell.getTarget();return new e0.Ae(e.x,e.y)}let t=this.targetMagnet;return e.isEdgeElement(t)?new e0.Ae(this.targetAnchor.x,this.targetAnchor.y):e.getBBoxOfElement(t||e.container)}isEdgeView(){return!0}confirmUpdate(e,t={}){let i=e;if(this.hasAction(i,"source")){if(!this.updateTerminalProperties("source"))return i;i=this.removeAction(i,"source")}if(this.hasAction(i,"target")){if(!this.updateTerminalProperties("target"))return i;i=this.removeAction(i,"target")}return this.hasAction(i,"render")?(this.render(),i=this.removeAction(i,["render","update","labels","tools"])):(i=this.handleAction(i,"update",()=>this.update(t)),i=this.handleAction(i,"labels",()=>this.onLabelsChange(t)),i=this.handleAction(i,"tools",()=>this.renderTools()))}render(){return this.empty(),this.renderMarkup(),this.labelContainer=null,this.renderLabels(),this.update(),this.renderTools(),this}renderMarkup(){let e=this.cell.markup;if(e){if("string"==typeof e)throw TypeError("Not support string markup.");return this.renderJSONMarkup(e)}throw TypeError("Invalid edge markup.")}renderJSONMarkup(e){let t=this.parseJSONMarkup(e,this.container);this.selectors=t.selectors,this.container.append(t.fragment)}customizeLabels(){if(this.labelContainer){let e=this.cell,t=e.labels;for(let i=0,r=t.length;i<r;i+=1){let r=t[i],s=this.labelCache[i],n=this.labelSelectors[i],o=this.graph.options.onEdgeLabelRendered;if(o){let t=o({edge:e,label:r,container:s,selectors:n});t&&(this.labelDestroyFn[i]=t)}}}}destroyCustomizeLabels(){let e=this.cell.labels;if(this.labelCache&&this.labelSelectors&&this.labelDestroyFn)for(let t=0,i=e.length;t<i;t+=1){let i=this.labelDestroyFn[t],r=this.labelCache[t],s=this.labelSelectors[t];i&&r&&s&&i({edge:this.cell,label:e[t],container:r,selectors:s})}this.labelDestroyFn={}}renderLabels(){let e=this.cell,t=e.getLabels(),i=t.length,r=this.labelContainer;if(this.labelCache={},this.labelSelectors={},i<=0)return r&&r.parentNode&&r.parentNode.removeChild(r),this;r?this.empty(r):(r=e_.is.createSvgElement("g"),this.addClass(this.prefixClassName("edge-labels"),r),this.labelContainer=r);for(let i=0,s=t.length;i<s;i+=1){let s,n,o=t[i],l=this.normalizeLabelMarkup(this.parseLabelMarkup(o.markup));if(l)s=l.node,n=l.selectors;else{let t=e.getDefaultLabel(),i=this.normalizeLabelMarkup(this.parseLabelMarkup(t.markup));s=i.node,n=i.selectors}s.setAttribute("data-index",`${i}`),r.appendChild(s);let a=this.rootSelector;if(n[a])throw Error("Ambiguous label root selector.");n[a]=s,this.labelCache[i]=s,this.labelSelectors[i]=n}return null==r.parentNode&&this.container.appendChild(r),this.updateLabels(),this.customizeLabels(),this}onLabelsChange(e={}){this.destroyCustomizeLabels(),this.shouldRerenderLabels(e)?this.renderLabels():this.updateLabels(),this.updateLabelPositions()}shouldRerenderLabels(e={}){let t=this.cell.previous("labels");if(null==t)return!0;if("propertyPathArray"in e&&"propertyValue"in e){let i=e.propertyPathArray||[],r=i.length;if(r>1&&t[i[1]]){if(2===r)return"object"==typeof e.propertyValue&&e_.QK.has(e.propertyValue,"markup");if("markup"!==i[2])return!1}}return!0}parseLabelMarkup(e){return e?"string"==typeof e?this.parseLabelStringMarkup(e):this.parseJSONMarkup(e):null}parseLabelStringMarkup(e){let t=e_.OW.createVectors(e),i=document.createDocumentFragment();for(let e=0,r=t.length;e<r;e+=1){let r=t[e].node;i.appendChild(r)}return{fragment:i,selectors:{}}}normalizeLabelMarkup(e){let t;if(null==e)return;let i=e.fragment;if(!(i instanceof DocumentFragment)||!i.hasChildNodes())throw Error("Invalid label markup.");let r=i.childNodes;return(t=r.length>1||"G"!==r[0].nodeName.toUpperCase()?e_.OW.create("g").append(i):e_.OW.create(r[0])).addClass(this.prefixClassName("edge-label")),{node:t.node,selectors:e.selectors}}updateLabels(){if(this.labelContainer){let e=this.cell,t=e.labels,i=this.can("edgeLabelMovable"),r=e.getDefaultLabel();for(let e=0,s=t.length;e<s;e+=1){let s=this.labelCache[e],n=this.labelSelectors[e];s.setAttribute("cursor",i?"move":"default");let o=t[e],l=e_.QK.merge({},r.attrs,o.attrs);this.updateAttrs(s,l,{selectors:n,rootBBox:o.size?e0.Ae.fromSize(o.size):void 0})}}}renderTools(){let e=this.cell.getTools();return this.addTools(e),this}update(e={}){this.cleanCache(),this.updateConnection(e);let t=this.cell.getAttrs(),{text:i}=t,r=ni(t,["text"]);return null!=r&&this.updateAttrs(this.container,r,{selectors:this.selectors}),this.updateLabelPositions(),this.updateTools(e),this}removeRedundantLinearVertices(e={}){let t=this.cell,i=t.getVertices(),r=[this.sourceAnchor,...i,this.targetAnchor],s=r.length,n=new e0.aH(r);n.simplify({threshold:.01});let o=n.points.map(e=>e.toJSON()),l=o.length;return s===l?0:(t.setVertices(o.slice(1,l-1),e),s-l)}getTerminalView(e){switch(e){case"source":return this.sourceView||null;case"target":return this.targetView||null;default:throw Error(`Unknown terminal type '${e}'`)}}getTerminalAnchor(e){switch(e){case"source":return e0.E9.create(this.sourceAnchor);case"target":return e0.E9.create(this.targetAnchor);default:throw Error(`Unknown terminal type '${e}'`)}}getTerminalConnectionPoint(e){switch(e){case"source":return e0.E9.create(this.sourcePoint);case"target":return e0.E9.create(this.targetPoint);default:throw Error(`Unknown terminal type '${e}'`)}}getTerminalMagnet(e,t={}){switch(e){case"source":{if(t.raw)return this.sourceMagnet;let e=this.sourceView;if(!e)return null;return this.sourceMagnet||e.container}case"target":{if(t.raw)return this.targetMagnet;let e=this.targetView;if(!e)return null;return this.targetMagnet||e.container}default:throw Error(`Unknown terminal type '${e}'`)}}updateConnection(e={}){let t=this.cell;if(e.translateBy&&t.isFragmentDescendantOf(e.translateBy)){let t=e.tx||0,i=e.ty||0;this.routePoints=new e0.aH(this.routePoints).translate(t,i).points,this.translateConnectionPoints(t,i),this.path.translate(t,i)}else{let e=t.getVertices(),i=this.findAnchors(e);this.sourceAnchor=i.source,this.targetAnchor=i.target,this.routePoints=this.findRoutePoints(e);let r=this.findConnectionPoints(this.routePoints,this.sourceAnchor,this.targetAnchor);this.sourcePoint=r.source,this.targetPoint=r.target;let s=this.findMarkerPoints(this.routePoints,this.sourcePoint,this.targetPoint);this.path=this.findPath(this.routePoints,s.source||this.sourcePoint,s.target||this.targetPoint)}this.cleanCache()}findAnchors(e){let t=this.cell,i=t.source,r=t.target,s=e[0],n=e[e.length-1];return r.priority&&!i.priority?this.findAnchorsOrdered("target",n,"source",s):this.findAnchorsOrdered("source",s,"target",n)}findAnchorsOrdered(e,t,i,r){let s,n,o=this.cell,l=o[e],a=o[i],h=this.getTerminalView(e),c=this.getTerminalView(i),g=this.getTerminalMagnet(e),u=this.getTerminalMagnet(i);if(h){let i;i=t?e0.E9.create(t):c?u:e0.E9.create(a),s=this.getAnchor(l.anchor,h,g,i,e)}else s=e0.E9.create(l);if(c){let e=e0.E9.create(r||s);n=this.getAnchor(a.anchor,c,u,e,i)}else n=e0.E9.isPointLike(a)?e0.E9.create(a):new e0.E9;return{[e]:s,[i]:n}}getAnchor(e,t,i,r,s){let n,o=t.isEdgeElement(i),l=this.graph.options.connecting,a="string"==typeof e?{name:e}:e;if(!a){let e=o?("source"===s?l.sourceEdgeAnchor:l.targetEdgeAnchor)||l.edgeAnchor:("source"===s?l.sourceAnchor:l.targetAnchor)||l.anchor;a="string"==typeof e?{name:e}:e}if(!a)throw Error("Anchor should be specified.");let h=a.name;if(o){let e=ek.registry.get(h);if("function"!=typeof e)return ek.registry.onNotFound(h);n=e_.Iw.call(e,this,t,i,r,a.args||{},s)}else{let e=eT.registry.get(h);if("function"!=typeof e)return eT.registry.onNotFound(h);n=e_.Iw.call(e,this,t,i,r,a.args||{},s)}return n?n.round(this.POINT_ROUNDING):new e0.E9}findRoutePoints(e=[]){let t,i=this.graph.options.connecting.router||eB.presets.normal,r=this.cell.getRouter()||i;if("function"==typeof r)t=e_.Iw.call(r,this,e,{},this);else{let i="string"==typeof r?r:r.name,s="string"==typeof r?{}:r.args||{},n=i?eB.registry.get(i):eB.presets.normal;if("function"!=typeof n)return eB.registry.onNotFound(i);t=e_.Iw.call(n,this,e,s,this)}return null==t?e.map(e=>e0.E9.create(e)):t.map(e=>e0.E9.create(e))}findConnectionPoints(e,t,i){let r,s,n=this.cell,o=this.graph.options.connecting,l=n.getSource(),a=n.getTarget(),h=this.sourceView,c=this.targetView,g=e[0],u=e[e.length-1];if(h&&!h.isEdgeElement(this.sourceMagnet)){let e=this.sourceMagnet||h.container,s=new e0.x1(g||i,t),n=l.connectionPoint||o.sourceConnectionPoint||o.connectionPoint;r=this.getConnectionPoint(n,h,e,s,"source")}else r=t;if(c&&!c.isEdgeElement(this.targetMagnet)){let e=this.targetMagnet||c.container,r=a.connectionPoint||o.targetConnectionPoint||o.connectionPoint,n=new e0.x1(u||t,i);s=this.getConnectionPoint(r,c,e,n,"target")}else s=i;return{source:r,target:s}}getConnectionPoint(e,t,i,r,s){let n=r.end;if(null==e)return n;let o="string"==typeof e?e:e.name,l="string"==typeof e?{}:e.args,a=eN.registry.get(o);if("function"!=typeof a)return eN.registry.onNotFound(o);let h=e_.Iw.call(a,this,r,t,i,l||{},s);return h?h.round(this.POINT_ROUNDING):n}findMarkerPoints(e,t,i){let r,s,n=e=>{let t=this.cell.getAttrs(),i=Object.keys(t);for(let r=0,s=i.length;r<s;r+=1){let s=t[i[r]];if(s[`${e}Marker`]||s[`${e}-marker`]){let e=s.strokeWidth||s["stroke-width"];if(e)return parseFloat(e);break}}return null},o=e[0],l=e[e.length-1],a=n("source");a&&(r=t.clone().move(o||i,-a));let h=n("target");return h&&(s=i.clone().move(l||t,-h)),this.sourceMarkerPoint=r||t.clone(),this.targetMarkerPoint=s||i.clone(),{source:r,target:s}}findPath(e,t,i){let r,s,n,o=this.cell.getConnector()||this.graph.options.connecting.connector;if("string"==typeof o?r=o:(r=o.name,s=o.args),r){let e=eR.registry.get(r);if("function"!=typeof e)return eR.registry.onNotFound(r);n=e}else n=eR.presets.normal;let l=e_.Iw.call(n,this,t,i,e,Object.assign(Object.assign({},s),{raw:!0}),this);return"string"==typeof l?e0.y$.parse(l):l}translateConnectionPoints(e,t){this.sourcePoint.translate(e,t),this.targetPoint.translate(e,t),this.sourceAnchor.translate(e,t),this.targetAnchor.translate(e,t),this.sourceMarkerPoint.translate(e,t),this.targetMarkerPoint.translate(e,t)}updateLabelPositions(){if(null==this.labelContainer||!this.path)return this;let e=this.cell,t=e.getLabels();if(0===t.length)return this;let i=e.getDefaultLabel(),r=this.normalizeLabelPosition(i.position);for(let e=0,i=t.length;e<i;e+=1){let i=t[e],s=this.labelCache[e];if(!s)continue;let n=this.normalizeLabelPosition(i.position),o=e_.QK.merge({},r,n),l=this.getLabelTransformationMatrix(o);s.setAttribute("transform",e_.is.matrixToTransformString(l))}return this}updateTerminalProperties(e){let t=this.cell,i=this.graph,r=t[e],s=r&&r.cell,n=`${e}View`;if(!s)return this[n]=null,this.updateTerminalMagnet(e),!0;let o=i.getCellById(s);if(!o)throw Error(`Edge's ${e} node with id "${s}" not exists`);let l=o.findView(i);return!!l&&(this[n]=l,this.updateTerminalMagnet(e),!0)}updateTerminalMagnet(e){let t=`${e}Magnet`,i=this.getTerminalView(e);if(i){let r=i.getMagnetFromEdgeTerminal(this.cell[e]);r===i.container&&(r=null),this[t]=r}else this[t]=null}getLabelPositionAngle(e){let t=this.cell.getLabelAt(e);return t&&t.position&&"object"==typeof t.position&&t.position.angle||0}getLabelPositionArgs(e){let t=this.cell.getLabelAt(e);if(t&&t.position&&"object"==typeof t.position)return t.position.options}getDefaultLabelPositionArgs(){let e=this.cell.getDefaultLabel();if(e&&e.position&&"object"==typeof e.position)return e.position.options}mergeLabelPositionArgs(e,t){return null===e?null:void 0===e?null===t?null:t:e_.QK.merge({},t,e)}getConnection(){return null!=this.path?this.path.clone():null}getConnectionPathData(){if(null==this.path)return"";let e=this.cache.pathCache;return e_.QK.has(e,"data")||(e.data=this.path.serialize()),e.data||""}getConnectionSubdivisions(){if(null==this.path)return null;let e=this.cache.pathCache;return e_.QK.has(e,"segmentSubdivisions")||(e.segmentSubdivisions=this.path.getSegmentSubdivisions()),e.segmentSubdivisions}getConnectionLength(){if(null==this.path)return 0;let e=this.cache.pathCache;return e_.QK.has(e,"length")||(e.length=this.path.length({segmentSubdivisions:this.getConnectionSubdivisions()})),e.length}getPointAtLength(e){return null==this.path?null:this.path.pointAtLength(e,{segmentSubdivisions:this.getConnectionSubdivisions()})}getPointAtRatio(e){return null==this.path?null:(e_.GH.isPercentage(e)&&(e=parseFloat(e)/100),this.path.pointAt(e,{segmentSubdivisions:this.getConnectionSubdivisions()}))}getTangentAtLength(e){return null==this.path?null:this.path.tangentAtLength(e,{segmentSubdivisions:this.getConnectionSubdivisions()})}getTangentAtRatio(e){return null==this.path?null:this.path.tangentAt(e,{segmentSubdivisions:this.getConnectionSubdivisions()})}getClosestPoint(e){return null==this.path?null:this.path.closestPoint(e,{segmentSubdivisions:this.getConnectionSubdivisions()})}getClosestPointLength(e){return null==this.path?null:this.path.closestPointLength(e,{segmentSubdivisions:this.getConnectionSubdivisions()})}getClosestPointRatio(e){return null==this.path?null:this.path.closestPointNormalizedLength(e,{segmentSubdivisions:this.getConnectionSubdivisions()})}getLabelPosition(e,t,i,r){let s,n,o,l={distance:0},a=0;"number"==typeof i?(a=i,s=r):s=i,null!=s&&(l.options=s);let h=s&&s.absoluteOffset,c=!(s&&s.absoluteDistance),g=s&&s.absoluteDistance&&s.reverseDistance,u=this.path,d={segmentSubdivisions:this.getConnectionSubdivisions()},p=new e0.E9(e,t),f=u.closestPointT(p,d),m=this.getConnectionLength()||0,y=u.lengthAtT(f,d);if(c&&(y=m>0?y/m:0),g&&(y=-1*(m-y)||1),l.distance=y,h||(n=u.tangentAtT(f)),n)o=n.pointOffset(p);else{let e=u.pointAtT(f),t=p.diff(e);o={x:t.x,y:t.y}}return l.offset=o,l.angle=a,l}normalizeLabelPosition(e){return"number"==typeof e?{distance:e}:e}getLabelTransformationMatrix(e){let t,i=this.normalizeLabelPosition(e),r=i.options||{},s=i.angle||0,n=i.distance,o=0,l={x:0,y:0},a=i.offset;a&&("number"==typeof a?o=a:(null!=a.x&&(l.x=a.x),null!=a.y&&(l.y=a.y)));let h=0!==l.x||0!==l.y||0===o,c=r.keepGradient,g=r.ensureLegibility,u=this.path,d={segmentSubdivisions:this.getConnectionSubdivisions()},p=n>0&&n<=1?n*this.getConnectionLength():n,f=u.tangentAtLength(p,d),m=s;if(f){if(h)(t=f.start).translate(l);else{let e=f.clone();e.rotate(-90,f.start),e.setLength(o),t=e.end}c&&(m=f.angle()+s,g&&(m=e0.RZ.normalize((m+90)%180-90)))}else t=u.start,h&&t.translate(l);return e_.is.createSVGMatrix().translate(t.x,t.y).rotate(m)}getVertexIndex(e,t){let i=this.cell.getVertices(),r=this.getClosestPointLength(new e0.E9(e,t)),s=0;if(null!=r)for(let e=i.length;s<e;s+=1){let e=i[s],t=this.getClosestPointLength(e);if(null!=t&&r<t)break}return s}getEventArgs(e,t,i){let r=this.cell;return null==t||null==i?{e,view:this,edge:r,cell:r}:{e,x:t,y:i,view:this,edge:r,cell:r}}notifyUnhandledMouseDown(e,t,i){this.notify("edge:unhandled:mousedown",{e,x:t,y:i,view:this,cell:this.cell,edge:this.cell})}notifyMouseDown(e,t,i){super.onMouseDown(e,t,i),this.notify("edge:mousedown",this.getEventArgs(e,t,i))}notifyMouseMove(e,t,i){super.onMouseMove(e,t,i),this.notify("edge:mousemove",this.getEventArgs(e,t,i))}notifyMouseUp(e,t,i){super.onMouseUp(e,t,i),this.notify("edge:mouseup",this.getEventArgs(e,t,i))}onClick(e,t,i){super.onClick(e,t,i),this.notify("edge:click",this.getEventArgs(e,t,i))}onDblClick(e,t,i){super.onDblClick(e,t,i),this.notify("edge:dblclick",this.getEventArgs(e,t,i))}onContextMenu(e,t,i){super.onContextMenu(e,t,i),this.notify("edge:contextmenu",this.getEventArgs(e,t,i))}onMouseDown(e,t,i){this.notifyMouseDown(e,t,i),this.startEdgeDragging(e,t,i)}onMouseMove(e,t,i){let r=this.getEventData(e);switch(r.action){case"drag-label":this.dragLabel(e,t,i);break;case"drag-arrowhead":this.dragArrowhead(e,t,i);break;case"drag-edge":this.dragEdge(e,t,i)}return this.notifyMouseMove(e,t,i),r}onMouseUp(e,t,i){let r=this.getEventData(e);switch(r.action){case"drag-label":this.stopLabelDragging(e,t,i);break;case"drag-arrowhead":this.stopArrowheadDragging(e,t,i);break;case"drag-edge":this.stopEdgeDragging(e,t,i)}return this.notifyMouseUp(e,t,i),this.checkMouseleave(e),r}onMouseOver(e){super.onMouseOver(e),this.notify("edge:mouseover",this.getEventArgs(e))}onMouseOut(e){super.onMouseOut(e),this.notify("edge:mouseout",this.getEventArgs(e))}onMouseEnter(e){super.onMouseEnter(e),this.notify("edge:mouseenter",this.getEventArgs(e))}onMouseLeave(e){super.onMouseLeave(e),this.notify("edge:mouseleave",this.getEventArgs(e))}onMouseWheel(e,t,i,r){super.onMouseWheel(e,t,i,r),this.notify("edge:mousewheel",Object.assign({delta:r},this.getEventArgs(e,t,i)))}onCustomEvent(e,t,i,r){if(e_.is.findParentByClass(e.target,"edge-tool",this.container)){if(e.stopPropagation(),this.can("useEdgeTools")){if("edge:remove"===t)return void this.cell.remove({ui:!0});this.notify("edge:customevent",Object.assign({name:t},this.getEventArgs(e,i,r)))}this.notifyMouseDown(e,i,r)}else this.notify("edge:customevent",Object.assign({name:t},this.getEventArgs(e,i,r))),super.onCustomEvent(e,t,i,r)}onLabelMouseDown(e,t,i){this.notifyMouseDown(e,t,i),this.startLabelDragging(e,t,i),this.getEventData(e).stopPropagation&&e.stopPropagation()}startEdgeDragging(e,t,i){if(!this.can("edgeMovable"))return void this.notifyUnhandledMouseDown(e,t,i);this.setEventData(e,{x:t,y:i,moving:!1,action:"drag-edge"})}dragEdge(e,t,i){let r=this.getEventData(e);r.moving||(r.moving=!0,this.addClass("edge-moving"),this.notify("edge:move",{e,x:t,y:i,view:this,cell:this.cell,edge:this.cell})),this.cell.translate(t-r.x,i-r.y,{ui:!0}),this.setEventData(e,{x:t,y:i}),this.notify("edge:moving",{e,x:t,y:i,view:this,cell:this.cell,edge:this.cell})}stopEdgeDragging(e,t,i){let r=this.getEventData(e);r.moving&&(this.removeClass("edge-moving"),this.notify("edge:moved",{e,x:t,y:i,view:this,cell:this.cell,edge:this.cell})),r.moving=!1}prepareArrowheadDragging(e,t){let i=this.getTerminalMagnet(e),r={action:"drag-arrowhead",x:t.x,y:t.y,isNewEdge:!0===t.isNewEdge,terminalType:e,initialMagnet:i,initialTerminal:e_.QK.clone(this.cell[e]),fallbackAction:t.fallbackAction||"revert",getValidateConnectionArgs:this.createValidateConnectionArgs(e),options:t.options};return this.beforeArrowheadDragging(r),r}createValidateConnectionArgs(e){let t,i=[];i[4]=e,i[5]=this;let r=0,s=0;"source"===e?(r=2,t="target"):(s=2,t="source");let n=this.cell[t],o=n.cell;if(o){let e,t=i[r]=this.graph.findViewByCell(o);t&&(e=t.getMagnetFromEdgeTerminal(n))===t.container&&(e=void 0),i[r+1]=e}return(e,t)=>(i[s]=e,i[s+1]=e.container===t?void 0:t,i)}beforeArrowheadDragging(e){e.zIndex=this.cell.zIndex,this.cell.toFront();let t=this.container.style;e.pointerEvents=t.pointerEvents,t.pointerEvents="none",this.graph.options.connecting.highlight&&this.highlightAvailableMagnets(e)}afterArrowheadDragging(e){null!=e.zIndex&&(this.cell.setZIndex(e.zIndex,{ui:!0}),e.zIndex=null),this.container.style.pointerEvents=e.pointerEvents||"",this.graph.options.connecting.highlight&&this.unhighlightAvailableMagnets(e)}validateConnection(e,t,i,r,s,n,o){let l=this.graph.options.connecting,a=l.allowLoop,h=l.allowNode,c=l.allowEdge,g=l.allowPort,u=l.allowMulti,d=l.validateConnection,p=n?n.cell:null,f="target"===s?i:e,m="target"===s?r:t,y=!0,b=l=>{let a="source"===s?o?o.port:null:p?p.getSourcePortId():null,h="target"===s?o?o.port:null:p?p.getTargetPortId():null;return e_.Iw.call(l,this.graph,{edge:p,edgeView:n,sourceView:e,targetView:i,sourcePort:a,targetPort:h,sourceMagnet:t,targetMagnet:r,sourceCell:e?e.cell:null,targetCell:i?i.cell:null,type:s})};if(null!=a&&("boolean"==typeof a?a||e!==i||(y=!1):y=b(a)),y&&null!=g&&("boolean"==typeof g?!g&&m&&(y=!1):y=b(g)),y&&null!=c&&("boolean"==typeof c?!c&&nr.isEdgeView(f)&&(y=!1):y=b(c)),y&&null!=h&&null==m&&("boolean"==typeof h?!h&&nt.isNodeView(f)&&(y=!1):y=b(h)),y&&null!=u&&n){let e=n.cell,t="source"===s?o:e.getSource(),i="target"===s?o:e.getTarget(),r=o?this.graph.getCellById(o.cell):null;if(t&&i&&t.cell&&i.cell&&r)if("function"==typeof u)y=b(u);else{let e=this.graph.model.getConnectedEdges(r,{outgoing:"source"===s,incoming:"target"===s});e.length&&("withPort"===u?e.some(e=>{let r=e.getSource(),s=e.getTarget();return r&&s&&r.cell===t.cell&&s.cell===i.cell&&null!=r.port&&r.port===t.port&&null!=s.port&&s.port===i.port})&&(y=!1):!u&&e.some(e=>{let r=e.getSource(),s=e.getTarget();return r&&s&&r.cell===t.cell&&s.cell===i.cell})&&(y=!1))}}return y&&null!=d&&(y=b(d)),y}allowConnectToBlank(e){let t=this.graph,i=t.options.connecting.allowBlank;if("function"!=typeof i)return!!i;let r=t.findViewByCell(e),s=e.getSourceCell(),n=e.getTargetCell(),o=t.findViewByCell(s),l=t.findViewByCell(n);return e_.Iw.call(i,t,{edge:e,edgeView:r,sourceCell:s,targetCell:n,sourceView:o,targetView:l,sourcePort:e.getSourcePortId(),targetPort:e.getTargetPortId(),sourceMagnet:r.sourceMagnet,targetMagnet:r.targetMagnet})}validateEdge(e,t,i){let r=this.graph;if(!this.allowConnectToBlank(e)){let t=e.getSourceCellId(),i=e.getTargetCellId();if(!(t&&i))return!1}let s=r.options.connecting.validateEdge;return!s||e_.Iw.call(s,r,{edge:e,type:t,previous:i})}arrowheadDragging(e,t,i,r){r.x=t,r.y=i,r.currentTarget!==e&&(r.currentMagnet&&r.currentView&&r.currentView.unhighlight(r.currentMagnet,{type:"magnetAdsorbed"}),r.currentView=this.graph.findViewByElem(e),r.currentView?(r.currentMagnet=r.currentView.findMagnet(e),r.currentMagnet&&this.validateConnection(...r.getValidateConnectionArgs(r.currentView,r.currentMagnet),r.currentView.getEdgeTerminal(r.currentMagnet,t,i,this.cell,r.terminalType))?r.currentView.highlight(r.currentMagnet,{type:"magnetAdsorbed"}):r.currentMagnet=null):r.currentMagnet=null),r.currentTarget=e,this.cell.prop(r.terminalType,{x:t,y:i},Object.assign(Object.assign({},r.options),{ui:!0}))}arrowheadDragged(e,t,i){let r=e.currentView,s=e.currentMagnet;if(!s||!r)return;r.unhighlight(s,{type:"magnetAdsorbed"});let n=e.terminalType,o=r.getEdgeTerminal(s,t,i,this.cell,n);this.cell.setTerminal(n,o,{ui:!0})}snapArrowhead(e,t,i){let r,s,n=this.graph,{snap:o,allowEdge:l}=n.options.connecting,a="object"==typeof o&&o.radius||50,h="object"==typeof o&&o.anchor||"center",c=n.renderer.findViewsInArea({x:e-a,y:t-a,width:2*a,height:2*a},{nodeOnly:!0});if(l){let i=n.renderer.findEdgeViewsFromPoint({x:e,y:t},a).filter(e=>e!==this);c.push(...i)}let g=i.closestView||null,u=i.closestMagnet||null;i.closestView=null,i.closestMagnet=null;let d=Number.MAX_SAFE_INTEGER,p=new e0.E9(e,t);c.forEach(s=>{if("false"!==s.container.getAttribute("magnet")){if(s.isNodeView())r="center"===h?s.cell.getBBox().getCenter().distance(p):s.cell.getBBox().getNearestPointToPoint(p).distance(p);else if(s.isEdgeView()){let e=s.getClosestPoint(p);r=e?e.distance(p):Number.MAX_SAFE_INTEGER}r<a&&r<d&&(u===s.container||this.validateConnection(...i.getValidateConnectionArgs(s,null),s.getEdgeTerminal(s.container,e,t,this.cell,i.terminalType)))&&(d=r,i.closestView=s,i.closestMagnet=s.container)}s.container.querySelectorAll("[magnet]").forEach(n=>{if("false"!==n.getAttribute("magnet")){let o=s.getBBoxOfElement(n);(r=p.distance(o.getCenter()))<a&&r<d&&(u===n||this.validateConnection(...i.getValidateConnectionArgs(s,n),s.getEdgeTerminal(n,e,t,this.cell,i.terminalType)))&&(d=r,i.closestView=s,i.closestMagnet=n)}})});let f=i.terminalType,m=i.closestView,y=i.closestMagnet,b=u!==y;if(g&&b&&g.unhighlight(u,{type:"magnetAdsorbed"}),m){if(!b)return;m.highlight(y,{type:"magnetAdsorbed"}),s=m.getEdgeTerminal(y,e,t,this.cell,f)}else s={x:e,y:t};this.cell.setTerminal(f,s,{},Object.assign(Object.assign({},i.options),{ui:!0}))}snapArrowheadEnd(e){let t=e.closestView,i=e.closestMagnet;t&&i&&(t.unhighlight(i,{type:"magnetAdsorbed"}),e.currentMagnet=t.findMagnet(i)),e.closestView=null,e.closestMagnet=null}finishEmbedding(e){this.graph.options.embedding.enabled&&this.cell.updateParent()&&(e.zIndex=null)}fallbackConnection(e){"remove"===e.fallbackAction?this.cell.remove({ui:!0}):this.cell.prop(e.terminalType,e.initialTerminal,{ui:!0})}notifyConnectionEvent(e,t){let i=e.terminalType,r=e.initialTerminal,s=this.cell[i];if(s&&!sQ.equalTerminals(r,s)){let n=this.graph,o=r.cell?n.getCellById(r.cell):null,l=r.port,a=o?n.findViewByCell(o):null,h=o||e.isNewEdge?null:e0.E9.create(r).toJSON(),c=s.cell?n.getCellById(s.cell):null,g=s.port,u=c?n.findViewByCell(c):null,d=c?null:e0.E9.create(s).toJSON();this.notify("edge:connected",{e:t,previousCell:o,previousPort:l,previousView:a,previousPoint:h,currentCell:c,currentView:u,currentPort:g,currentPoint:d,previousMagnet:e.initialMagnet,currentMagnet:e.currentMagnet,edge:this.cell,view:this,type:i,isNew:e.isNewEdge})}}highlightAvailableMagnets(e){let t=this.graph,i=t.model.getCells();e.marked={};for(let r=0,s=i.length;r<s;r+=1){let s=t.findViewByCell(i[r]);if(!s||s.cell.id===this.cell.id)continue;let n=Array.prototype.slice.call(s.container.querySelectorAll("[magnet]"));"false"!==s.container.getAttribute("magnet")&&n.push(s.container);let o=n.filter(t=>this.validateConnection(...e.getValidateConnectionArgs(s,t),s.getEdgeTerminal(t,e.x,e.y,this.cell,e.terminalType)));if(o.length>0){for(let e=0,t=o.length;e<t;e+=1)s.highlight(o[e],{type:"magnetAvailable"});s.highlight(null,{type:"nodeAvailable"}),e.marked[s.cell.id]=o}}}unhighlightAvailableMagnets(e){let t=e.marked||{};Object.keys(t).forEach(e=>{let i=this.graph.findViewByCell(e);i&&(t[e].forEach(e=>{i.unhighlight(e,{type:"magnetAvailable"})}),i.unhighlight(null,{type:"nodeAvailable"}))}),e.marked=null}startArrowheadDragging(e,t,i){if(!this.can("arrowheadMovable"))return void this.notifyUnhandledMouseDown(e,t,i);let r=e.target.getAttribute("data-terminal"),s=this.prepareArrowheadDragging(r,{x:t,y:i});this.setEventData(e,s)}dragArrowhead(e,t,i){let r=this.getEventData(e);this.graph.options.connecting.snap?this.snapArrowhead(t,i,r):this.arrowheadDragging(this.getEventTarget(e),t,i,r)}stopArrowheadDragging(e,t,i){let r=this.graph,s=this.getEventData(e);r.options.connecting.snap?this.snapArrowheadEnd(s):this.arrowheadDragged(s,t,i),this.validateEdge(this.cell,s.terminalType,s.initialTerminal)?(this.finishEmbedding(s),this.notifyConnectionEvent(s,e)):this.fallbackConnection(s),this.afterArrowheadDragging(s)}startLabelDragging(e,t,i){if(this.can("edgeLabelMovable")){let t=parseInt(e.currentTarget.getAttribute("data-index"),10),i=this.getLabelPositionAngle(t),r=this.getLabelPositionArgs(t),s=this.getDefaultLabelPositionArgs(),n=this.mergeLabelPositionArgs(r,s);this.setEventData(e,{index:t,positionAngle:i,positionArgs:n,stopPropagation:!0,action:"drag-label"})}else this.setEventData(e,{stopPropagation:!0});this.graph.view.delegateDragEvents(e,this)}dragLabel(e,t,i){let r=this.getEventData(e),s=this.cell.getLabelAt(r.index),n=e_.QK.merge({},s,{position:this.getLabelPosition(t,i,r.positionAngle,r.positionArgs)});this.cell.setLabelAt(r.index,n)}stopLabelDragging(e,t,i){}}(et=nr||(nr={})).toStringTag=`X6.${et.name}`,et.isEdgeView=function(e){if(null==e)return!1;if(e instanceof et)return!0;let t=e[Symbol.toStringTag];return(null==t||t===et.toStringTag)&&"function"==typeof e.isNodeView&&"function"==typeof e.isEdgeView&&"function"==typeof e.confirmUpdate&&"function"==typeof e.update&&"function"==typeof e.getConnection||!1},nr.config({isSvgElement:!0,priority:1,bootstrap:["render","source","target"],actions:{view:["render"],markup:["render"],attrs:["update"],source:["source","update"],target:["target","update"],router:["update"],connector:["update"],labels:["labels"],defaultLabel:["labels"],tools:["tools"],vertices:["vertices","update"]}}),nr.registry.register("edge",nr,!0);class ns extends rh{get disposeContainer(){return!1}get options(){return this.graph.options}constructor(e){super(),this.graph=e;let{selectors:t,fragment:i}=eO.parseJSONMarkup(ns.markup);this.background=t.background,this.grid=t.grid,this.svg=t.svg,this.defs=t.defs,this.viewport=t.viewport,this.primer=t.primer,this.stage=t.stage,this.decorator=t.decorator,this.overlay=t.overlay,this.container=this.options.container,this.restore=ns.snapshoot(this.container),e_.is.addClass(this.container,this.prefixClassName("graph")),e_.is.append(this.container,i),this.delegateEvents()}delegateEvents(){let e=this.constructor;return super.delegateEvents(e.events),this}guard(e,t){return!!("mousedown"===e.type&&2===e.button||this.options.guard&&this.options.guard(e,t))||(e.data&&void 0!==e.data.guarded?e.data.guarded:!(t&&t.cell&&sU.isCell(t.cell)||this.svg===e.target||this.container===e.target||this.svg.contains(e.target)))}findView(e){return this.graph.findViewByElem(e)}onDblClick(e){this.options.preventDefaultDblClick&&e.preventDefault();let t=this.normalizeEvent(e),i=this.findView(t.target);if(this.guard(t,i))return;let r=this.graph.snapToGrid(t.clientX,t.clientY);i?i.onDblClick(t,r.x,r.y):this.graph.trigger("blank:dblclick",{e:t,x:r.x,y:r.y})}onClick(e){if(this.getMouseMovedCount(e)<=this.options.clickThreshold){let t=this.normalizeEvent(e),i=this.findView(t.target);if(this.guard(t,i))return;let r=this.graph.snapToGrid(t.clientX,t.clientY);i?i.onClick(t,r.x,r.y):this.graph.trigger("blank:click",{e:t,x:r.x,y:r.y})}}isPreventDefaultContextMenu(e){let t=this.options.preventDefaultContextMenu;return"function"==typeof t&&(t=e_.Iw.call(t,this.graph,{view:e})),t}onContextMenu(e){let t=this.normalizeEvent(e),i=this.findView(t.target);if(this.isPreventDefaultContextMenu(i)&&e.preventDefault(),this.guard(t,i))return;let r=this.graph.snapToGrid(t.clientX,t.clientY);i?i.onContextMenu(t,r.x,r.y):this.graph.trigger("blank:contextmenu",{e:t,x:r.x,y:r.y})}delegateDragEvents(e,t){null==e.data&&(e.data={}),this.setEventData(e,{currentView:t||null,mouseMovedCount:0,startPosition:{x:e.clientX,y:e.clientY}});let i=this.constructor;this.delegateDocumentEvents(i.documentEvents,e.data),this.undelegateEvents()}getMouseMovedCount(e){return this.getEventData(e).mouseMovedCount||0}onMouseDown(e){let t=this.normalizeEvent(e),i=this.findView(t.target);if(this.guard(t,i))return;this.options.preventDefaultMouseDown&&e.preventDefault();let r=this.graph.snapToGrid(t.clientX,t.clientY);i?i.onMouseDown(t,r.x,r.y):(this.options.preventDefaultBlankAction&&["touchstart"].includes(t.type)&&e.preventDefault(),this.graph.trigger("blank:mousedown",{e:t,x:r.x,y:r.y})),this.delegateDragEvents(t,i)}onMouseMove(e){let t=this.getEventData(e),i=t.startPosition;if(i&&i.x===e.clientX&&i.y===e.clientY||(null==t.mouseMovedCount&&(t.mouseMovedCount=0),t.mouseMovedCount+=1,t.mouseMovedCount<=this.options.moveThreshold))return;let r=this.normalizeEvent(e),s=this.graph.snapToGrid(r.clientX,r.clientY),n=t.currentView;n?n.onMouseMove(r,s.x,s.y):this.graph.trigger("blank:mousemove",{e:r,x:s.x,y:s.y}),this.setEventData(r,t)}onMouseUp(e){this.undelegateDocumentEvents();let t=this.normalizeEvent(e),i=this.graph.snapToGrid(t.clientX,t.clientY),r=this.getEventData(e).currentView;if(r?r.onMouseUp(t,i.x,i.y):this.graph.trigger("blank:mouseup",{e:t,x:i.x,y:i.y}),!e.isPropagationStopped()){let t=new e_.is.EventObject(e,{type:"click",data:e.data});this.onClick(t)}e.stopImmediatePropagation(),this.delegateEvents()}onMouseOver(e){let t=this.normalizeEvent(e),i=this.findView(t.target);if(!this.guard(t,i))if(i)i.onMouseOver(t);else{if(this.container===t.target)return;this.graph.trigger("blank:mouseover",{e:t})}}onMouseOut(e){let t=this.normalizeEvent(e),i=this.findView(t.target);if(!this.guard(t,i))if(i)i.onMouseOut(t);else{if(this.container===t.target)return;this.graph.trigger("blank:mouseout",{e:t})}}onMouseEnter(e){let t=this.normalizeEvent(e),i=this.findView(t.target);if(this.guard(t,i))return;let r=this.graph.findViewByElem(t.relatedTarget);if(i){if(r===i)return;i.onMouseEnter(t)}else{if(r)return;this.graph.trigger("graph:mouseenter",{e:t})}}onMouseLeave(e){let t=this.normalizeEvent(e),i=this.findView(t.target);if(this.guard(t,i))return;let r=this.graph.findViewByElem(t.relatedTarget);if(i){if(r===i)return;i.onMouseLeave(t)}else{if(r)return;this.graph.trigger("graph:mouseleave",{e:t})}}onMouseWheel(e){let t=this.normalizeEvent(e),i=this.findView(t.target);if(this.guard(t,i))return;let r=t.originalEvent,s=this.graph.snapToGrid(r.clientX,r.clientY),n=Math.max(-1,Math.min(1,r.wheelDelta||-r.detail));i?i.onMouseWheel(t,s.x,s.y,n):this.graph.trigger("blank:mousewheel",{e:t,delta:n,x:s.x,y:s.y})}onCustomEvent(e){let t=e.currentTarget,i=t.getAttribute("event")||t.getAttribute("data-event");if(i){let r=this.findView(t);if(r){let t=this.normalizeEvent(e);if(this.guard(t,r))return;let s=this.graph.snapToGrid(t.clientX,t.clientY);r.onCustomEvent(t,i,s.x,s.y)}}}handleMagnetEvent(e,t){let i=e.currentTarget,r=i.getAttribute("magnet");if(r&&"false"!==r.toLowerCase()){let r=this.findView(i);if(r){let s=this.normalizeEvent(e);if(this.guard(s,r))return;let n=this.graph.snapToGrid(s.clientX,s.clientY);e_.Iw.call(t,this.graph,r,s,i,n.x,n.y)}}}onMagnetMouseDown(e){this.handleMagnetEvent(e,(e,t,i,r,s)=>{e.onMagnetMouseDown(t,i,r,s)})}onMagnetDblClick(e){this.handleMagnetEvent(e,(e,t,i,r,s)=>{e.onMagnetDblClick(t,i,r,s)})}onMagnetContextMenu(e){let t=this.findView(e.target);this.isPreventDefaultContextMenu(t)&&e.preventDefault(),this.handleMagnetEvent(e,(e,t,i,r,s)=>{e.onMagnetContextMenu(t,i,r,s)})}onLabelMouseDown(e){let t=e.currentTarget,i=this.findView(t);if(i){let t=this.normalizeEvent(e);if(this.guard(t,i))return;let r=this.graph.snapToGrid(t.clientX,t.clientY);i.onLabelMouseDown(t,r.x,r.y)}}onImageDragStart(){return!1}dispose(){this.undelegateEvents(),this.undelegateDocumentEvents(),this.restore(),this.restore=()=>{}}}!function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);n>3&&o&&Object.defineProperty(t,i,o)}([rh.dispose()],ns.prototype,"dispose",null);var nn=ns||(ns={});let no=`${iR.prefixCls}-graph`;nn.markup=[{ns:e_.is.ns.xhtml,tagName:"div",selector:"background",className:`${no}-background`},{ns:e_.is.ns.xhtml,tagName:"div",selector:"grid",className:`${no}-grid`},{ns:e_.is.ns.svg,tagName:"svg",selector:"svg",className:`${no}-svg`,attrs:{width:"100%",height:"100%","xmlns:xlink":e_.is.ns.xlink},children:[{tagName:"defs",selector:"defs"},{tagName:"g",selector:"viewport",className:`${no}-svg-viewport`,children:[{tagName:"g",selector:"primer",className:`${no}-svg-primer`},{tagName:"g",selector:"stage",className:`${no}-svg-stage`},{tagName:"g",selector:"decorator",className:`${no}-svg-decorator`},{tagName:"g",selector:"overlay",className:`${no}-svg-overlay`}]}]}],nn.snapshoot=function(e){let t=e.cloneNode();return e.childNodes.forEach(e=>t.appendChild(e)),()=>{for(e_.is.empty(e);e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);for(let i=0,r=t.attributes.length;i<r;i+=1){let r=t.attributes[i];e.setAttribute(r.name,r.value)}t.childNodes.forEach(t=>e.appendChild(t))}};var nl=ns||(ns={});let na=iR.prefixCls;nl.events={dblclick:"onDblClick",contextmenu:"onContextMenu",touchstart:"onMouseDown",mousedown:"onMouseDown",mouseover:"onMouseOver",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousewheel:"onMouseWheel",DOMMouseScroll:"onMouseWheel",[`mouseenter  .${na}-cell`]:"onMouseEnter",[`mouseleave  .${na}-cell`]:"onMouseLeave",[`mouseenter  .${na}-cell-tools`]:"onMouseEnter",[`mouseleave  .${na}-cell-tools`]:"onMouseLeave",[`mousedown   .${na}-cell [event]`]:"onCustomEvent",[`touchstart  .${na}-cell [event]`]:"onCustomEvent",[`mousedown   .${na}-cell [data-event]`]:"onCustomEvent",[`touchstart  .${na}-cell [data-event]`]:"onCustomEvent",[`dblclick    .${na}-cell [magnet]`]:"onMagnetDblClick",[`contextmenu .${na}-cell [magnet]`]:"onMagnetContextMenu",[`mousedown   .${na}-cell [magnet]`]:"onMagnetMouseDown",[`touchstart  .${na}-cell [magnet]`]:"onMagnetMouseDown",[`dblclick    .${na}-cell [data-magnet]`]:"onMagnetDblClick",[`contextmenu .${na}-cell [data-magnet]`]:"onMagnetContextMenu",[`mousedown   .${na}-cell [data-magnet]`]:"onMagnetMouseDown",[`touchstart  .${na}-cell [data-magnet]`]:"onMagnetMouseDown",[`dragstart   .${na}-cell image`]:"onImageDragStart",[`mousedown   .${na}-edge .${na}-edge-label`]:"onLabelMouseDown",[`touchstart  .${na}-edge .${na}-edge-label`]:"onLabelMouseDown"},nl.documentEvents={mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"};let nh=`.x6-graph {
  position: relative;
  overflow: hidden;
  outline: none;
  touch-action: none;
}
.x6-graph-background,
.x6-graph-grid,
.x6-graph-svg {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}
.x6-graph-background-stage,
.x6-graph-grid-stage,
.x6-graph-svg-stage {
  user-select: none;
}
.x6-graph.x6-graph-pannable {
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}
.x6-graph.x6-graph-panning {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
  user-select: none;
}
.x6-node {
  cursor: move;
  /* stylelint-disable-next-line */
}
.x6-node.x6-node-immovable {
  cursor: default;
}
.x6-node * {
  -webkit-user-drag: none;
}
.x6-node .scalable * {
  vector-effect: non-scaling-stroke;
}
.x6-node [magnet='true'] {
  cursor: crosshair;
  transition: opacity 0.3s;
}
.x6-node [magnet='true']:hover {
  opacity: 0.7;
}
.x6-node foreignObject {
  display: block;
  overflow: visible;
  background-color: transparent;
}
.x6-node foreignObject > body {
  position: static;
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
  overflow: visible;
  background-color: transparent;
}
.x6-edge .source-marker,
.x6-edge .target-marker {
  vector-effect: non-scaling-stroke;
}
.x6-edge .connection {
  stroke-linejoin: round;
  fill: none;
}
.x6-edge .connection-wrap {
  cursor: move;
  opacity: 0;
  fill: none;
  stroke: #000;
  stroke-width: 15;
  stroke-linecap: round;
  stroke-linejoin: round;
}
.x6-edge .connection-wrap:hover {
  opacity: 0.4;
  stroke-opacity: 0.4;
}
.x6-edge .vertices {
  cursor: move;
  opacity: 0;
}
.x6-edge .vertices .vertex {
  fill: #1abc9c;
}
.x6-edge .vertices .vertex :hover {
  fill: #34495e;
  stroke: none;
}
.x6-edge .vertices .vertex-remove {
  cursor: pointer;
  fill: #fff;
}
.x6-edge .vertices .vertex-remove-area {
  cursor: pointer;
  opacity: 0.1;
}
.x6-edge .vertices .vertex-group:hover .vertex-remove-area {
  opacity: 1;
}
.x6-edge .arrowheads {
  cursor: move;
  opacity: 0;
}
.x6-edge .arrowheads .arrowhead {
  fill: #1abc9c;
}
.x6-edge .arrowheads .arrowhead :hover {
  fill: #f39c12;
  stroke: none;
}
.x6-edge .tools {
  cursor: pointer;
  opacity: 0;
}
.x6-edge .tools .tool-options {
  display: none;
}
.x6-edge .tools .tool-remove circle {
  fill: #f00;
}
.x6-edge .tools .tool-remove path {
  fill: #fff;
}
.x6-edge:hover .vertices,
.x6-edge:hover .arrowheads,
.x6-edge:hover .tools {
  opacity: 1;
}
.x6-highlight-opacity {
  opacity: 0.3;
}
.x6-cell-tool-editor {
  position: relative;
  display: inline-block;
  min-height: 1em;
  margin: 0;
  padding: 0;
  line-height: 1;
  white-space: normal;
  text-align: center;
  vertical-align: top;
  overflow-wrap: normal;
  outline: none;
  transform-origin: 0 0;
  -webkit-user-drag: none;
}
.x6-edge-tool-editor {
  border: 1px solid #275fc5;
  border-radius: 2px;
}
`;class nc extends e_.JT{get options(){return this.graph.options}get model(){return this.graph.model}get view(){return this.graph.view}constructor(e){super(),this.graph=e,this.init()}init(){}}class ng extends nc{init(){iR.autoInsertCSS&&e_.mf.ensure("core",nh)}dispose(){e_.mf.clean("core")}}!function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);n>3&&o&&Object.defineProperty(t,i,o)}([ng.dispose()],ng.prototype,"dispose",null);var nu=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};(ei=eV||(eV={})).get=function(e){let{grid:t,panning:i,mousewheel:r,embedding:s}=e,n=nu(e,["grid","panning","mousewheel","embedding"]),o=e.container;if(null!=o)null==n.width&&(n.width=o.clientWidth),null==n.height&&(n.height=o.clientHeight);else throw Error("Ensure the container of the graph is specified and valid");let l=e_.QK.merge({},ei.defaults,n),a={size:10,visible:!1};return"number"==typeof t?l.grid={size:t,visible:!1}:"boolean"==typeof t?l.grid=Object.assign(Object.assign({},a),{visible:t}):l.grid=Object.assign(Object.assign({},a),t),["panning","mousewheel","embedding"].forEach(t=>{let i=e[t];"boolean"==typeof i?l[t].enabled=i:l[t]=Object.assign(Object.assign({},l[t]),i)}),l},(eV||(eV={})).defaults={x:0,y:0,scaling:{min:.01,max:16},grid:{size:10,visible:!1},background:!1,panning:{enabled:!1,eventTypes:["leftMouseDown"]},mousewheel:{enabled:!1,factor:1.2,zoomAtMousePosition:!0},highlighting:{default:{name:"stroke",args:{padding:3}},nodeAvailable:{name:"className",args:{className:iR.prefix("available-node")}},magnetAvailable:{name:"className",args:{className:iR.prefix("available-magnet")}}},connecting:{snap:!1,allowLoop:!0,allowNode:!0,allowEdge:!1,allowPort:!0,allowBlank:!0,allowMulti:!0,highlight:!1,anchor:"center",edgeAnchor:"ratio",connectionPoint:"boundary",router:"normal",connector:"normal",validateConnection:({type:e,sourceView:t,targetView:i})=>null!=("target"===e?i:t),createEdge:()=>new s9},translating:{restrict:!1},embedding:{enabled:!1,findParent:"bbox",frontOnly:!0,validate:()=>!0},moveThreshold:0,clickThreshold:0,magnetThreshold:0,preventDefaultDblClick:!0,preventDefaultMouseDown:!1,preventDefaultContextMenu:!0,preventDefaultBlankAction:!0,interacting:{edgeLabelMovable:!1},async:!0,virtual:!1,guard:()=>!1};var nd=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};class np extends nc{get elem(){return this.view.grid}get grid(){return this.options.grid}init(){this.startListening(),this.draw(this.grid)}startListening(){this.graph.on("scale",this.update,this),this.graph.on("translate",this.update,this)}stopListening(){this.graph.off("scale",this.update,this),this.graph.off("translate",this.update,this)}setVisible(e){this.grid.visible!==e&&(this.grid.visible=e,this.update())}getGridSize(){return this.grid.size}setGridSize(e){this.grid.size=Math.max(e,1),this.update()}show(){this.setVisible(!0),this.update()}hide(){this.setVisible(!1),this.update()}clear(){this.elem.style.backgroundImage=""}draw(e){this.clear(),this.instance=null,Object.assign(this.grid,e),this.patterns=this.resolveGrid(e),this.update()}update(e={}){let t=this.grid.size;if(t<=1||!this.grid.visible)return this.clear();let i=this.graph.matrix(),r=this.getInstance(),s=Array.isArray(e)?e:[e];this.patterns.forEach((e,n)=>{let o=`pattern_${n}`,l=i.a||1,a=i.d||1,{update:h,markup:c}=e,g=Object.assign(Object.assign(Object.assign({},nd(e,["update","markup"])),s[n]),{sx:l,sy:a,ox:i.e||0,oy:i.f||0,width:t*l,height:t*a});r.has(o)||r.add(o,e_.OW.create("pattern",{id:o,patternUnits:"userSpaceOnUse"},e_.OW.createVectors(c)).node);let u=r.get(o);"function"==typeof h&&h(u.childNodes[0],g);let d=g.ox%g.width;d<0&&(d+=g.width);let p=g.oy%g.height;p<0&&(p+=g.height),e_.is.attr(u,{x:d,y:p,width:g.width,height:g.height})});let n=new XMLSerializer().serializeToString(r.root),o=`url(data:image/svg+xml;base64,${btoa(n)})`;this.elem.style.backgroundImage=o}getInstance(){return this.instance||(this.instance=new e5),this.instance}resolveGrid(e){if(!e)return[];let t=e.type;if(null==t)return[Object.assign(Object.assign({},e5.presets.dot),e.args)];let i=e5.registry.get(t);if(i){let t=e.args||[];return Array.isArray(t)||(t=[t]),Array.isArray(i)?i.map((e,i)=>Object.assign(Object.assign({},e),t[i])):[Object.assign(Object.assign({},i),t[0])]}return e5.registry.onNotFound(t)}dispose(){this.stopListening(),this.clear()}}!function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);n>3&&o&&Object.defineProperty(t,i,o)}([nc.dispose()],np.prototype,"dispose",null);class nf extends nc{get container(){return this.graph.view.container}get viewport(){return this.graph.view.viewport}get stage(){return this.graph.view.stage}init(){this.resize()}getMatrix(){let e=this.viewport.getAttribute("transform");return e!==this.viewportTransformString&&(this.viewportMatrix=this.viewport.getCTM(),this.viewportTransformString=e),e_.is.createSVGMatrix(this.viewportMatrix)}setMatrix(e){let t=e_.is.createSVGMatrix(e),i=e_.is.matrixToTransformString(t);this.viewport.setAttribute("transform",i),this.viewportMatrix=t,this.viewportTransformString=i}resize(e,t){let i=void 0===e?this.options.width:e,r=void 0===t?this.options.height:t;this.options.width=i,this.options.height=r,"number"==typeof i&&(i=Math.round(i)),"number"==typeof r&&(r=Math.round(r)),this.container.style.width=null==i?"":`${i}px`,this.container.style.height=null==r?"":`${r}px`;let s=this.getComputedSize();return this.graph.trigger("resize",Object.assign({},s)),this}getComputedSize(){let e=this.options.width,t=this.options.height;return e_.GH.isNumber(e)||(e=this.container.clientWidth),e_.GH.isNumber(t)||(t=this.container.clientHeight),{width:e,height:t}}getScale(){return e_.is.matrixToScale(this.getMatrix())}scale(e,t=e,i=0,r=0){if(e=this.clampScale(e),t=this.clampScale(t),i||r){let s=this.getTranslation(),n=s.tx-i*(e-1),o=s.ty-r*(t-1);(n!==s.tx||o!==s.ty)&&this.translate(n,o)}let s=this.getMatrix();return s.a=e,s.d=t,this.setMatrix(s),this.graph.trigger("scale",{sx:e,sy:t,ox:i,oy:r}),this}clampScale(e){let t=this.graph.options.scaling;return e_.GH.clamp(e,t.min||.01,t.max||16)}getZoom(){return this.getScale().sx}zoom(e,t){t=t||{};let i=e,r=e,s=this.getScale(),n=this.getComputedSize(),o=n.width/2,l=n.height/2;if(t.absolute||(i+=s.sx,r+=s.sy),t.scaleGrid&&(i=Math.round(i/t.scaleGrid)*t.scaleGrid,r=Math.round(r/t.scaleGrid)*t.scaleGrid),t.maxScale&&(i=Math.min(t.maxScale,i),r=Math.min(t.maxScale,r)),t.minScale&&(i=Math.max(t.minScale,i),r=Math.max(t.minScale,r)),t.center&&(o=t.center.x,l=t.center.y),i=this.clampScale(i),r=this.clampScale(r),o||l){let e=this.getTranslation(),t=o-(o-e.tx)*(i/s.sx),n=l-(l-e.ty)*(r/s.sy);(t!==e.tx||n!==e.ty)&&this.translate(t,n)}return this.scale(i,r),this}getRotation(){return e_.is.matrixToRotation(this.getMatrix())}rotate(e,t,i){if(null==t||null==i){let e=ev.getBBox(this.stage);t=e.width/2,i=e.height/2}let r=this.getMatrix().translate(t,i).rotate(e).translate(-t,-i);return this.setMatrix(r),this}getTranslation(){return e_.is.matrixToTranslation(this.getMatrix())}translate(e,t){let i=this.getMatrix();i.e=e||0,i.f=t||0,this.setMatrix(i);let r=this.getTranslation();return this.options.x=r.tx,this.options.y=r.ty,this.graph.trigger("translate",Object.assign({},r)),this}setOrigin(e,t){return this.translate(e||0,t||0)}fitToContent(e,t,i,r){if("object"==typeof e){let s=e;e=s.gridWidth||1,t=s.gridHeight||1,i=s.padding||0,r=s}else e=e||1,t=t||1,i=i||0,null==r&&(r={});let s=e_.GH.normalizeSides(i),n=r.border||0,o=r.contentArea?e0.Ae.create(r.contentArea):this.getContentArea(r);n>0&&o.inflate(n);let l=this.getScale(),a=this.getTranslation(),h=l.sx,c=l.sy;o.x*=h,o.y*=c,o.width*=h,o.height*=c;let g=Math.max(Math.ceil((o.width+o.x)/e),1)*e,u=Math.max(Math.ceil((o.height+o.y)/t),1)*t,d=0,p=0;("negative"===r.allowNewOrigin&&o.x<0||"positive"===r.allowNewOrigin&&o.x>=0||"any"===r.allowNewOrigin)&&(g+=d=Math.ceil(-o.x/e)*e+s.left),("negative"===r.allowNewOrigin&&o.y<0||"positive"===r.allowNewOrigin&&o.y>=0||"any"===r.allowNewOrigin)&&(u+=p=Math.ceil(-o.y/t)*t+s.top),g+=s.right,u+=s.bottom,g=Math.max(g,r.minWidth||0),u=Math.max(u,r.minHeight||0),g=Math.min(g,r.maxWidth||Number.MAX_SAFE_INTEGER),u=Math.min(u,r.maxHeight||Number.MAX_SAFE_INTEGER);let f=this.getComputedSize(),m=g!==f.width||u!==f.height;return(d!==a.tx||p!==a.ty)&&this.translate(d,p),m&&this.resize(g,u),new e0.Ae(-d/h,-p/c,g/h,u/c)}scaleContentToFit(e={}){this.scaleContentToFitImpl(e)}scaleContentToFitImpl(e={},t=!0){let i,r,s;if(e.contentArea){let t=e.contentArea;i=this.graph.localToGraph(t),r=e0.E9.create(t)}else i=this.getContentBBox(e),r=this.graph.graphToLocal(i);if(!i.width||!i.height)return;let n=e_.GH.normalizeSides(e.padding),o=e.minScale||0,l=e.maxScale||Number.MAX_SAFE_INTEGER,a=e.minScaleX||o,h=e.maxScaleX||l,c=e.minScaleY||o,g=e.maxScaleY||l;if(e.viewportArea)s=e.viewportArea;else{let e=this.getComputedSize(),t=this.getTranslation();s={x:t.tx,y:t.ty,width:e.width,height:e.height}}s=e0.Ae.create(s).moveAndExpand({x:n.left,y:n.top,width:-n.left-n.right,height:-n.top-n.bottom});let u=this.getScale(),d=s.width/i.width*u.sx,p=s.height/i.height*u.sy;!1!==e.preserveAspectRatio&&(d=p=Math.min(d,p));let f=e.scaleGrid;if(f&&(d=f*Math.floor(d/f),p=f*Math.floor(p/f)),d=e_.GH.clamp(d,a,h),p=e_.GH.clamp(p,c,g),this.scale(d,p),t){let e=this.options,t=s.x-r.x*d-e.x,i=s.y-r.y*p-e.y;this.translate(t,i)}}getContentArea(e={}){return!1!==e.useCellGeometry?this.model.getAllCellsBBox()||new e0.Ae:ev.getBBox(this.stage)}getContentBBox(e={}){return this.graph.localToGraph(this.getContentArea(e))}getGraphArea(){let e=e0.Ae.fromSize(this.getComputedSize());return this.graph.graphToLocal(e)}zoomToRect(e,t={}){let i=e0.Ae.create(e),r=this.graph;t.contentArea=i,null==t.viewportArea&&(t.viewportArea={x:r.options.x,y:r.options.y,width:this.options.width,height:this.options.height}),this.scaleContentToFitImpl(t,!1);let s=i.getCenter();return this.centerPoint(s.x,s.y),this}zoomToFit(e={}){return this.zoomToRect(this.getContentArea(e),e)}centerPoint(e,t){let i=this.getComputedSize(),r=this.getScale(),s=this.getTranslation(),n=i.width/2,o=i.height/2;e="number"==typeof e?e:n,t="number"==typeof t?t:o,e=n-e*r.sx,t=o-t*r.sy,(s.tx!==e||s.ty!==t)&&this.translate(e,t)}centerContent(e){let t=this.graph.getContentArea(e).getCenter();this.centerPoint(t.x,t.y)}centerCell(e){return this.positionCell(e,"center")}positionPoint(e,t,i){let r=this.getComputedSize();(t=e_.GH.normalizePercentage(t,Math.max(0,r.width)))<0&&(t=r.width+t),(i=e_.GH.normalizePercentage(i,Math.max(0,r.height)))<0&&(i=r.height+i);let s=this.getTranslation(),n=this.getScale(),o=t-e.x*n.sx,l=i-e.y*n.sy;(s.tx!==o||s.ty!==l)&&this.translate(o,l)}positionRect(e,t){let i=e0.Ae.create(e);switch(t){case"center":return this.positionPoint(i.getCenter(),"50%","50%");case"top":return this.positionPoint(i.getTopCenter(),"50%",0);case"top-right":return this.positionPoint(i.getTopRight(),"100%",0);case"right":return this.positionPoint(i.getRightMiddle(),"100%","50%");case"bottom-right":return this.positionPoint(i.getBottomRight(),"100%","100%");case"bottom":return this.positionPoint(i.getBottomCenter(),"50%","100%");case"bottom-left":return this.positionPoint(i.getBottomLeft(),0,"100%");case"left":return this.positionPoint(i.getLeftMiddle(),0,"50%");case"top-left":return this.positionPoint(i.getTopLeft(),0,0);default:return this}}positionCell(e,t){let i=e.getBBox();return this.positionRect(i,t)}positionContent(e,t){let i=this.graph.getContentArea(t);return this.positionRect(i,e)}}class nm extends nc{get elem(){return this.view.background}init(){this.startListening(),this.options.background&&this.draw(this.options.background)}startListening(){this.graph.on("scale",this.update,this),this.graph.on("translate",this.update,this)}stopListening(){this.graph.off("scale",this.update,this),this.graph.off("translate",this.update,this)}updateBackgroundImage(e={}){let t=e.size||"auto auto",i=e.position||"center",r=this.graph.transform.getScale(),s=this.graph.translate();if("object"==typeof i){let e=s.tx+r.sx*(i.x||0),t=s.ty+r.sy*(i.y||0);i=`${e}px ${t}px`}"object"==typeof t&&(t=e0.Ae.fromSize(t).scale(r.sx,r.sy),t=`${t.width}px ${t.height}px`),this.elem.style.backgroundSize=t,this.elem.style.backgroundPosition=i}drawBackgroundImage(e,t={}){let i;if(!(e instanceof HTMLImageElement)){this.elem.style.backgroundImage="";return}let r=this.optionsCache;if(r&&r.image!==t.image)return;let s=t.opacity,n=t.size,o=t.repeat||"no-repeat",l=ef.registry.get(o);if("function"==typeof l){let r=t.quality||1;e.width*=r,e.height*=r;let s=l(e,t);if(!(s instanceof HTMLCanvasElement))throw Error("Background pattern must return an HTML Canvas instance");i=s.toDataURL("image/png"),o=t.repeat&&o!==t.repeat?t.repeat:"repeat","object"==typeof n?(n.width*=s.width/e.width,n.height*=s.height/e.height):void 0===n&&(t.size={width:s.width/r,height:s.height/r})}else i=e.src,void 0===n&&(t.size={width:e.width,height:e.height});null!=r&&"object"==typeof t.size&&t.image===r.image&&t.repeat===r.repeat&&t.quality===r.quality&&(r.size=e_.QK.clone(t.size));let a=this.elem.style;a.backgroundImage=`url(${i})`,a.backgroundRepeat=o,a.opacity=null==s||s>=1?"":`${s}`,this.updateBackgroundImage(t)}updateBackgroundColor(e){this.elem.style.backgroundColor=e||""}updateBackgroundOptions(e){this.graph.options.background=e}update(){this.optionsCache&&this.updateBackgroundImage(this.optionsCache)}draw(e){let t=e||{};if(this.updateBackgroundOptions(e),this.updateBackgroundColor(t.color),t.image){this.optionsCache=e_.QK.clone(t);let i=document.createElement("img");i.onload=()=>this.drawBackgroundImage(i,e),i.setAttribute("crossorigin","anonymous"),i.src=t.image}else this.drawBackgroundImage(null),this.optionsCache=null}clear(){this.draw()}dispose(){this.clear(),this.stopListening()}}!function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);n>3&&o&&Object.defineProperty(t,i,o)}([nc.dispose()],nm.prototype,"dispose",null);class ny extends nc{get widgetOptions(){return this.options.panning}get pannable(){return this.widgetOptions&&!0===this.widgetOptions.enabled}init(){this.onRightMouseDown=this.onRightMouseDown.bind(this),this.onSpaceKeyDown=this.onSpaceKeyDown.bind(this),this.onSpaceKeyUp=this.onSpaceKeyUp.bind(this),this.startListening(),this.updateClassName()}startListening(){this.graph.on("blank:mousedown",this.onMouseDown,this),this.graph.on("node:unhandled:mousedown",this.onMouseDown,this),this.graph.on("edge:unhandled:mousedown",this.onMouseDown,this),e_.is.Event.on(this.graph.container,"mousedown",this.onRightMouseDown),e_.is.Event.on(document.body,{keydown:this.onSpaceKeyDown,keyup:this.onSpaceKeyUp}),this.mousewheelHandle=new e_.is.MouseWheelHandle(this.graph.container,this.onMouseWheel.bind(this),this.allowMouseWheel.bind(this)),this.mousewheelHandle.enable()}stopListening(){this.graph.off("blank:mousedown",this.onMouseDown,this),this.graph.off("node:unhandled:mousedown",this.onMouseDown,this),this.graph.off("edge:unhandled:mousedown",this.onMouseDown,this),e_.is.Event.off(this.graph.container,"mousedown",this.onRightMouseDown),e_.is.Event.off(document.body,{keydown:this.onSpaceKeyDown,keyup:this.onSpaceKeyUp}),this.mousewheelHandle&&this.mousewheelHandle.disable()}allowPanning(e,t){return e.spaceKey=this.isSpaceKeyPressed,this.pannable&&e_.tx.isMatch(e,this.widgetOptions.modifiers,t)}startPanning(e){let t=this.view.normalizeEvent(e);this.clientX=t.clientX,this.clientY=t.clientY,this.panning=!0,this.updateClassName(),e_.is.Event.on(document.body,{"mousemove.panning touchmove.panning":this.pan.bind(this),"mouseup.panning touchend.panning":this.stopPanning.bind(this),"mouseleave.panning":this.stopPanning.bind(this)}),e_.is.Event.on(window,"mouseup.panning",this.stopPanning.bind(this))}pan(e){let t=this.view.normalizeEvent(e),i=t.clientX-this.clientX,r=t.clientY-this.clientY;this.clientX=t.clientX,this.clientY=t.clientY,this.graph.translateBy(i,r)}stopPanning(e){this.panning=!1,this.updateClassName(),e_.is.Event.off(document.body,".panning"),e_.is.Event.off(window,".panning")}updateClassName(){let e=this.view.container,t=this.view.prefixClassName("graph-panning"),i=this.view.prefixClassName("graph-pannable");this.pannable?this.panning?(e_.is.addClass(e,t),e_.is.removeClass(e,i)):(e_.is.removeClass(e,t),e_.is.addClass(e,i)):(e_.is.removeClass(e,t),e_.is.removeClass(e,i))}onMouseDown({e}){if(!this.allowBlankMouseDown(e))return;let t=this.graph.getPlugin("selection"),i=t&&t.allowRubberband(e,!0);(this.allowPanning(e,!0)||this.allowPanning(e)&&!i)&&this.startPanning(e)}onRightMouseDown(e){let t=this.widgetOptions.eventTypes;(null==t?void 0:t.includes("rightMouseDown"))&&2===e.button&&this.allowPanning(e,!0)&&this.startPanning(e)}onMouseWheel(e,t,i){this.graph.translateBy(-t,-i)}onSpaceKeyDown(e){32===e.which&&(this.isSpaceKeyPressed=!0)}onSpaceKeyUp(e){32===e.which&&(this.isSpaceKeyPressed=!1)}allowBlankMouseDown(e){let t=this.widgetOptions.eventTypes;return(null==t?void 0:t.includes("leftMouseDown"))&&0===e.button||(null==t?void 0:t.includes("mouseWheelDown"))&&1===e.button}allowMouseWheel(e){var t;return this.pannable&&!e.ctrlKey&&(null==(t=this.widgetOptions.eventTypes)?void 0:t.includes("mouseWheel"))}autoPanning(e,t){let i=this.graph.getGraphArea(),r=0,s=0;e<=i.left+10&&(r=-10),t<=i.top+10&&(s=-10),e>=i.right-10&&(r=10),t>=i.bottom-10&&(s=10),(0!==r||0!==s)&&this.graph.translateBy(-r,-s)}enablePanning(){this.pannable||(this.widgetOptions.enabled=!0,this.updateClassName())}disablePanning(){this.pannable&&(this.widgetOptions.enabled=!1,this.updateClassName())}dispose(){this.stopListening()}}!function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);n>3&&o&&Object.defineProperty(t,i,o)}([nc.dispose()],ny.prototype,"dispose",null);class nb extends nc{constructor(){super(...arguments),this.cumulatedFactor=1}get widgetOptions(){return this.options.mousewheel}init(){this.container=this.graph.container,this.target=this.widgetOptions.global?document:this.container,this.mousewheelHandle=new e_.is.MouseWheelHandle(this.target,this.onMouseWheel.bind(this),this.allowMouseWheel.bind(this)),this.widgetOptions.enabled&&this.enable(!0)}get disabled(){return!0!==this.widgetOptions.enabled}enable(e){(this.disabled||e)&&(this.widgetOptions.enabled=!0,this.mousewheelHandle.enable())}disable(){this.disabled||(this.widgetOptions.enabled=!1,this.mousewheelHandle.disable())}allowMouseWheel(e){let t=this.widgetOptions.guard;return(null==t||t(e))&&e_.tx.isMatch(e,this.widgetOptions.modifiers)}onMouseWheel(e){let t=this.widgetOptions.guard;if((null==t||t(e))&&e_.tx.isMatch(e,this.widgetOptions.modifiers)){let t=this.widgetOptions.factor||1.2;null==this.currentScale&&(this.startPos={x:e.clientX,y:e.clientY},this.currentScale=this.graph.transform.getScale().sx),e.deltaY<0?this.currentScale<.15?this.cumulatedFactor=(this.currentScale+.01)/this.currentScale:(this.cumulatedFactor=Math.round(this.currentScale*t*20)/20/this.currentScale,1===this.cumulatedFactor&&(this.cumulatedFactor=1.05)):this.currentScale<=.15?this.cumulatedFactor=(this.currentScale-.01)/this.currentScale:(this.cumulatedFactor=Math.round(this.currentScale*(1/t)*20)/20/this.currentScale,1===this.cumulatedFactor&&(this.cumulatedFactor=.95)),this.cumulatedFactor=Math.max(.01,Math.min(this.currentScale*this.cumulatedFactor,160)/this.currentScale);let i=this.currentScale,r=this.graph.transform.clampScale(i*this.cumulatedFactor),s=this.widgetOptions.minScale||Number.MIN_SAFE_INTEGER,n=this.widgetOptions.maxScale||Number.MAX_SAFE_INTEGER;if((r=e_.GH.clamp(r,s,n))!==i)if(this.widgetOptions.zoomAtMousePosition){let e=this.graph.getPlugin("scroller")?this.graph.clientToLocal(this.startPos):this.graph.clientToGraph(this.startPos);this.graph.zoom(r,{absolute:!0,center:e.clone()})}else this.graph.zoom(r,{absolute:!0});this.currentScale=null,this.cumulatedFactor=1}}dispose(){this.disable()}}!function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);n>3&&o&&Object.defineProperty(t,i,o)}([e_.JT.dispose()],nb.prototype,"dispose",null);class nv extends nc{init(){this.resetRenderArea=e_.Iw.throttle(this.resetRenderArea,200,{leading:!0}),this.resetRenderArea(),this.startListening()}startListening(){this.graph.on("translate",this.resetRenderArea,this),this.graph.on("scale",this.resetRenderArea,this),this.graph.on("resize",this.resetRenderArea,this)}stopListening(){this.graph.off("translate",this.resetRenderArea,this),this.graph.off("scale",this.resetRenderArea,this),this.graph.off("resize",this.resetRenderArea,this)}enableVirtualRender(){this.options.virtual=!0,this.resetRenderArea()}disableVirtualRender(){this.options.virtual=!1,this.graph.renderer.setRenderArea(void 0)}resetRenderArea(){if(this.options.virtual){let e=this.graph.getGraphArea();this.graph.renderer.setRenderArea(e)}}dispose(){this.stopListening()}}!function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);n>3&&o&&Object.defineProperty(t,i,o)}([nc.dispose()],nv.prototype,"dispose",null);class nw{constructor(){this.isFlushing=!1,this.isFlushPending=!1,this.scheduleId=0,this.queue=[],this.frameInterval=33,this.initialTime=Date.now()}queueJob(e){if(e.priority&eI.PRIOR)e.cb();else{let t=this.findInsertionIndex(e);t>=0&&this.queue.splice(t,0,e)}}queueFlush(){this.isFlushing||this.isFlushPending||(this.isFlushPending=!0,this.scheduleJob())}queueFlushSync(){this.isFlushing||this.isFlushPending||(this.isFlushPending=!0,this.flushJobsSync())}clearJobs(){this.queue.length=0,this.isFlushing=!1,this.isFlushPending=!1,this.cancelScheduleJob()}flushJobs(){let e;this.isFlushPending=!1,this.isFlushing=!0;let t=this.getCurrentTime();for(;(e=this.queue.shift())&&(e.cb(),!(this.getCurrentTime()-t>=this.frameInterval)););this.isFlushing=!1,this.queue.length&&this.queueFlush()}flushJobsSync(){let e;for(this.isFlushPending=!1,this.isFlushing=!0;e=this.queue.shift();)try{e.cb()}catch(e){}this.isFlushing=!1}findInsertionIndex(e){let t=0,i=this.queue.length,r=i-1,s=e.priority;for(;t<=r;){let e=(r-t>>1)+t;s<=this.queue[e].priority?t=e+1:(i=e,r=e-1)}return i}scheduleJob(){"requestIdleCallback"in window?(this.scheduleId&&this.cancelScheduleJob(),this.scheduleId=window.requestIdleCallback(this.flushJobs.bind(this),{timeout:100})):(this.scheduleId&&this.cancelScheduleJob(),this.scheduleId=window.setTimeout(this.flushJobs.bind(this)))}cancelScheduleJob(){"cancelIdleCallback"in window?this.scheduleId&&window.cancelIdleCallback(this.scheduleId):this.scheduleId&&clearTimeout(this.scheduleId),this.scheduleId=0}getCurrentTime(){return"object"==typeof performance&&"function"==typeof performance.now?performance.now():Date.now()-this.initialTime}}(er=eI||(eI={}))[er.Update=2]="Update",er[er.RenderEdge=4]="RenderEdge",er[er.RenderNode=8]="RenderNode",er[er.PRIOR=1048576]="PRIOR";class nx extends e_.JT{get model(){return this.graph.model}get container(){return this.graph.view.stage}constructor(e){super(),this.views={},this.willRemoveViews={},this.queue=new nw,this.graph=e,this.init()}init(){this.startListening(),this.renderViews(this.model.getCells())}startListening(){this.model.on("reseted",this.onModelReseted,this),this.model.on("cell:added",this.onCellAdded,this),this.model.on("cell:removed",this.onCellRemoved,this),this.model.on("cell:change:zIndex",this.onCellZIndexChanged,this),this.model.on("cell:change:visible",this.onCellVisibleChanged,this)}stopListening(){this.model.off("reseted",this.onModelReseted,this),this.model.off("cell:added",this.onCellAdded,this),this.model.off("cell:removed",this.onCellRemoved,this),this.model.off("cell:change:zIndex",this.onCellZIndexChanged,this),this.model.off("cell:change:visible",this.onCellVisibleChanged,this)}onModelReseted({options:e}){this.queue.clearJobs(),this.removeZPivots(),this.resetViews();let t=this.model.getCells();this.renderViews(t,Object.assign(Object.assign({},e),{queue:t.map(e=>e.id)}))}onCellAdded({cell:e,options:t}){this.renderViews([e],t)}onCellRemoved({cell:e}){this.removeViews([e])}onCellZIndexChanged({cell:e,options:t}){let i=this.views[e.id];i&&this.requestViewUpdate(i.view,nx.FLAG_INSERT,t,eI.Update,!0)}onCellVisibleChanged({cell:e,current:t}){this.toggleVisible(e,!!t)}requestViewUpdate(e,t,i={},r=eI.Update,s=!0){let n=e.cell.id,o=this.views[n];o&&(o.flag=t,o.options=i,(e.hasAction(t,["translate","resize","rotate"])||!1===i.async)&&(r=eI.PRIOR,s=!1),this.queue.queueJob({id:n,priority:r,cb:()=>{this.renderViewInArea(e,t,i);let r=i.queue;if(r){let t=r.indexOf(e.cell.id);t>=0&&r.splice(t,1),0===r.length&&this.graph.trigger("render:done")}}}),this.getEffectedEdges(e).forEach(e=>{this.requestViewUpdate(e.view,e.flag,i,r,!1)}),s&&this.flush())}setRenderArea(e){this.renderArea=e,this.flushWaitingViews()}isViewMounted(e){if(null==e)return!1;let t=this.views[e.cell.id];return!!t&&t.state===nx.ViewState.MOUNTED}renderViews(e,t={}){e.sort((e,t)=>e.isNode()&&t.isEdge()?-1:0),e.forEach(e=>{let i=e.id,r=this.views,s=0,n=r[i];if(n)s=nx.FLAG_INSERT;else{let r=this.createCellView(e);r&&(r.graph=this.graph,s=nx.FLAG_INSERT|r.getBootstrapFlag(),n={view:r,flag:s,options:t,state:nx.ViewState.CREATED},this.views[i]=n)}n&&this.requestViewUpdate(n.view,s,t,this.getRenderPriority(n.view),!1)}),this.flush()}renderViewInArea(e,t,i={}){let r=e.cell,s=r.id,n=this.views[s];if(!n)return;let o=0;this.isUpdatable(e)||n.state===nx.ViewState.MOUNTED?n.flag=o=this.updateView(e,t,i):n.state=nx.ViewState.WAITING,o&&r.isEdge()&&(o&e.getFlag(["source","target"]))==0&&this.queue.queueJob({id:s,priority:eI.RenderEdge,cb:()=>{this.updateView(e,t,i)}})}removeViews(e){e.forEach(e=>{let t=e.id,i=this.views[t];i&&(this.willRemoveViews[t]=i,delete this.views[t],this.queue.queueJob({id:t,priority:this.getRenderPriority(i.view),cb:()=>{this.removeView(i.view)}}))}),this.flush()}flush(){this.graph.options.async?this.queue.queueFlush():this.queue.queueFlushSync()}flushWaitingViews(){Object.values(this.views).forEach(e=>{if(e&&e.state===nx.ViewState.WAITING){let{view:t,flag:i,options:r}=e;this.requestViewUpdate(t,i,r,this.getRenderPriority(t),!1)}}),this.flush()}updateView(e,t,i={}){if(null==e)return 0;if(rp.isCellView(e)){if(t&nx.FLAG_REMOVE)return this.removeView(e.cell),0;t&nx.FLAG_INSERT&&(this.insertView(e),t^=nx.FLAG_INSERT)}return t?e.confirmUpdate(t,i):0}insertView(e){let t=this.views[e.cell.id];if(t){let i=e.cell.getZIndex(),r=this.addZPivot(i);this.container.insertBefore(e.container,r),e.cell.isVisible()||this.toggleVisible(e.cell,!1),t.state=nx.ViewState.MOUNTED,this.graph.trigger("view:mounted",{view:e})}}resetViews(){this.willRemoveViews=Object.assign(Object.assign({},this.views),this.willRemoveViews),Object.values(this.willRemoveViews).forEach(e=>{e&&this.removeView(e.view)}),this.views={},this.willRemoveViews={}}removeView(e){let t=e.cell,i=this.willRemoveViews[t.id];i&&e&&(i.view.remove(),delete this.willRemoveViews[t.id],this.graph.trigger("view:unmounted",{view:e}))}toggleVisible(e,t){let i=this.model.getConnectedEdges(e);for(let e=0,r=i.length;e<r;e+=1){let r=i[e];if(t){let e=r.getSourceCell(),t=r.getTargetCell();if(e&&!e.isVisible()||t&&!t.isVisible())continue;this.toggleVisible(r,!0)}else this.toggleVisible(r,!1)}let r=this.views[e.id];r&&e_.is.css(r.view.container,{display:t?"unset":"none"})}addZPivot(e=0){null==this.zPivots&&(this.zPivots={});let t=this.zPivots,i=t[e];if(i)return i;i=t[e]=document.createComment(`z-index:${e+1}`);let r=-1/0;for(let i in t){let t=+i;if(t<e&&t>r&&(r=t)===e-1)continue}let s=this.container;if(r!==-1/0){let e=t[r];s.insertBefore(i,e.nextSibling)}else s.insertBefore(i,s.firstChild);return i}removeZPivots(){this.zPivots&&Object.values(this.zPivots).forEach(e=>{e&&e.parentNode&&e.parentNode.removeChild(e)}),this.zPivots={}}createCellView(e){let t={graph:this.graph},i=this.graph.options.createCellView;if(i){let r=e_.Iw.call(i,this.graph,e);if(r)return new r(e,t);if(null===r)return null}let r=e.view;if(null!=r&&"string"==typeof r){let i=rp.registry.get(r);return i?new i(e,t):rp.registry.onNotFound(r)}return e.isNode()?new nt(e,t):e.isEdge()?new nr(e,t):null}getEffectedEdges(e){let t=[],i=e.cell,r=this.model.getConnectedEdges(i);for(let e=0,s=r.length;e<s;e+=1){let s=r[e],n=this.views[s.id];if(!n)continue;let o=n.view;if(!this.isViewMounted(o))continue;let l=["update"];s.getTargetCell()===i&&l.push("target"),s.getSourceCell()===i&&l.push("source"),t.push({id:s.id,view:o,flag:o.getFlag(l)})}return t}isUpdatable(e){if(e.isNodeView())return!this.renderArea||this.renderArea.isIntersectWithRect(e.cell.getBBox());if(e.isEdgeView()){let t=e.cell,i=t.getSourceCell(),r=t.getTargetCell();if(this.renderArea&&i&&r)return this.renderArea.isIntersectWithRect(i.getBBox())||this.renderArea.isIntersectWithRect(r.getBBox())}return!0}getRenderPriority(e){return e.cell.isNode()?eI.RenderNode:eI.RenderEdge}dispose(){this.stopListening(),Object.keys(this.views).forEach(e=>{this.views[e].view.dispose()}),this.views={}}}!function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);n>3&&o&&Object.defineProperty(t,i,o)}([e_.JT.dispose()],nx.prototype,"dispose",null),(es=nx||(nx={})).FLAG_INSERT=0x40000000,es.FLAG_REMOVE=0x20000000,es.FLAG_RENDER=0x3ffffff,(eo=(en=nx||(nx={})).ViewState||(en.ViewState={}))[eo.CREATED=0]="CREATED",eo[eo.MOUNTED=1]="MOUNTED",eo[eo.WAITING=2]="WAITING";class nC extends nc{constructor(){super(...arguments),this.schedule=new nx(this.graph)}requestViewUpdate(e,t,i={}){this.schedule.requestViewUpdate(e,t,i)}isViewMounted(e){return this.schedule.isViewMounted(e)}setRenderArea(e){this.schedule.setRenderArea(e)}findViewByElem(e){if(null==e)return null;let t=this.options.container,i="string"==typeof e?t.querySelector(e):e instanceof Element?e:e[0];if(i){let e=this.graph.view.findAttr("data-cell-id",i);if(e){let t=this.schedule.views;if(t[e])return t[e].view}}return null}findViewByCell(e){if(null==e)return null;let t=sU.isCell(e)?e.id:e,i=this.schedule.views;return i[t]?i[t].view:null}findViewsFromPoint(e){let t={x:e.x,y:e.y};return this.model.getCells().map(e=>this.findViewByCell(e)).filter(e=>null!=e&&ev.getBBox(e.container,{target:this.view.stage}).containsPoint(t))}findEdgeViewsFromPoint(e,t=5){return this.model.getEdges().map(e=>this.findViewByCell(e)).filter(i=>{if(null!=i){let r=i.getClosestPoint(e);if(r)return r.distance(e)<=t}return!1})}findViewsInArea(e,t={}){let i=e0.Ae.create(e);return this.model.getCells().map(e=>this.findViewByCell(e)).filter(e=>{if(e){if(t.nodeOnly&&!e.isNodeView())return!1;let r=ev.getBBox(e.container,{target:this.view.stage});return 0===r.width?r.inflate(1,0):0===r.height&&r.inflate(0,1),t.strict?i.containsRect(r):i.isIntersectWithRect(r)}return!1})}dispose(){this.schedule.dispose()}}!function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);n>3&&o&&Object.defineProperty(t,i,o)}([nc.dispose()],nC.prototype,"dispose",null);var nE=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};class nP extends nc{get cid(){return this.graph.view.cid}get svg(){return this.view.svg}get defs(){return this.view.defs}isDefined(e){return null!=this.svg.getElementById(e)}filter(e){let t=e.id,i=e.name;if(t||(t=`filter-${i}-${this.cid}-${e_.kf.hashcode(JSON.stringify(e))}`),!this.isDefined(t)){let r=em.registry.get(i);if(null==r)return em.registry.onNotFound(i);let s=r(e.args||{}),n=Object.assign(Object.assign({x:-1,y:-1,width:3,height:3,filterUnits:"objectBoundingBox"},e.attrs),{id:t});e_.OW.create(eO.sanitize(s),n).appendTo(this.defs)}return t}gradient(e){let t=e.id,i=e.type;if(t||(t=`gradient-${i}-${this.cid}-${e_.kf.hashcode(JSON.stringify(e))}`),!this.isDefined(t)){let r=e.stops.map(e=>{let t=null!=e.opacity&&Number.isFinite(e.opacity)?e.opacity:1;return`<stop offset="${e.offset}" stop-color="${e.color}" stop-opacity="${t}"/>`}),s=`<${i}>${r.join("")}</${i}>`,n=Object.assign({id:t},e.attrs);e_.OW.create(s,n).appendTo(this.defs)}return t}marker(e){let{id:t,refX:i,refY:r,markerUnits:s,markerOrient:n,tagName:o,children:l}=e,a=nE(e,["id","refX","refY","markerUnits","markerOrient","tagName","children"]),h=t;if(h||(h=`marker-${this.cid}-${e_.kf.hashcode(JSON.stringify(e))}`),!this.isDefined(h)){"path"!==o&&delete a.d;let e=e_.OW.create("marker",{refX:i,refY:r,id:h,overflow:"visible",orient:null!=n?n:"auto",markerUnits:s||"userSpaceOnUse"},l?l.map(e=>{var{tagName:t}=e,i=nE(e,["tagName"]);return e_.OW.create(`${t}`||"path",e_.is.kebablizeAttrs(Object.assign(Object.assign({},a),i)))}):[e_.OW.create(o||"path",e_.is.kebablizeAttrs(a))]);this.defs.appendChild(e.node)}return h}remove(e){let t=this.svg.getElementById(e);t&&t.parentNode&&t.parentNode.removeChild(t)}}class nO extends nc{getClientMatrix(){return e_.is.createSVGMatrix(this.view.stage.getScreenCTM())}getClientOffset(){let e=this.view.svg.getBoundingClientRect();return new e0.E9(e.left,e.top)}getPageOffset(){return this.getClientOffset().translate(window.scrollX,window.scrollY)}snapToGrid(e,t){return("number"==typeof e?this.clientToLocalPoint(e,t):this.clientToLocalPoint(e.x,e.y)).snapToGrid(this.graph.getGridSize())}localToGraphPoint(e,t){let i=e0.E9.create(e,t);return ev.transformPoint(i,this.graph.matrix())}localToClientPoint(e,t){let i=e0.E9.create(e,t);return ev.transformPoint(i,this.getClientMatrix())}localToPagePoint(e,t){return("number"==typeof e?this.localToGraphPoint(e,t):this.localToGraphPoint(e)).translate(this.getPageOffset())}localToGraphRect(e,t,i,r){let s=e0.Ae.create(e,t,i,r);return ev.transformRectangle(s,this.graph.matrix())}localToClientRect(e,t,i,r){let s=e0.Ae.create(e,t,i,r);return ev.transformRectangle(s,this.getClientMatrix())}localToPageRect(e,t,i,r){return("number"==typeof e?this.localToGraphRect(e,t,i,r):this.localToGraphRect(e)).translate(this.getPageOffset())}graphToLocalPoint(e,t){let i=e0.E9.create(e,t);return ev.transformPoint(i,this.graph.matrix().inverse())}clientToLocalPoint(e,t){let i=e0.E9.create(e,t);return ev.transformPoint(i,this.getClientMatrix().inverse())}clientToGraphPoint(e,t){let i=e0.E9.create(e,t);return ev.transformPoint(i,this.graph.matrix().multiply(this.getClientMatrix().inverse()))}pageToLocalPoint(e,t){let i=e0.E9.create(e,t).diff(this.getPageOffset());return this.graphToLocalPoint(i)}graphToLocalRect(e,t,i,r){let s=e0.Ae.create(e,t,i,r);return ev.transformRectangle(s,this.graph.matrix().inverse())}clientToLocalRect(e,t,i,r){let s=e0.Ae.create(e,t,i,r);return ev.transformRectangle(s,this.getClientMatrix().inverse())}clientToGraphRect(e,t,i,r){let s=e0.Ae.create(e,t,i,r);return ev.transformRectangle(s,this.graph.matrix().multiply(this.getClientMatrix().inverse()))}pageToLocalRect(e,t,i,r){let s=e0.Ae.create(e,t,i,r),n=this.getPageOffset();return s.x-=n.x,s.y-=n.y,this.graphToLocalRect(s)}}class nA extends nc{constructor(){super(...arguments),this.highlights={}}init(){this.startListening()}startListening(){this.graph.on("cell:highlight",this.onCellHighlight,this),this.graph.on("cell:unhighlight",this.onCellUnhighlight,this)}stopListening(){this.graph.off("cell:highlight",this.onCellHighlight,this),this.graph.off("cell:unhighlight",this.onCellUnhighlight,this)}onCellHighlight({view:e,magnet:t,options:i={}}){let r=this.resolveHighlighter(i);if(!r)return;let s=this.getHighlighterId(t,r);if(!this.highlights[s]){let i=r.highlighter;i.highlight(e,t,Object.assign({},r.args)),this.highlights[s]={cellView:e,magnet:t,highlighter:i,args:r.args}}}onCellUnhighlight({magnet:e,options:t={}}){let i=this.resolveHighlighter(t);if(!i)return;let r=this.getHighlighterId(e,i);this.unhighlight(r)}resolveHighlighter(e){let t=this.options,i=e.highlighter;if(null==i){let r=e.type;i=r&&t.highlighting[r]||t.highlighting.default}if(null==i)return null;let r="string"==typeof i?{name:i}:i,s=r.name,n=ex.registry.get(s);return null==n?ex.registry.onNotFound(s):(ex.check(s,n),{name:s,highlighter:n,args:r.args||{}})}getHighlighterId(e,t){return e_.is.ensureId(e),t.name+e.id+JSON.stringify(t.args)}unhighlight(e){let t=this.highlights[e];t&&(t.highlighter.unhighlight(t.cellView,t.magnet,t.args),delete this.highlights[e])}dispose(){Object.keys(this.highlights).forEach(e=>this.unhighlight(e)),this.stopListening()}}!function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);n>3&&o&&Object.defineProperty(t,i,o)}([nA.dispose()],nA.prototype,"dispose",null);class nM extends nc{getScroller(){let e=this.graph.getPlugin("scroller");return e&&e.options.enabled?e:null}getContainer(){let e=this.getScroller();return e?e.container.parentElement:this.graph.container.parentElement}getSensorTarget(){let e=this.options.autoResize;if(e)return"boolean"==typeof e?this.getContainer():e}init(){if(this.options.autoResize){let e=this.getSensorTarget();e&&e_.bB.bind(e,()=>{let t=e.offsetWidth,i=e.offsetHeight;this.resize(t,i)})}}resize(e,t){let i=this.getScroller();i?i.resize(e,t):this.graph.transform.resize(e,t)}dispose(){e_.bB.clear(this.graph.container)}}!function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);n>3&&o&&Object.defineProperty(t,i,o)}([nc.dispose()],nM.prototype,"dispose",null);class nS extends e_.ew{get container(){return this.options.container}get[Symbol.toStringTag](){return nS.toStringTag}constructor(e){super(),this.installedPlugins=new Set,this.options=eV.get(e),this.css=new ng(this),this.view=new ns(this),this.defs=new nP(this),this.coord=new nO(this),this.transform=new nf(this),this.highlight=new nA(this),this.grid=new np(this),this.background=new nm(this),this.options.model?this.model=this.options.model:(this.model=new s_,this.model.graph=this),this.renderer=new nC(this),this.panning=new ny(this),this.mousewheel=new nb(this),this.virtualRender=new nv(this),this.size=new nM(this)}isNode(e){return e.isNode()}isEdge(e){return e.isEdge()}resetCells(e,t={}){return this.model.resetCells(e,t),this}clearCells(e={}){return this.model.clear(e),this}toJSON(e={}){return this.model.toJSON(e)}parseJSON(e){return this.model.parseJSON(e)}fromJSON(e,t={}){return this.model.fromJSON(e,t),this}getCellById(e){return this.model.getCell(e)}addNode(e,t={}){return this.model.addNode(e,t)}addNodes(e,t={}){return this.addCell(e.map(e=>sK.isNode(e)?e:this.createNode(e)),t)}createNode(e){return this.model.createNode(e)}removeNode(e,t={}){return this.model.removeCell(e,t)}addEdge(e,t={}){return this.model.addEdge(e,t)}addEdges(e,t={}){return this.addCell(e.map(e=>sQ.isEdge(e)?e:this.createEdge(e)),t)}removeEdge(e,t={}){return this.model.removeCell(e,t)}createEdge(e){return this.model.createEdge(e)}addCell(e,t={}){return this.model.addCell(e,t),this}removeCell(e,t={}){return this.model.removeCell(e,t)}removeCells(e,t={}){return this.model.removeCells(e,t)}removeConnectedEdges(e,t={}){return this.model.removeConnectedEdges(e,t)}disconnectConnectedEdges(e,t={}){return this.model.disconnectConnectedEdges(e,t),this}hasCell(e){return this.model.has(e)}getCells(){return this.model.getCells()}getCellCount(){return this.model.total()}getNodes(){return this.model.getNodes()}getEdges(){return this.model.getEdges()}getOutgoingEdges(e){return this.model.getOutgoingEdges(e)}getIncomingEdges(e){return this.model.getIncomingEdges(e)}getConnectedEdges(e,t={}){return this.model.getConnectedEdges(e,t)}getRootNodes(){return this.model.getRoots()}getLeafNodes(){return this.model.getLeafs()}isRootNode(e){return this.model.isRoot(e)}isLeafNode(e){return this.model.isLeaf(e)}getNeighbors(e,t={}){return this.model.getNeighbors(e,t)}isNeighbor(e,t,i={}){return this.model.isNeighbor(e,t,i)}getSuccessors(e,t={}){return this.model.getSuccessors(e,t)}isSuccessor(e,t,i={}){return this.model.isSuccessor(e,t,i)}getPredecessors(e,t={}){return this.model.getPredecessors(e,t)}isPredecessor(e,t,i={}){return this.model.isPredecessor(e,t,i)}getCommonAncestor(...e){return this.model.getCommonAncestor(...e)}getSubGraph(e,t={}){return this.model.getSubGraph(e,t)}cloneSubGraph(e,t={}){return this.model.cloneSubGraph(e,t)}cloneCells(e){return this.model.cloneCells(e)}getNodesFromPoint(e,t){return this.model.getNodesFromPoint(e,t)}getNodesInArea(e,t,i,r,s){return this.model.getNodesInArea(e,t,i,r,s)}getNodesUnderNode(e,t={}){return this.model.getNodesUnderNode(e,t)}searchCell(e,t,i={}){return this.model.search(e,t,i),this}getShortestPath(e,t,i={}){return this.model.getShortestPath(e,t,i)}getAllCellsBBox(){return this.model.getAllCellsBBox()}getCellsBBox(e,t={}){return this.model.getCellsBBox(e,t)}startBatch(e,t={}){this.model.startBatch(e,t)}stopBatch(e,t={}){this.model.stopBatch(e,t)}batchUpdate(e,t,i){let r="string"==typeof e?e:"update",s="string"==typeof e?t:e,n="function"==typeof t?i:t;this.startBatch(r,n);let o=s();return this.stopBatch(r,n),o}updateCellId(e,t){return this.model.updateCellId(e,t)}findView(e){return sU.isCell(e)?this.findViewByCell(e):this.findViewByElem(e)}findViews(e){return e0.Ae.isRectangleLike(e)?this.findViewsInArea(e):e0.E9.isPointLike(e)?this.findViewsFromPoint(e):[]}findViewByCell(e){return this.renderer.findViewByCell(e)}findViewByElem(e){return this.renderer.findViewByElem(e)}findViewsFromPoint(e,t){return this.renderer.findViewsFromPoint("number"==typeof e?{x:e,y:t}:e)}findViewsInArea(e,t,i,r,s){let n="number"==typeof e?{x:e,y:t,width:i,height:r}:e,o="number"==typeof e?s:t;return this.renderer.findViewsInArea(n,o)}matrix(e){return void 0===e?this.transform.getMatrix():(this.transform.setMatrix(e),this)}resize(e,t){let i=this.getPlugin("scroller");return i?i.resize(e,t):this.transform.resize(e,t),this}scale(e,t=e,i=0,r=0){return void 0===e?this.transform.getScale():(this.transform.scale(e,t,i,r),this)}zoom(e,t){let i=this.getPlugin("scroller");if(i){if(void 0===e)return i.zoom();i.zoom(e,t)}else{if(void 0===e)return this.transform.getZoom();this.transform.zoom(e,t)}return this}zoomTo(e,t={}){let i=this.getPlugin("scroller");return i?i.zoom(e,Object.assign(Object.assign({},t),{absolute:!0})):this.transform.zoom(e,Object.assign(Object.assign({},t),{absolute:!0})),this}zoomToRect(e,t={}){let i=this.getPlugin("scroller");return i?i.zoomToRect(e,t):this.transform.zoomToRect(e,t),this}zoomToFit(e={}){let t=this.getPlugin("scroller");return t?t.zoomToFit(e):this.transform.zoomToFit(e),this}rotate(e,t,i){return void 0===e?this.transform.getRotation():(this.transform.rotate(e,t,i),this)}translate(e,t){return void 0===e?this.transform.getTranslation():(this.transform.translate(e,t),this)}translateBy(e,t){let i=this.translate(),r=i.tx+e,s=i.ty+t;return this.translate(r,s)}getGraphArea(){return this.transform.getGraphArea()}getContentArea(e={}){return this.transform.getContentArea(e)}getContentBBox(e={}){return this.transform.getContentBBox(e)}fitToContent(e,t,i,r){return this.transform.fitToContent(e,t,i,r)}scaleContentToFit(e={}){return this.transform.scaleContentToFit(e),this}center(e){return this.centerPoint(e)}centerPoint(e,t,i){let r=this.getPlugin("scroller");return r?r.centerPoint(e,t,i):this.transform.centerPoint(e,t),this}centerContent(e){let t=this.getPlugin("scroller");return t?t.centerContent(e):this.transform.centerContent(e),this}centerCell(e,t){let i=this.getPlugin("scroller");return i?i.centerCell(e,t):this.transform.centerCell(e),this}positionPoint(e,t,i,r={}){let s=this.getPlugin("scroller");return s?s.positionPoint(e,t,i,r):this.transform.positionPoint(e,t,i),this}positionRect(e,t,i){let r=this.getPlugin("scroller");return r?r.positionRect(e,t,i):this.transform.positionRect(e,t),this}positionCell(e,t,i){let r=this.getPlugin("scroller");return r?r.positionCell(e,t,i):this.transform.positionCell(e,t),this}positionContent(e,t){let i=this.getPlugin("scroller");return i?i.positionContent(e,t):this.transform.positionContent(e,t),this}snapToGrid(e,t){return this.coord.snapToGrid(e,t)}pageToLocal(e,t,i,r){return e0.Ae.isRectangleLike(e)?this.coord.pageToLocalRect(e):"number"==typeof e&&"number"==typeof t&&"number"==typeof i&&"number"==typeof r?this.coord.pageToLocalRect(e,t,i,r):this.coord.pageToLocalPoint(e,t)}localToPage(e,t,i,r){return e0.Ae.isRectangleLike(e)?this.coord.localToPageRect(e):"number"==typeof e&&"number"==typeof t&&"number"==typeof i&&"number"==typeof r?this.coord.localToPageRect(e,t,i,r):this.coord.localToPagePoint(e,t)}clientToLocal(e,t,i,r){return e0.Ae.isRectangleLike(e)?this.coord.clientToLocalRect(e):"number"==typeof e&&"number"==typeof t&&"number"==typeof i&&"number"==typeof r?this.coord.clientToLocalRect(e,t,i,r):this.coord.clientToLocalPoint(e,t)}localToClient(e,t,i,r){return e0.Ae.isRectangleLike(e)?this.coord.localToClientRect(e):"number"==typeof e&&"number"==typeof t&&"number"==typeof i&&"number"==typeof r?this.coord.localToClientRect(e,t,i,r):this.coord.localToClientPoint(e,t)}localToGraph(e,t,i,r){return e0.Ae.isRectangleLike(e)?this.coord.localToGraphRect(e):"number"==typeof e&&"number"==typeof t&&"number"==typeof i&&"number"==typeof r?this.coord.localToGraphRect(e,t,i,r):this.coord.localToGraphPoint(e,t)}graphToLocal(e,t,i,r){return e0.Ae.isRectangleLike(e)?this.coord.graphToLocalRect(e):"number"==typeof e&&"number"==typeof t&&"number"==typeof i&&"number"==typeof r?this.coord.graphToLocalRect(e,t,i,r):this.coord.graphToLocalPoint(e,t)}clientToGraph(e,t,i,r){return e0.Ae.isRectangleLike(e)?this.coord.clientToGraphRect(e):"number"==typeof e&&"number"==typeof t&&"number"==typeof i&&"number"==typeof r?this.coord.clientToGraphRect(e,t,i,r):this.coord.clientToGraphPoint(e,t)}defineFilter(e){return this.defs.filter(e)}defineGradient(e){return this.defs.gradient(e)}defineMarker(e){return this.defs.marker(e)}getGridSize(){return this.grid.getGridSize()}setGridSize(e){return this.grid.setGridSize(e),this}showGrid(){return this.grid.show(),this}hideGrid(){return this.grid.hide(),this}clearGrid(){return this.grid.clear(),this}drawGrid(e){return this.grid.draw(e),this}updateBackground(){return this.background.update(),this}drawBackground(e,t){let i=this.getPlugin("scroller");return null==i||null!=this.options.background&&t?this.background.draw(e):i.drawBackground(e,t),this}clearBackground(e){let t=this.getPlugin("scroller");return null==t||null!=this.options.background&&e?this.background.clear():t.clearBackground(e),this}enableVirtualRender(){return this.virtualRender.enableVirtualRender(),this}disableVirtualRender(){return this.virtualRender.disableVirtualRender(),this}isMouseWheelEnabled(){return!this.mousewheel.disabled}enableMouseWheel(){return this.mousewheel.enable(),this}disableMouseWheel(){return this.mousewheel.disable(),this}toggleMouseWheel(e){return null==e?this.isMouseWheelEnabled()?this.disableMouseWheel():this.enableMouseWheel():e?this.enableMouseWheel():this.disableMouseWheel(),this}isPannable(){let e=this.getPlugin("scroller");return e?e.isPannable():this.panning.pannable}enablePanning(){let e=this.getPlugin("scroller");return e?e.enablePanning():this.panning.enablePanning(),this}disablePanning(){let e=this.getPlugin("scroller");return e?e.disablePanning():this.panning.disablePanning(),this}togglePanning(e){return null==e?this.isPannable()?this.disablePanning():this.enablePanning():e!==this.isPannable()&&(e?this.enablePanning():this.disablePanning()),this}use(e,...t){return this.installedPlugins.has(e)||(this.installedPlugins.add(e),e.init(this,...t)),this}getPlugin(e){return Array.from(this.installedPlugins).find(t=>t.name===e)}getPlugins(e){return Array.from(this.installedPlugins).filter(t=>e.includes(t.name))}enablePlugins(e){let t=e;Array.isArray(t)||(t=[t]);let i=this.getPlugins(t);return null==i||i.forEach(e=>{var t;null==(t=null==e?void 0:e.enable)||t.call(e)}),this}disablePlugins(e){let t=e;Array.isArray(t)||(t=[t]);let i=this.getPlugins(t);return null==i||i.forEach(e=>{var t;null==(t=null==e?void 0:e.disable)||t.call(e)}),this}isPluginEnabled(e){var t;let i=this.getPlugin(e);return null==(t=null==i?void 0:i.isEnabled)?void 0:t.call(i)}disposePlugins(e){let t=e;Array.isArray(t)||(t=[t]);let i=this.getPlugins(t);return null==i||i.forEach(e=>{e.dispose(),this.installedPlugins.delete(e)}),this}dispose(e=!0){e&&this.model.dispose(),this.css.dispose(),this.defs.dispose(),this.grid.dispose(),this.coord.dispose(),this.transform.dispose(),this.highlight.dispose(),this.background.dispose(),this.mousewheel.dispose(),this.panning.dispose(),this.view.dispose(),this.renderer.dispose(),this.installedPlugins.forEach(e=>{e.dispose()})}}!function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);n>3&&o&&Object.defineProperty(t,i,o)}([e_.ew.dispose()],nS.prototype,"dispose",null),(el=nS||(nS={})).View=ns,el.Renderer=nC,el.MouseWheel=nb,el.DefsManager=nP,el.GridManager=np,el.CoordManager=nO,el.TransformManager=nf,el.HighlightManager=nA,el.BackgroundManager=nm,el.PanningManager=ny,(ea=nS||(nS={})).toStringTag=`X6.${ea.name}`,ea.isGraph=function(e){if(null==e)return!1;if(e instanceof ea)return!0;let t=e[Symbol.toStringTag];return null==t||t===ea.toStringTag},(eh=nS||(nS={})).render=function(e,t){let i=e instanceof HTMLElement?new eh({container:e}):new eh(e);return null!=t&&i.fromJSON(t),i},(ec=nS||(nS={})).registerNode=sK.registry.register,ec.registerEdge=sQ.registry.register,ec.registerView=rp.registry.register,ec.registerAttr=eb.registry.register,ec.registerGrid=e5.registry.register,ec.registerFilter=em.registry.register,ec.registerNodeTool=eM.registry.register,ec.registerEdgeTool=eS.registry.register,ec.registerBackground=ef.registry.register,ec.registerHighlighter=ex.registry.register,ec.registerPortLayout=eC.registry.register,ec.registerPortLabelLayout=eE.registry.register,ec.registerMarker=ey.registry.register,ec.registerRouter=eB.registry.register,ec.registerConnector=eR.registry.register,ec.registerAnchor=eT.registry.register,ec.registerEdgeAnchor=ek.registry.register,ec.registerConnectionPoint=eN.registry.register,(eg=nS||(nS={})).unregisterNode=sK.registry.unregister,eg.unregisterEdge=sQ.registry.unregister,eg.unregisterView=rp.registry.unregister,eg.unregisterAttr=eb.registry.unregister,eg.unregisterGrid=e5.registry.unregister,eg.unregisterFilter=em.registry.unregister,eg.unregisterNodeTool=eM.registry.unregister,eg.unregisterEdgeTool=eS.registry.unregister,eg.unregisterBackground=ef.registry.unregister,eg.unregisterHighlighter=ex.registry.unregister,eg.unregisterPortLayout=eC.registry.unregister,eg.unregisterPortLabelLayout=eE.registry.unregister,eg.unregisterMarker=ey.registry.unregister,eg.unregisterRouter=eB.registry.unregister,eg.unregisterConnector=eR.registry.unregister,eg.unregisterAnchor=eT.registry.unregister,eg.unregisterEdgeAnchor=ek.registry.unregister,eg.unregisterConnectionPoint=eN.registry.unregister;var nT=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)0>t.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};class nk extends sK{}var nN=nk||(nk={});class nj extends nt{init(){super.init(),this.cell.on("change:*",this.onCellChangeAny,this)}onCellChangeAny({key:e}){let t=nN.shapeMaps[this.cell.shape];if(t){let{effect:i}=t;(!i||i.includes(e))&&this.renderHTMLComponent()}}confirmUpdate(e){let t=super.confirmUpdate(e);return this.handleAction(t,nj.action,()=>this.renderHTMLComponent())}renderHTMLComponent(){let e=this.selectors&&this.selectors.foContent;if(e){e_.is.empty(e);let t=nN.shapeMaps[this.cell.shape];if(!t)return;let{html:i}=t;"function"==typeof i&&(i=i(this.cell)),i&&("string"==typeof i?e.innerHTML=i:e_.is.append(e,i))}}dispose(){this.cell.off("change:*",this.onCellChangeAny,this)}}(function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);n>3&&o&&Object.defineProperty(t,i,o)})([nj.dispose()],nj.prototype,"dispose",null),nN.View=nj,(eu=nj=nN.View||(nN.View={})).action="html",eu.config({bootstrap:[eu.action],actions:{html:eu.action}}),nt.registry.register("html-view",eu,!0),(ed=nk||(nk={})).config({view:"html-view",markup:[{tagName:"rect",selector:"body"},Object.assign({},eO.getForeignObjectMarkup()),{tagName:"text",selector:"label"}],attrs:{body:{fill:"none",stroke:"none",refWidth:"100%",refHeight:"100%"},fo:{refWidth:"100%",refHeight:"100%"}}}),sK.registry.register("html",ed,!0),(ep=nk||(nk={})).shapeMaps={},ep.register=function(e){let{shape:t,html:i,effect:r,inherit:s}=e,n=nT(e,["shape","html","effect","inherit"]);if(!t)throw Error("should specify shape in config");ep.shapeMaps[t]={html:i,effect:r},nS.registerNode(t,Object.assign({inherit:s||"html"},n),!0)}}}]);